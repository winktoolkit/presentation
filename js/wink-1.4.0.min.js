define=function(){if(typeof wink=="undefined")wink={};var c=arguments,a=c.length;return(a==1?c[0]:a==2?c[1]:c[2])(wink)};define.amd={vendor:"winktoolkit.org"};define(function(){if(typeof wink=="undefined")wink={};return wink});
define(["../../_kernel/js/kernel"],function(c){c.version="1.4.1";c.api={};c.mm={};c.net={};c.plugins={};c.ui={form:{},layout:{},xy:{},xyz:{}};c.ux={};var a=Array.prototype.slice,b=window;c.byId=function(f){return c.isString(f)?document.getElementById(f):f};c.query=function(f,g){return a.call((g||document).querySelectorAll(f))};var d="en_EN";c.setLocale=function(f){d=f};c.translate=function(f,g){var h=f,i=window.i18n||{};if(c.isSet(g)&&c.isSet(g.i18n))i=g.i18n;var m=i[d];if(c.isUndefined(m))m=i;i=
m[f];c.isUndefined(i)||(h=i);return h};c.isUndefined=function(f){return f===undefined};c.isNull=function(f){return f===null};c.isSet=function(f){return!c.isUndefined(f)&&!c.isNull(f)};c.isCallback=function(f){return!!(f&&f.method)};c.isString=function(f){return typeof f=="string"||f instanceof String};c.isInteger=function(f){return parseInt(f)===f};c.isNumber=function(f){return typeof f=="number"||f instanceof Number};c.isArray=function(f){return typeof f=="array"||f instanceof Array};c.isBoolean=
function(f){return typeof f=="boolean"||f instanceof Boolean};c.isFunction=function(f){return Object.prototype.toString.call(f)==="[object Function]"};c.trim=function(f){return f.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};c.bind=function(f,g){var h=a.call(arguments,2);return function(){var i=h.concat(a.call(arguments,0));return f.apply(g,i)}};c.call=function(f,g){var h=b,i=f.method,m=[];if(c.isSet(f.context))h=f.context;if(arguments.length==2)m=[g];if(c.isSet(f.arguments)){var o=f.arguments;c.isArray(o)||
(o=[f.arguments]);m=m.concat(o)}return h[i].apply(h,m)};c.connect=function(f,g,h){if(!c.isSet(h.context))h.context=b;var i=f[g];if(c.isNull(i)||c.isUndefined(i.cbs)){var m=function(){var k=arguments.callee.target,n=[],l,j=arguments.length;for(l=0;l<j;l++){var p=arguments[l];n=c.isArray(p)?n.concat([p]):n.concat(p)}k&&k.apply(f,n);k=f[g].cbs;for(var q in k)c.isArray(k[q].arguments)?c.call({context:k[q].context,method:k[q].method,arguments:n.concat(k[q].arguments)}):c.call({context:k[q].context,method:k[q].method,
arguments:n.concat([k[q].arguments])})};m.target=i;m.cbs=[];i=f[g]=m}for(var o in i.cbs)if(i.cbs[o].context==h.context&&i.cbs[o].method==h.method)return;i.cbs.push(h)};c.disconnect=function(f,g,h){if(!c.isSet(h.context))h.context=b;f=f[g];if(!c.isUndefined(f.cbs))for(var i in f.cbs)f.cbs[i].context==h.context&&f.cbs[i].method==h.method&&delete f.cbs[i]};c.setTimeout=function(f,g,h){var i=a.call(arguments,3);return setTimeout(function(){f[g].apply(f,i)},h)};c.setInterval=function(f,g,h){var i=a.call(arguments,
3);return setInterval(function(){f[g].apply(f,i)},h)};var e=100;c.getUId=function(){return e+=1};if(c.isUndefined(b._))_=c.bind(c.translate,c);if(c.isUndefined(b.$$))$$=c.bind(c.query,c);if(c.isUndefined(b.$))$=c.bind(c.byId,c);return c});
define(["../../../_base/_base/js/base"],function(c){var a=HTMLElement.prototype,b=c.isUndefined,d=function(o){var k=0,n=this;if(c.isSet(o))for(;n&&n!=o;){k+=n.offsetTop;n=n.offsetParent}else for(;n;){k+=n.offsetTop;n=n.offsetParent}return k},e=function(o){var k=0,n=this;if(c.isSet(o))for(;n&&n!=o;){k+=n.offsetLeft;n=n.offsetParent}else for(;n;){k+=n.offsetLeft;n=n.offsetParent}return k},f=function(o,k,n){c.fx.applyTranslate(this,o,k,n)},g=function(o,k){c.fx.applyScale(this,o,k)},h=function(o){c.fx.applyRotate(this,
o)},i=function(o,k,n){c.ux.gesture.listenTo(this,o,k,n)},m=function(o,k){c.ux.gesture.unlistenTo(this,o,k)};a.winkGetTopPosition=d;a.winkGetLeftPosition=e;a.winkTranslate=f;a.winkScale=g;a.winkRotate=h;a.winkListenToGesture=i;a.winkUnlistenToGesture=m;if(b(a.getTopPosition))a.getTopPosition=d;if(b(a.getLeftPosition))a.getLeftPosition=e;if(b(a.rotate))a.rotate=h;if(b(a.scale))a.scale=g;if(b(a.translate))a.translate=f;if(b(a.listenToGesture))a.listenToGesture=i;if(b(a.unlistenToGesture))a.unlistenToGesture=
m;return c});define(["../../../_base/_base/js/base"],function(c){c.error={logLevel:0,log:function(a){if(this.logLevel==1)typeof console!="undefined"?console.log(a):alert(a)}};c.log=c.bind(c.error.log,c.error);return c.error});
define(["../../../_base/_base/js/base"],function(c){var a=window.JSON;c.json={parse:function(b){if(c.isSet(a)&&c.isSet(a.parse))return a.parse(b);else{var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b=String(b);d.lastIndex=0;if(d.test(b))b=b.replace(d,function(f){return"\\u"+("0000"+f.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))var e=eval("("+b+")");return e}},concat:function(b,d){for(var e in d)b[e]=d[e];return b}};c.parseJSON=c.bind(c.json.parse,c.json);c.mixin=c.bind(c.json.concat,c.json);return c.json});
define(["../../../_base/_base/js/base","../../error/js/error"],function(c){var a=[],b=function(f,g){if(c.isCallback(g)){var h=[f.toLowerCase(),g];a.push(h)}},d=function(f,g){var h=f.toLowerCase(),i,m=a.length;for(i=0;i<m;i++){var o=a[i];if(o[0]==h&&o[1].method==g.method&&o[1].context==g.context){a.splice(i,1);break}}},e=function(f,g){var h=f.toLowerCase(),i,m=a.length;for(i=0;i<m;i++){var o=a[i];o&&o[0]==h&&c.isSet(o[1])&&c.call(o[1],g)}};c.topics={subscribe:b,unsubscribe:d,publish:e,_getTopics:function(){return a}};
c.publish=e;c.subscribe=b;c.unsubscribe=d;return c.topics});
define(["../../../_base/_base/js/base"],function(c){var a,b,d,e,f,g,h,i,m,o,k,n,l,j,p,q,s,r,t,u,x,C,D,E;a=b=d=e=f=g=h=i=x=C=D=E=false;m=o=k=n=l=j=p=q=s=0;var A=c.isSet;b=function(v,z){return RegExp(v).test(z)};var y=function(v,z,w){var B={v:0,r:0,u:0};v=RegExp(z).exec(v);if(A(v)&&v.length>1){v=v[2];z=RegExp("[^\\"+w+"0-9]").exec(v);if(A(z))v=v.slice(0,z.index);w=v.split(w);if(w.length>0)B.v=w[0];if(w.length>1)B.r=w[1];if(w.length>2)B.u=w[2];if(w.length>3)B.u+="."+w[3]}return B};a=navigator||{};r=
a.userAgent;t=a.platform;u=a.appVersion;a=b(" AppleWebKit/",r);C=b(/bada/gi,r);D=b(/Opera/gi,r);if(A(t)){if(b(/iphone/i,t))d=true;if(b(/ipod/i,t))e=true;if(b(/ipad/i,t))f=true;if(b(/blackberry/i,t))x=true}if(A(u)){if(b(/android/i,u))g=true;if(b(/safari/i,u)){h=true;t=y(u,"( Version/)([^ ]+)",".");n=t.v;l=t.r;j=t.u}if(b(/MSIE/i,u)){E=true;t=y(u,"( MSIE )([^ ]+)",".");n=t.v;l=t.r}}if(!h&&!a)i=b(/mozilla/i,r);b=d||e||g||x||C||b(" Mobile/",r);if(a){t=y(r,"( AppleWebKit/)([^ ]+)",".");m=t.v;o=t.r;k=t.u}if(b&&
A(u)){p=g?["( Android )([^ ]+)","."]:["( OS )([^ ]+)","_"];if(x)p=["( BlackBerry )([^ ]+)","."];y=y(u,p[0],p[1]);p=y.v;q=y.r;s=y.u}c.ua={isWebkit:a,isMobile:b,isIPhone:d,isIPod:e,isIPad:f,isIOS:d||e||f,isAndroid:g,isBlackBerry:x,isBada:C,isOpera:D,isSafari:h,isMozilla:i,isIE:E,webkitVersion:m,webkitMinorVersion:o,webkitUpdateVersion:k,browserVersion:n,browserMinorVersion:l,browserUpdateVersion:j,osVersion:p,osMinorVersion:q,osUpdateVersion:s};return c.ua});
define(["../../../_base/_base/js/base"],function(c){function a(g){if(d(e[g]))e[g]=e[g]();return e[g]}function b(g,h,i){if(typeof e[g]=="undefined"){var m=h;if(i&&d(h))m=h();e[g]=m}}function d(g){return typeof g=="function"}var e={},f={};c.has=a;c.has.prefixes=["-webkit-","-moz-","-o-","ms-","-khtml-"];c.has.prefix=null;c.has.inquire=b;c.has.inquireMap=function(g,h){if(!(!g||g.length==0))for(var i in g)b(i,g[i],h)};c.has.setProp=function(g,h){f[g]=h};c.has.deferProp=function(g,h){f[g]=d(h)?h:function(){a(h)}};
c.has.prop=function(g){var h=f[g];if(d(h)){h();h=f[g];if(d(h))h=g}return h||g};return c.has});define(["../../../_base/_base/js/base","./feat"],function(c){c=c.has;var a=c.inquire,b=window;a("json-parse",function(){var d;d=false;if(b.JSON&&typeof JSON.parse=="function"){d=JSON.parse('{"w":1}');d=!!(d&&d.w)}return d});return c});
define(["../../../_base/_base/js/base","./feat"],function(c){function a(j){var p=false;if(typeof o[j]==n){f(j,j);p=true}else{var q=d.prefix;q=q!=null?[q]:k;var s,r=q.length;for(s=0;s<r;s++){var t,u=q[s]+j;t=u;var x=/(-)([a-z])/;for(u=u.match(x);u!=null;){t=t.replace(x,RegExp.$2.toUpperCase());u=t.match(x)}t=t;if(typeof o[t]==n){d.prefix=q[s];f(j,t);p=true;break}}}return p}function b(j){return function(){a(j)}}var d=c.has,e=d.inquireMap,f=d.setProp,g=d.deferProp,h=window,i=h.document,m=i.createElement("div"),
o=m.style,k=d.prefixes,n="string",l={a:"transform-property",b:"transition-property",c:"transition-duration",d:"transition-delay",e:"transition-timing-function",f:"border-radius",g:"text-shadow",h:"box-shadow",i:"gradient",j:"perspective",k:"transform-origin",l:"transform-style",m:"transform",n:"css-transition",o:"css-perspective",p:"css-transform",q:"perspective-origin",r:"backface-visibility",s:"tap-highlight-color",t:"user-select",bg:"background-image"};g(l.a,l.p);g(l.m,l.p);g(l.b,l.n);g(l.c,l.n);
g(l.d,l.n);g(l.e,l.n);g(l.f,"css-border-radius");g(l.g,"css-text-shadow");g(l.h,"css-box-shadow");g(l.i,"css-gradient");g(l.j,l.o);g(l.k,l.o);g(l.l,l.o);g(l.q,l.o);g(l.r,b(l.r));g(l.s,b(l.s));g(l.t,b(l.t));e({"css-transform":function(){var j=a(l.m),p=d.prefix,q=l.m;if(p!=null)q=p+q;j?f(l.a,d.prop(l.m)):f(l.a,l.m);f(l.m,q);return j},"css-transition":function(){var j=true;return j=(j=(j=(j=j&&a(l.b))&&a(l.c))&&a(l.d))&&a(l.e)},"css-translate3d":function(){return d("css-matrix")},"css-border-radius":function(){return a(l.f)},
"css-text-shadow":function(){return a(l.g)},"css-box-shadow":function(){return a(l.h)},"css-gradient":function(){var j=l.i,p=l.bg,q=d.prefix;q=q!=null?["",q]:[""].concat(k);var s,r=q.length;for(s=0;s<r;s++){var t=q[s]+j;o.cssText=p+":"+(t+"(linear,left top,right bottom,from(#9f9),to(white));");if(o[p]&&o[p].indexOf(j)!=-1){f(j,t);return true}}return false},"css-perspective":function(){var j=a(l.j)&&a(l.k)&&a(l.l)&&a(l.q);j=j&&a(l.k+"-x")&&a(l.k+"-y")&&a(l.k+"-z");if(!j)return false;var p=d.prefix||
"";j=i.createElement("style");j.textContent="@media ("+p+"transform-3d){#wink_has{height:2px}}";i.getElementsByTagName("head")[0].appendChild(j);m.id="wink_has";i.documentElement.appendChild(m);p=m.offsetHeight===2;j.parentNode.removeChild(j);m.parentNode.removeChild(m);return p},"css-matrix":function(){var j=h.WebKitCSSMatrix;if(typeof j=="undefined")return false;var p=new j("matrix(1,0,0,1,6,7)"),q=p.m41==6&&p.m42==7&&p.m41==p.e&&p.m42==p.f;if(q){j=new j("matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,6,7,8,1)");
q=q&&p.m41==j.m41&&p.m42==j.m42&&j.m43==8}return q},"css-matrix-stack-inversed":function(){var j=c.ua;if(!d("css-matrix")||!j)return false;var p=j.isIOS?parseInt(""+j.osVersion+j.osMinorVersion+j.osUpdateVersion):500;j=j.isAndroid?parseInt(""+j.osVersion+j.osMinorVersion+j.osUpdateVersion):300;return p<421||j<300},"css-position-fixed":function(){var j=c.ua;if(j.isAndroid&&j.osVersion==2&&j.osMinorVersion==1||j.isBada)return false;if(j.isIOS)return j.osVersion<5?false:true;j=document.body;if(document.createElement&&
j&&j.appendChild&&j.removeChild){if(!m.getBoundingClientRect)return null;m.innerHTML="x";m.style.cssText="position:fixed;top:100px;";j.appendChild(m);var p=j.style.height,q=j.scrollTop;j.style.height="3000px";j.scrollTop=500;var s=m.getBoundingClientRect().top;j.style.height=p;p=s===100;j.removeChild(m);j.scrollTop=q;return p}return false}});return d});
define(["../../../_base/_base/js/base","./feat"],function(c){function a(h){return"on"+g[h]in f}var b=c.has;c=b.inquireMap;var d=b.setProp,e=b.deferProp,f=window.document.documentElement,g={ts:"touchstart",tm:"touchmove",te:"touchend",gs:"gesturestart",gc:"gesturechange",ge:"gestureend",tre:"transitionend"};e(g.ts,g.ts);e(g.tm,g.tm);e(g.te,g.te);e(g.tre,g.tre);c({touchstart:function(){var h=a("ts");d(g.ts,h?g.ts:"mousedown");return h},touchmove:function(){var h=a("tm");d(g.tm,h?g.tm:"mousemove");return h},
touchend:function(){var h=a("te");d(g.te,h?g.te:"mouseup");return h},touch:function(){return b(g.ts)&&b(g.tm)&&b(g.te)},gesturestart:function(){return a("gs")},gesturechange:function(){return a("gc")},gestureend:function(){return a("ge")},gesture:function(){return b(g.gs)&&b(g.gc)&&b(g.ge)},transitionend:function(){if(b("css-transition")){var h=b.prefix,i=g.tre;if(h=="-webkit-")i="webkitTransitionEnd";else if(h=="-o-")i="oTransitionEnd";d(g.tre,i);return true}return false}});return b});
define(["../../../_base/_base/js/base","./feat"],function(c){return c.has});
define(["../../../_base/_base/js/base","../../../_base/_feat/js/feat_css"],function(c){var a=c.isSet,b=c.has.prop,d={u:undefined},e=function(k,n){var l=k.className;if((" "+l+" ").indexOf(" "+n+" ")<0)k.className=l+(l?" ":"")+n},f=function(k,n){var l=c.trim((" "+k.className+" ").replace(" "+n+" "," "));if(k.className!=l)k.className=l},g=function(k,n){var l,j=k.style;for(l in n){var p=b(l);j[p]=n[l]}},h=function(k,n,l,j,p){var q=n;if(n.indexOf(",")==-1)q=b(n);else{n=n.split(",");var s=n.length;for(q=
0;q<s;q++)n[q]=b(c.trim(n[q]));q=n.join(",")}g(k,{"transition-property":q,"transition-duration":l,"transition-delay":j,"transition-timing-function":p})},i=function(k){return window.getComputedStyle(k)[b("transform-property")]},m=function(k,n){g(k,{"transform-property":n})},o=function(k,n,l,j,p,q,s){var r=k._cssT||{};r=k._cssT={t:a(n)||a(l)?{tx:n,ty:l}:r.t,s:a(j)||a(p)?{sx:j,sy:p}:r.s,r:a(q)?{a:q}:r.r};j=r.t&&(a(r.t.tx)||a(r.t.ty));l=r.s&&(a(r.s.sx)||a(r.s.sy));n=r.r&&a(r.r.a);if(!c.has("css-translate3d")||
c.ua.isAndroid&&(l||n))s=true;if(j){p=r.t.ty;s=s;j="";j=r.t.tx;a(j)||(j=0);p=p;a(p)||(p=0);q="0";var t=false;t=(t=t||c.isString(j)&&j.indexOf("%",0)!=-1)||c.isString(p)&&p.indexOf("%",0)!=-1;if(!t){j+="px";p+="px";q+="px"}s=j=s?"translate("+j+", "+p+")":"translate3d("+j+", "+p+", "+q+")"}else s="";s=s;if(l){l=r.s.sy;j="";j=r.s.sx;a(j)||(j=1);l=l;a(l)||(l=1);l=j=c.has("css-perspective")?"scale3d("+j+", "+l+", 1)":"scale("+j+", "+l+")"}else l="";l=l;if(n){n="";r=r.r.a;a(r)||(r=0);r=n="rotate("+r+"deg)"}else r=
"";r=c.trim(s+" "+l+" "+r);m(k,r)};c.fx={addClass:e,removeClass:f,apply:g,applyTransition:h,applyTransformTransition:function(k,n,l,j){h(k,"transform",n,l,j)},onTransitionEnd:function(k,n,l){var j=b("transitionend"),p=function(q){l!==true&&k.removeEventListener(j,p,false);n(q)};k.addEventListener(j,p,false);return p},getTransformPosition:function(k){var n={x:null,y:null};k=i(k);if(c.has("css-matrix")){if(k=="none")k="";k=new WebKitCSSMatrix(k);n.x=k.m41;n.y=k.m42}else{var l=RegExp(/matrix/i);if(l.test(k)){l=
RegExp("[, ()]+","g");k=k.split(l);if(k.length>6&&k[0]=="matrix"){n.x=parseInt(k[5]);n.y=parseInt(k[6])}}}return n},applyTranslate:function(k,n,l,j){o(k,n,l,d.u,d.u,d.u,j)},applyScale:function(k,n,l){o(k,d.u,d.u,n,l,d.u,d.u)},applyRotate:function(k,n){o(k,d.u,d.u,d.u,d.u,n,d.u)},getTransform:i,setTransform:m};c.addClass=e;c.removeClass=f;return c.fx});define(["../../../_base/_base/js/base"],function(c){c.math={round:function(a,b){c.isSet(b)||(b=0);var d=Math.pow(10,b);return Math.round(a*d)/d}};return c.math});
define(["../../../_base/_base/js/base","../../../_base/error/js/error","../../../_base/json/js/json"],function(c){var a=c.isSet;c.ux.Event=function(b){this.uId=c.getUId();c.mixin(this,b);this._validateProperties()};c.ux.Event.prototype={preventDefault:function(){this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},dispatch:function(b,d){var e=this.srcEvent,f=e.type;if(a(d))f=d;f=f;var g="HTMLEvents";if(/blur|focus|resize|scroll/i.test(f))g="UIEvent";else if(/click|mouse(down|move|up)/i.test(f))g=
"MouseEvent";else if(/touch(start|move|end|cancel)/i.test(f))g="TouchEvent";var h=document.createEvent(g),i=e.changedTouches;if(g=="HTMLEvents")h.initEvent(f,e.bubbles,e.cancelable);else if(g=="UIEvent")h.initUIEvent(f,e.bubbles,e.cancelable,window,e.detail);else if(g=="MouseEvent"){g=e.screenX;var m=e.screenY,o=e.clientX,k=e.clientY;if(e.initTouchEvent&&i&&i.length>0){i=i[0];g=i.screenX;m=i.screenY;o=i.clientX;k=i.clientY}h.initMouseEvent(f,e.bubbles,e.cancelable,document.defaultView,e.detail,g,
m,o,k,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget)}else g=="TouchEvent"&&h.initTouchEvent(f,e.bubbles,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.touches,e.targetTouches,i,e.scale,e.rotation);b.dispatchEvent(h)},_validateProperties:function(){return true}};return c.ux.Event});
define(["../../../_base/_base/js/base","../../../_base/error/js/error","../../../_base/_feat/js/feat_event","../../event/js/event"],function(c){var a=[],b=c.has.prop,d={start:b("touchstart"),move:b("touchmove"),end:b("touchend"),gesturestart:b("gesturestart"),gesturechange:b("gesturechange"),gestureend:b("gestureend")},e={};for(var f in d)e[d[f]]=f;var g=function(i){var m={};m.x=i.pageX;m.y=i.pageY;m.target=i.target;return m},h=function(i){var m,o=a.length;for(m=0;m<o;m++)if(a[m].domNode==i)return m;
return null};c.ux.touch={addListener:function(i,m,o,k){if(c.isUndefined(d[m])){c.log("[touch] Cannot add listener for unknown eventType: "+m);return false}c.isSet(k)||(k={});if(k===true)k={preventDefault:true};k={preventDefault:k.preventDefault===true?true:false,tracking:k.tracking===false?false:true,captureFlow:k.captureFlow===true?true:false};var n=null,l=h(i);if(l==null){n=new c.ux.touch.Element({domNode:i,tracking:k.tracking});a.push(n)}else n=a[l];if(!n.isListening(m)){if(n.eventHandler==null)n.eventHandler=
function(j){var p=n,q=e[j.type],s={};s.type=q;s.srcEvent=j;s.timestamp=j.timeStamp;s.multitouch=false;if(!s.timestamp)s.timestamp=(new Date).getTime();if(c.has("touch"))if(q=="gesturestart"||q=="gesturechange"||q=="gestureend"){s.target=j.target;s.x=0;s.y=0}else{var r=null;if(q=="end"){if(j.changedTouches&&j.changedTouches.length>0)r=j.changedTouches[0]}else if(j.targetTouches&&j.targetTouches.length>0)r=j.targetTouches[0];else if(j.changedTouches&&j.changedTouches.length>0)r=j.changedTouches[0];
if(r!=null){r=g(r);s.x=r.x;s.y=r.y;s.target=r.target;if(j.touches&&j.touches.length>1)s.multitouch=true}}else{r=g(j);s.x=r.x;s.y=r.y;s.target=r.target}j=new c.ux.Event(s);if(!p.isListening("start")||p.tracking==false)p.tracked=true;else if(q=="start")p.tracked=true;if(p.tracked==true){if(q=="end")p.tracked=false;p.notifyEvent(j)}};n.eventCaptures[m]=k.captureFlow;n.domNode.addEventListener(d[m],n.eventHandler,n.eventCaptures[m])}n.addEventCallback(m,o,k.preventDefault)},removeListener:function(i,
m,o){i=h(i);if(i!=null){i=a[i];i.removeEventCallback(m,o);i.isListening(m)||i.domNode.removeEventListener(d[m],i.eventHandler,i.eventCaptures[m])}},getTouchProperties:g};c.ux.touch.Element=function(i){this.uId=c.getUId();this.tracked=false;this.eventHandler=null;this.eventCaptures={};this._els={};c.mixin(this,i);this._validateProperties()};c.ux.touch.Element.prototype={addEventCallback:function(i,m,o){if(!c.isCallback(m))return false;var k=this._els[i];if(k){i=k.callbacks;var n=i.length;for(o=0;o<
n;o++){var l=i[o];if(m.context==l.context&&m.method==l.method)return false}}else{k={preventDefault:o,callbacks:[]};this._els[i]=k}k.callbacks.push(m);return true},removeEventCallback:function(i,m){if(!c.isCallback(m))return false;var o=this._els[i];if(!o)return false;var k=o.callbacks,n,l=k.length;for(n=0;n<l;n++){var j=k[n];if(m.context==j.context&&m.method==j.method){o.callbacks.splice(n,1);break}}return true},isListening:function(i){if((i=this._els[i])&&i.callbacks.length>0)return true;return false},
notifyEvent:function(i){var m=this._els[i.type];if(m){m.preventDefault==true&&i.preventDefault();m=m.callbacks;for(var o=0;o<m.length;o++)c.call(m[o],i)}},_validateProperties:function(){return true}};return c.ux.touch});
define(["../../../_base/_base/js/base","../../../_base/error/js/error"],function(c){var a=c.isSet,b=c.isArray;c.net.Xhr=function(d){this.uId=c.getUId();this.request={xhrObject:null,params:d};this._create()};c.net.Xhr.prototype={sendData:function(d,e,f,g,h,i){var m=this.request,o=m.xhrObject,k=encodeURIComponent;f=f.toUpperCase();if(!(a(e)&&!b(e))){if(o){var n=null;if(a(e)){var l,j=e.length;for(l=0;l<j;l++){var p=e[l],q=p.name;p=p.value;if(f=="GET")d+=l==0&&d.indexOf("?")==-1?"?"+k(q)+"="+k(p):"&"+
k(q)+"="+k(p);else if(l==0)n=k(q)+"="+k(p);else n+="&"+k(q)+"="+k(p)}}try{o.open(f,d,true);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");if(a(i))if(b(i)){j=i.length;for(l=0;l<j;l++){var s=i[l];o.setRequestHeader(s.name,s.value)}}o.send(n)}catch(r){return false}o.onreadystatechange=function(){if(o.readyState==4){var t=o.status;if(t>=200&&t<400||t==0)a(g)&&c.call(g,m);else a(h)&&c.call(h,m)}}}else return false;return true}},_create:function(){var d=window.XMLHttpRequest;
if(d){var e;try{e=new d}catch(f){e=false}this.request.xhrObject=e}}};c.Xhr=c.net.Xhr;return c.Xhr});
define(["../../../../_base/_base/js/base","../../../../fx/_xy/js/2dfx"],function(c){var a=c.fx.apply,b=null,d=null,e=false;c.ui.xy.layer={visible:false,color:"#000",opacity:0.3,zIndex:998,show:function(){e||this._initDom();b.onclick=function(){var f=c.ui.xy.layer.onclick;c.isSet(f)&&f()};if(!this.visible){a(d,{height:document.body.scrollHeight+"px"});a(b,{display:"block"});this.visible=true}},hide:function(){if(e&&this.visible){a(b,{display:"none"});this.visible=false}},refresh:function(){e&&this.visible&&
a(d,{height:document.body.scrollHeight+"px"})},update:function(){e||this._initDom();a(b,{"z-index":this.zIndex});a(d,{backgroundColor:this.color,opacity:this.opacity})},_initDom:function(){var f=document;b=f.createElement("div");a(b,{position:"absolute",display:"none",top:0,width:"100%","z-index":this.zIndex,"tap-highlight-color":"rgba(0, 0, 0, 0)"});d=f.createElement("div");a(d,{width:"100%",backgroundColor:this.color,opacity:this.opacity});b.appendChild(d);f.body.appendChild(b);e=true}};c.layer=
c.ui.xy.layer;return c.layer});define(["../../../_base/_base/js/base","./feat"],function(c){c=c.has;var a=c.inquireMap;a({"native-geolocation":function(){return!!navigator.geolocation},"native-device-orientation":function(){return"ondeviceorientation"in window},"native-device-motion":function(){return"ondevicemotion"in window}});return c});define(["../../../_base/_base/js/base","./feat"],function(c){c=c.has;var a=c.inquireMap,b=window;a({canvas:function(){return!!b.CanvasRenderingContext2D}});return c});
define(["../../../_amd/core","../../../math/_matrix/js/matrix"],function(c){var a=[];c.fx.set3dTransform=function(e,f,g){if(!b(f))return false;var h;if(g===true)h=c.fx.getTransform(e);g=c.math.createTransformMatrix(h);f=d(f);g.multiply(f);c.fx.setTransform(e,g.getCssMatrix())};c.fx.initComposedTransform=function(e,f){var g;if(f===true)g=c.fx.getTransform(e);g=c.math.createTransformMatrix(g);c.fx.removeComposedTransform(e);a.push({node:e,transforms:[g]})};c.fx.setTransformPart=function(e,f,g){if(!b(g))return false;
if(f<1||f>10)return false;var h,i=a.length;for(h=0;h<i;h++){var m=a[h];if(m.node==e){e=null;if(c.isSet(g))e=d(g);m.transforms[f]=e;break}}};c.fx.applyComposedTransform=function(e,f){var g,h=a.length;for(g=0;g<h;g++){var i=a[g];if(i.node==e){g=i.transforms;h=g[0].clone();var m,o=g.length;for(m=1;m<o;m++){var k=g[m];c.isSet(k)&&h.multiply(k)}if(f===true)i.transforms=[h];c.fx.setTransform(e,h.getCssMatrix());break}}};c.fx.storeComposedTransform=function(e){c.fx.applyComposedTransform(e,true)};c.fx.removeComposedTransform=
function(e){var f,g=a.length;for(f=0;f<g;f++)if(a[f].node==e){a.splice(f,1);break}};var b=function(e){var f=true,g=c.isSet;if(g(e)){var h=["translate","scale","rotate"];if((f=(f=(f=(f=(f=f&&g(e.type))&&h.indexOf(e.type)!=-1)&&g(e.x))&&g(e.y))&&g(e.z))&&e.type=="rotate")f=f&&g(e.angle)}return f},d=function(e){var f=c.math.createTransformMatrix();switch(e.type){case "translate":f.translate(e.x,e.y,e.z);break;case "scale":f.scale(e.x,e.y,e.z);break;case "rotate":f.rotateAxisAngle(e.x,e.y,e.z,e.angle);
break}return f};return c.fx});
define(["../../../_amd/core"],function(c){c.math.radToDeg=function(a){return a*180/Math.PI};c.math.degToRad=function(a){return a*Math.PI/180};c.math.getAngle=function(a,b){var d=Math.abs(b);if(d>a*2)d=a*2;var e=2*a*a;d=Math.acos(-((Math.pow(d,2)-(Math.pow(a,2)+Math.pow(a,2)))/e));if(isNaN(d))d=0;return d};c.math.getAngleBetweenVectors=function(a,b){var d=c.math.getScalarVector(a,b),e=c.math.getNormVector(a)*c.math.getNormVector(b);d=Math.acos(d/e);if(isNaN(d))d=0;return d};c.math.normalizeVector=
function(a){var b=[0,0,0,1],d=c.math.getNormVector(a);if(d<=0)return b;b[0]=a[0]/d;b[1]=a[1]/d;b[2]=a[2]/d;return b};c.math.getNormVector=function(a){a=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];return a=Math.sqrt(a)};c.math.getNormalVector=function(a,b){var d=[0,0,0,1];d[0]=a[1]*b[2]-a[2]*b[1];d[1]=a[2]*b[0]-a[0]*b[2];d[2]=a[0]*b[1]-a[1]*b[0];return d};c.math.getScalarVector=function(a,b){var d=0;return d=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};c.math.getVector=function(a,b){var d=[0,0,0,1];d[0]=b[0]-a[0];d[1]=b[1]-a[1];
d[2]=b[2]-a[2];return d};c.math.multiplyMatrixVector=function(a,b){var d=[0,0,0,1];b[3]||(b[3]=1);d[0]=b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]*a[3];d[1]=b[0]*a[4]+b[1]*a[5]+b[2]*a[6]+b[3]*a[7];d[2]=b[0]*a[8]+b[1]*a[9]+b[2]*a[10]+b[3]*a[11];d[3]=b[0]*a[12]+b[1]*a[13]+b[2]*a[14]+b[3]*a[15];return d};return c.math});
define(["../../../_amd/core"],function(c){c.math.createTransformMatrix=function(a){var b=new c.math.Matrix({});c.isSet(a)&&b.loadCssTransform(a);return b};c.math.Matrix=function(a){this.uId=c.getUId();this._properties=a;this._values=[];this._cssMatrix=null;this._validateProperties()!==false&&this._initProperties()};c.math.Matrix.prototype={scale:function(a,b,d){this._load(this._cssMatrixToValues(this._cssMatrix.scale(a,b,d)))},translate:function(a,b,d){this._load(this._cssMatrixToValues(this._cssMatrix.translate(a,
b,d)))},rotateAxisAngle:function(a,b,d,e){this._load(this._cssMatrixToValues(this._cssMatrix.rotateAxisAngle(a,b,d,e)))},multiply:function(a){a=a.getCssMatrix();var b=this._cssMatrix;if(c.has("css-matrix-stack-inversed")){var d=a;a=b;b=d}this._load(this._cssMatrixToValues(a.multiply(b)))},clone:function(){return new c.math.Matrix({values:this._values})},loadCssTransform:function(a){if(isString(a)){if(a.indexOf("matrix3d")!=-1){a=a.substring(9,a.length-1).split(", ");for(var b=[],d=0;d<a.length;d++)b[d]=
a[d]*1;this._load(b)}}else try{this._load(this._cssMatrixToValues(a))}catch(e){}},getValues:function(){return this._values},getCssMatrix:function(){return this._cssMatrix},_validateProperties:function(){return true},_initProperties:function(){c.isSet(this._properties.values)?this._load(this._properties.values):this._loadIdentity()},_loadIdentity:function(){this._load([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},_load:function(a){if(!c.isSet(a)||a.length!=16)return false;this._values=a;this._cssMatrix=this._valuesToCssMatrix(this._values)},
_valuesToCssMatrix:function(a){var b=new WebKitCSSMatrix;b.m11=a[0];b.m12=a[1];b.m13=a[2];b.m14=a[3];b.m21=a[4];b.m22=a[5];b.m23=a[6];b.m24=a[7];b.m31=a[8];b.m32=a[9];b.m33=a[10];b.m34=a[11];b.m41=a[12];b.m42=a[13];b.m43=a[14];b.m44=a[15];return b},_cssMatrixToValues:function(a){var b=[];b[0]=a.m11;b[1]=a.m12;b[2]=a.m13;b[3]=a.m14;b[4]=a.m21;b[5]=a.m22;b[6]=a.m23;b[7]=a.m24;b[8]=a.m31;b[9]=a.m32;b[10]=a.m33;b[11]=a.m34;b[12]=a.m41;b[13]=a.m42;b[14]=a.m43;b[15]=a.m44;return b}};return c.math});
define(["../../../_amd/core"],function(c){c.ux.gesture={_gestureElements:[],_knownGestures:["two_digits_click","two_digits_press","enlargement","narrowing","rotation","instant_scale","instant_rotation","gesture_end"],TWO_DIGITS_CLICK_MAX_DURATION:350,TWO_DIGITS_PRESS_MIN_DURATION:400,SCALE_MIN_VALUE:0.2,ROTATION_MIN_VALUE:5,listenTo:function(a,b,d,e){if(!this._isGestureKnown(b)){c.log("[gesture] Cannot listen to this unknown gesture: "+b);return false}if(!c.isCallback(d)){c.log("[gesture] Invalid callback: "+
d);return false}var f={preventDefault:false};if(c.isSet(e))f.preventDefault=e===true?true:e.preventDefault===true;e=null;e=this._getGestureElementIndex(a);if(e==null){e=this._createGestureElement(a,f.preventDefault);this._gestureElements.push(e);c.ux.touch.addListener(e.domNode,"start",{context:this,method:"_handleStart",arguments:[e]},{preventDefault:e.preventDefault,tracking:false});c.ux.touch.addListener(e.domNode,"gesturestart",{context:this,method:"_handleGestureStart",arguments:[e]},{preventDefault:e.preventDefault})}else e=
this._gestureElements[e];e.addCallback(b,d)},unlistenTo:function(a,b,d){if(!this._isGestureKnown(b)){c.log("[gesture] Cannot listen to this unknown gesture: "+b);return false}if(!c.isCallback(d)){c.log("[gesture] Invalid callback: "+d);return false}var e=null;a=this._getGestureElementIndex(a);if(a!=null){e=this._gestureElements[a];e.removeCallback(b,d)}},_createGestureElement:function(a,b){return{uId:c.getUId(),domNode:a,preventDefault:b,digits:[],multitouch:false,multitouchStartTime:null,multitouchEndTime:null,
scale:1,rotation:0,gestureHandlers:[],getGestureHandler:function(d){for(var e=0;e<this.gestureHandlers.length;e++)if(this.gestureHandlers[e].gesture==d)return this.gestureHandlers[e];return null},isListening:function(d){return this.getGestureHandler(d)!=null},addCallback:function(d,e){this.isListening(d)?this.getGestureHandler(d).callbacks.push(e):this.gestureHandlers.push({gesture:d,callbacks:[e]})},removeCallback:function(d,e){if(this.isListening(d))for(var f=0;f<this.getGestureHandler(d).callbacks.length;f++){var g=
this.getGestureHandler(d).callbacks[f];if(g.context==e.context&&g.method==e.method){if(this.getGestureHandler(d).callbacks.length==1)for(f=0;f<this.gestureHandlers.length;f++){if(this.gestureHandlers[f].gesture==d){this.gestureHandlers.splice(f,1);break}}else this.getGestureHandler(d).callbacks.splice(f,1);break}}},reset:function(){this.digits=[];this.multitouch=false;this.multitouchEndTime=this.multitouchStartTime=null;this.scale=1;this.rotation=0}}},_isGestureKnown:function(a){return this._knownGestures.indexOf(a)!=
-1},_getGestureElementIndex:function(a){for(var b=0;b<this._gestureElements.length;b++)if(this._gestureElements[b].domNode==a)return b;return null},_notifyGesture:function(a,b,d){if(b.isListening(a)){a=b.getGestureHandler(a).callbacks;for(b=0;b<a.length;b++)c.call(a[b],d)}},_handleStart:function(a,b){b.reset();b.checkTimer&&clearTimeout(b.checkTimer);var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){b.multitouch=true;b.multitouchStartTime=this._getTimeStamp();
b.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));b.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a));c.ux.touch.addListener(b.domNode,"move",{context:this,method:"_handleMove",arguments:[b]},{preventDefault:b.preventDefault});c.ux.touch.addListener(b.domNode,"end",{context:this,method:"_handleEnd",arguments:[b]});b.checkTimer=c.setTimeout(this,"_checkTwoDigitsPressed",this.TWO_DIGITS_PRESS_MIN_DURATION,b)}else{b.multitouch=false;c.ux.touch.removeListener(b.domNode,"move",{context:this,
method:"_handleMove",arguments:[b]});c.ux.touch.removeListener(b.domNode,"end",{context:this,method:"_handleEnd",arguments:[b]})}},_handleMove:function(a,b){var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){b.digits=[];b.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));b.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a))}},_handleEnd:function(a,b){if(b.multitouch==true){var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;
if(d!=2)b.multitouch=false;if(d==0){c.ux.touch.removeListener(b.domNode,"move",{context:this,method:"_handleMove"});c.ux.touch.removeListener(b.domNode,"end",{context:this,method:"_handleEnd"});b.multitouchEndTime=this._getTimeStamp();b.multitouchEndTime-b.multitouchStartTime<this.TWO_DIGITS_CLICK_MAX_DURATION&&this._notifyGesture("two_digits_click",b,{digit1:b.digits[0],digit2:b.digits[1]})}}},_checkTwoDigitsPressed:function(a){a.multitouch==true&&this._notifyGesture("two_digits_press",a,{digit1:a.digits[0],
digit2:a.digits[1]})},_handleGestureStart:function(a,b){c.ux.touch.addListener(b.domNode,"gesturechange",{context:this,method:"_handleGestureChange",arguments:[b]},{preventDefault:b.preventDefault});c.ux.touch.addListener(b.domNode,"gestureend",{context:this,method:"_handleGestureEnd",arguments:[b]});b.gestureStartTime=this._getTimeStamp()},_handleGestureChange:function(a,b){if(b.multitouch==true){var d=a.srcEvent.scale-b.scale,e=a.srcEvent.rotation-b.rotation,f={digit1:b.digits[0],digit2:b.digits[1],
scale:c.math.round(a.srcEvent.scale,2)},g={digit1:b.digits[0],digit2:b.digits[1],rotation:c.math.round(a.srcEvent.rotation,2)};if(Math.abs(d)>this.SCALE_MIN_VALUE){b.scale=a.srcEvent.scale;var h=null;h=d>0?"enlargement":"narrowing";this._notifyGesture(h,b,f)}if(Math.abs(e)>this.ROTATION_MIN_VALUE){b.rotation=a.srcEvent.rotation;this._notifyGesture("rotation",b,g)}this._notifyGesture("instant_scale",b,f);this._notifyGesture("instant_rotation",b,g)}},_handleGestureEnd:function(a,b){c.ux.touch.removeListener(b.domNode,
"gesturechange",{context:this,method:"_handleGestureChange"});c.ux.touch.removeListener(b.domNode,"gestureend",{context:this,method:"_handleGestureEnd"});b.gestureEndTime=this._getTimeStamp();this._notifyGesture("gesture_end",b,{gestureDuration:b.gestureEndTime-b.gestureStartTime})},_getDigit:function(a,b){var d=c.ux.touch.getTouchProperties(a);return{x:d.x,y:d.y,timestamp:b.timestamp,target:d.target}},_getTimeStamp:function(){return(new Date).getTime()}};return c.ux.gesture});
define(["../../../_amd/core"],function(c){c.ux.GestureRecognizer=function(a){this.uId=c.getUId();this._properties=a;this._gestureEndCallback=this._gestureCallback=this._gestureStartCallback=null;this._points=[];this._templates=[];this._isDown=false;this.numTemplates=8;this.numPoint=64;this.squareSize=250;this.origin={x:0,y:0};this.diagonal=Math.sqrt(this.squareSize*this.squareSize+this.squareSize*this.squareSize);this.halfDiagonal=0.5*this.diagonal;this.angleRange=c.ux.GestureRecognizer.prototype.utils.deg2Rad(45);
this.anglePrecision=c.ux.GestureRecognizer.prototype.utils.deg2Rad(2);this.phi=0.5*(-1+Math.sqrt(5));this._domNode=null;if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};c.ux.GestureRecognizer.prototype={utils:{resample:function(a,b){for(var d=c.ux.GestureRecognizer.prototype.utils.pathLength(a)/(b-1),e=0,f=Array(a[0]),g=1;g<a.length;g++){var h=c.ux.GestureRecognizer.prototype.utils.distance(a[g-1],a[g]);if(e+h>=d){e={x:a[g-1].x+(d-e)/h*(a[g].x-a[g-1].x),y:a[g-
1].y+(d-e)/h*(a[g].y-a[g-1].y)};f[f.length]=e;a.splice(g,0,e);e=0}else e+=h}if(f.length==b-1)f[f.length]={x:a[a.length-1].x,y:a[a.length-1].y};return f},indicativeAngle:function(a){var b=c.ux.GestureRecognizer.prototype.utils.centroid(a);return Math.atan2(b.y-a[0].y,b.x-a[0].x)},rotateBy:function(a,b){for(var d=c.ux.GestureRecognizer.prototype.utils.centroid(a),e=Math.cos(b),f=Math.sin(b),g=[],h=0;h<a.length;h++)g[g.length]={x:(a[h].x-d.x)*e-(a[h].y-d.y)*f+d.x,y:(a[h].x-d.x)*f+(a[h].y-d.y)*e+d.y};
return g},scaleTo:function(a,b){for(var d=c.ux.GestureRecognizer.prototype.utils.boundingBox(a),e=[],f=0;f<a.length;f++)e[e.length]={x:a[f].x*(b/d.width),y:a[f].y*(b/d.height)};return e},translateTo:function(a,b){for(var d=c.ux.GestureRecognizer.prototype.utils.centroid(a),e=[],f=0;f<a.length;f++)e[e.length]={x:a[f].x+b.x-d.x,y:a[f].y+b.y-d.y};return e},distanceAtBestAngle:function(a,b,d,e,f,g){for(var h=g*d+(1-g)*e,i=c.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,b,h),m=(1-g)*d+g*e,o=c.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,
b,m);Math.abs(e-d)>f;)if(i<o){e=m;m=h;o=i;h=g*d+(1-g)*e;i=c.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,b,h)}else{d=h;h=m;i=o;m=(1-g)*d+g*e;o=c.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,b,m)}return Math.min(i,o)},distanceAtAngle:function(a,b,d){a=c.ux.GestureRecognizer.prototype.utils.rotateBy(a,d);return c.ux.GestureRecognizer.prototype.utils.pathDistance(a,b.points)},centroid:function(a){for(var b=0,d=0,e=0;e<a.length;e++){b+=a[e].x;d+=a[e].y}b/=a.length;d/=a.length;return{x:b,
y:d}},boundingBox:function(a){for(var b=+Infinity,d=-Infinity,e=+Infinity,f=-Infinity,g=0;g<a.length;g++){if(a[g].x<b)b=a[g].x;if(a[g].x>d)d=a[g].x;if(a[g].y<e)e=a[g].y;if(a[g].y>f)f=a[g].y}return{x:b,y:e,width:d-b,height:f-e}},pathDistance:function(a,b){for(var d=0,e=0;e<a.length;e++)d+=c.ux.GestureRecognizer.prototype.utils.distance(a[e],b[e]);return d/a.length},pathLength:function(a){for(var b=0,d=1;d<a.length;d++)b+=c.ux.GestureRecognizer.prototype.utils.distance(a[d-1],a[d]);return b},distance:function(a,
b){var d=b.x-a.x,e=b.y-a.y;return Math.sqrt(d*d+e*e)},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI}},getDomNode:function(){return this._domNode},_touchStart:function(a){var b=a.x,d=a.y;this._points.length=1;this._points[0]={x:b,y:d};this._isDown=true;this._gestureStartCallback!=null&&c.call(this._gestureStartCallback,a)},_touchMove:function(a){var b=a.x,d=a.y;if(this._isDown)this._points[this._points.length]={x:b,y:d};this._gestureCallback!=null&&c.call(this._gestureCallback,
a)},_touchEnd:function(a){if(this._isDown){if(this._points.length>=10){var b=this._recognize(this._points);c.publish("/gesturerecognizer/events/result",b)}else c.publish("/gesturerecognizer/events/result",{result:null,score:0});this._isDown=false;this._gestureEndCallback!=null&&c.call(this._gestureEndCallback,a)}},_addTemplate:function(a,b){this._templates.push(new this.Template(a,this.numPoint,this.squareSize,this.origin,b))},_recognize:function(a){a=c.ux.GestureRecognizer.prototype.utils.resample(a,
this.numPoint);var b=c.ux.GestureRecognizer.prototype.utils.indicativeAngle(a);a=c.ux.GestureRecognizer.prototype.utils.rotateBy(a,-b);a=c.ux.GestureRecognizer.prototype.utils.scaleTo(a,this.squareSize);a=c.ux.GestureRecognizer.prototype.utils.translateTo(a,this.origin);b=+Infinity;for(var d=0,e=0;e<this._templates.length;e++){var f=c.ux.GestureRecognizer.prototype.utils.distanceAtBestAngle(a,this._templates[e],-this.angleRange,+this.angleRange,this.anglePrecision,this.phi);if(f<b){b=f;d=e}}return{result:this._templates[d].name,
score:1-b/this.halfDiagonal}},_initListeners:function(){c.ux.touch.addListener(this._domNode,"start",{context:this,method:"_touchStart",arguments:null},{preventDefault:true});c.ux.touch.addListener(this._domNode,"move",{context:this,method:"_touchMove",arguments:null},{preventDefault:true});c.ux.touch.addListener(this._domNode,"end",{context:this,method:"_touchEnd",arguments:null},{preventDefault:true})},_initProperties:function(){for(var a=this._properties.templates.length,b=0;b<a;b++)this._addTemplate(this._properties.templates[b].name,
this._properties.templates[b].points);this.numTemplates=a;this._domNode=this._properties.node;if(this._properties&&this._properties.gestureStartCallback)this._gestureStartCallback=this._properties.gestureStartCallback;if(this._properties&&this._properties.gestureCallback)this._gestureCallback=this._properties.gestureCallback;if(this._properties&&this._properties.gestureEndCallback)this._gestureEndCallback=this._properties.gestureEndCallback},_validateProperties:function(){return true},Template:function(a,
b,d,e,f){this.name=a;this.points=c.ux.GestureRecognizer.prototype.utils.resample(f,b);a=c.ux.GestureRecognizer.prototype.utils.indicativeAngle(this.points);this.points=c.ux.GestureRecognizer.prototype.utils.rotateBy(this.points,-a);this.points=c.ux.GestureRecognizer.prototype.utils.scaleTo(this.points,d);this.points=c.ux.GestureRecognizer.prototype.utils.translateTo(this.points,e)}};return c.ux.GestureRecognizer});
define(["../../../_amd/core"],function(c){c.ux.MovementTracker=function(a){this.uId=c.getUId();this._properties=a;this._previousPoint=this._startPoint=this._pointStatement=this._target=null;this._tracking=false;this._acceptEvents=true;this._multitouch=false;this._params={captureFlow:true,preventStart:true,preventMove:false,shiftThreshold:0,trackThresholdX:0,trackThresholdY:0};if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};c.ux.MovementTracker.prototype={updateTrackThresholdX:function(a){if(this._isValidThreshold(a))this._params.trackThresholdX=
a;else this._raisePropertyError("trackThresholdX")},updateTrackThresholdY:function(a){if(this._isValidThreshold(a))this._params.trackThresholdY=a;else this._raisePropertyError("trackThresholdY")},destroy:function(){this._removeListeners()},_validateProperties:function(){return true},_isValidThreshold:function(a){return c.isInteger(a)&&a>=0},_raisePropertyError:function(a){c.log("[MovementTracker] Error: "+a+" missing or invalid")},_initProperties:function(){this._target=$(this._properties.target);
if(this._properties.captureFlow===false)this._params.captureFlow=false;if(this._properties.preventStart===false)this._params.preventStart=false;if(this._properties.preventMove===true)this._params.preventMove=true;if(c.isSet(this._properties.trackThresholdX))this._params.trackThresholdX=this._properties.trackThresholdX;if(c.isSet(this._properties.trackThresholdY))this._params.trackThresholdY=this._properties.trackThresholdY;delete this._properties},_initListeners:function(){c.ux.touch.addListener(this._target,
"start",{context:this,method:"_handleTouchStart"},{preventDefault:this._params.preventStart,captureFlow:this._params.captureFlow});c.ux.touch.addListener(this._target,"move",{context:this,method:"_handleTouchMove"},{preventDefault:this._params.preventMove,captureFlow:this._params.captureFlow});c.ux.touch.addListener(this._target,"end",{context:this,method:"_handleTouchEnd"},{captureFlow:this._params.captureFlow})},_removeListeners:function(){c.ux.touch.removeListener(this._target,"start",{context:this,
method:"_handleTouchStart"});c.ux.touch.removeListener(this._target,"move",{context:this,method:"_handleTouchMove"});c.ux.touch.removeListener(this._target,"end",{context:this,method:"_handleTouchEnd"})},_handleTouchStart:function(a){if(c.ua.isAndroid)if(!this.defered){this.defered=true;if((new Date).getTime()-a.timestamp>100){this._acceptEvents=false;a.preventDefault();var b,d={exec:c.bind(function(){clearTimeout(b);this._acceptEvents=true;this._handleTouchStart(a)},this)};b=c.setTimeout(d,"exec",
0);return}}if(this._acceptEvents!=false){this._multitouch=false;if(a.multitouch==true)this._multitouch=true;else{this._acceptEvents=false;this._pointStatement=[];this._previousPoint=null;this._tracking=false;this._startPoint={x:a.x,y:a.y};d=this._onNewTouch(a);c.publish(d.name,d.params);this._acceptEvents=true}}},_handleTouchMove:function(a){if(this._acceptEvents!=false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);c.publish(a.name,a.params);this._acceptEvents=true}},_handleTouchEnd:function(a){if(this._acceptEvents!=
false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);c.publish(a.name,a.params);this._acceptEvents=true}},_onNewTouch:function(a){if(this._tracking==false)if(this._params.trackThresholdX==0||this._params.trackThresholdY==0)this._tracking=true;else{var b={x:a.x,y:a.y},d=Math.abs(b.x-this._startPoint.x);b=Math.abs(b.y-this._startPoint.y);if(d>this._params.trackThresholdX||b>this._params.trackThresholdY)this._tracking=true}d={name:"/movementtracker/events/notrack",params:{publisher:this,
uxEvent:a,target:this._target}};if(this._tracking==false)return d;if(this._pointStatement.length==0)d.name="/movementtracker/events/mvtbegin";else if(a.type=="move")d.name="/movementtracker/events/mvtchanged";else if(a.type=="end")d.name="/movementtracker/events/mvtstored";this._addTouch(a);d.params.movement=this._getCurrentMovement();return d},_addTouch:function(a){a={x:a.x,y:a.y,timestamp:a.timestamp};var b=0,d=0,e=0,f=0,g=0,h=0;if(this._previousPoint==null){a.duration=0;a.globalDuration=0;b=a.x;
d=a.y}else{b=this._previousPoint.x;d=this._previousPoint.y;e=this._previousPoint.globalDx;f=this._previousPoint.globalDy;g=this._previousPoint.directionX;h=this._previousPoint.directionY;a.duration=a.timestamp-this._previousPoint.timestamp;a.globalDuration=a.duration+this._previousPoint.globalDuration}a.dx=Math.abs(a.x-b);a.dy=Math.abs(a.y-d);a.globalDx=a.dx+e;a.globalDy=a.dy+f;a.directionX=g;a.directionY=h;if(g==0&&this._previousPoint!=null){if(a.x<b)a.directionX=-1;else if(a.x>b)a.directionX=1;
this._previousPoint.directionX=a.directionX}if(h==0&&this._previousPoint!=null){if(a.y<d)a.directionY=-1;else if(a.y>d)a.directionY=1;this._previousPoint.directionY=a.directionY}if(g>0&&a.x+this._params.shiftThreshold<b)a.directionX=-1;else if(g<0&&a.x-this._params.shiftThreshold>b)a.directionX=1;if(h>0&&a.y+this._params.shiftThreshold<d)a.directionY=-1;else if(h<0&&a.y-this._params.shiftThreshold>d)a.directionY=1;this._pointStatement.push(a);this._previousPoint=a},_getCurrentMovement:function(){var a=
this._pointStatement[this._pointStatement.length-1];return{pointStatement:this._pointStatement,duration:a.globalDuration,dx:a.globalDx,dy:a.globalDy}}};return c.ux.MovementTracker});
define(["../../../_amd/core"],function(c){c.ux.window={height:null,width:null,fullHeight:null,fullWidth:null,screenHeight:screen.height,screenWidth:screen.width,orientation:null,_i:null,_V:"vertical",_H:"horizontal",_init:function(){var a=c.bind(this._updateData,this);"onorientationchange"in window?window.addEventListener("orientationchange",a,true):window.addEventListener("resize",a,true);if(c.ua.isAndroid){scrollTo(0,1,0);this._i=setInterval(a,1E3)}else window.addEventListener("scroll",a,true);
a()},_updateData:function(){var a=window.innerWidth,b=window.innerHeight,d=false;if(this.width+2<a||this.width-2>a||this.height+2<b||this.height-2>b)d=true;this._updateSize();this._updateOrientation();d&&c.publish("/window/events/resize",{height:b,width:a,orientation:this.orientation})},_updateSize:function(){this.height=window.innerHeight;this.width=window.innerWidth;try{this.fullHeight=document.body.scrollHeight;this.fullWidth=document.body.scrollWidth}catch(a){}},_updateOrientation:function(){var a;
a=c.isSet(window.orientation)&&c.ua.isIOS?Math.abs(window.orientation)==90?this._H:this._V:this.width>this.height?this._H:this._V;if(a!=this.orientation){this.orientation=a;c.publish("/window/events/orientationchange",{height:this.height,width:this.width,orientation:a})}}};window.addEventListener("DOMContentLoaded",function(){c.ux.window._init()});c.ux.Window=function(){this.getProperties=function(){return{screenWidth:c.ux.window.screenWidth,screenHeight:c.ux.window.screenHeight,width:c.ux.window.width,
height:c.ux.window.height,orientation:c.ux.window.orientation}}};return c.ux.window});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker","../../../../ux/gesture/js/gesture","../../../../ux/window/js/window"],function(c){c.ui.xyz.CoverFlow=function(a){this.uId=c.getUId();this.backgroundColor=this.covers=null;this.fadeEdges=this.displayTitle=this.reflected=false;this.size=0;this.viewportWidth=null;this.handleOrientationChange=this.handleGesture=false;this.coverSpacing=null;this.displayTitleDuration=
0;this._timerTitle=this._lastRenderedIndex=this._middleViewIndex=this._renderer=this._transformsQueue=this._transformations=this._positions=this._movementtracker=this._faderRight=this._faderLeft=this._gestureNode=this._trayNode=this._domNode=this.borderSize=null;this._flipping=this._displayMode=this._dragging=false;this._view={x:0,sizeX:0,shiftX:25,shiftFromMiddle:200,coverRotation:55,coverScale:0.28,zMiddleCover:175,zAroundCover:0,numberOfCoverToRender:5,distanceToCenter:0,distanceFromTop:0,zGestureNode:1E3,
observerRotation:0,currentObserverRotation:0};c.mixin(this,a);if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};c.ui.xyz.CoverFlow.prototype={_Z_INDEX_BACKGROUND:5,_DURATION_BACKTO_BOUND:200,_DURATION_MIDDLE:600,_DURATION_AROUND:300,_DURATION_FLIP:1E3,_TRANSITION_FUNC:"default",_OUTOFBOUND_FRICTIONAL_FORCES:4,_RENDERER_INTERVAL:15,_DELAY_BEFORE_IMAGE_LOADING:50,_PERSPECTIVE:500,_REFLECTION_ATTENUATION:0.6,_DELAY_FOR_TITLE_DISPLAY:400,getDomNode:function(){return this._domNode},
updateSize:function(a,b){this.size=a;this.viewportWidth=b;var d=this._view,e=0.07;if(c.isSet(this.coverSpacing))e=this.coverSpacing*0.0030;d.shiftX=e*a;this._positions=[];var f;e=this.covers;var g=e.length;for(f=0;f<g;f++)this._positions[f]=d.shiftX*f;d.sizeX=this._positions[g-1];d.shiftFromMiddle=0.7*a;f=Math.max(b/a-1,0);d.distanceToCenter=f*(a/2);d.distanceFromTop=a*(d.coverScale/1.5);d=a*(1+f);f=d+"px";var h=a+"px";c.fx.apply(this._domNode,{width:f,height:h});c.fx.apply(this._trayNode,{width:f,
height:h});c.fx.apply(this._gestureNode,{width:f,height:h});for(f=0;f<g;f++){var i=e[f];c.fx.apply(i.coverNode,{width:h,height:h});c.fx.apply(i.coverInnerNode,{width:h,height:h});c.fx.apply(i.imageNode,{width:h,height:h});c.fx.apply(i.coverReflection,{width:h});this.reflected&&c.fx.apply(i.coverReflectionBack,{width:h,height:this._REFLECTION_ATTENUATION*a+"px"});this.displayTitle&&c.fx.apply(i.titleNode,{width:h})}if(this.fadeEdges){e=this._faderLeft;g=this._faderRight;f=b/15;e.width=f;e.height=a;
g.width=f;g.height=a;g.style.left=d-f+1+"px";this._updateEdgeFaders()}this._createTransformations();this._initTransformations();this._slideTo(this._positions[this._currentPosition],true)},setBackgroundColor:function(a){var b=this.backgroundColor=a;a=this.borderSize;var d={r:255-b.r,g:255-b.g,b:255-b.b};b="rgba("+b.r+", "+b.g+", "+b.b+", 1.0)";this._domNode.style.backgroundColor=b;d=a+"px -"+a+"px 6px rgba("+d.r+", "+d.g+", "+d.b+", 0.5)";var e,f=this.covers,g=f.length;for(e=0;e<g;e++){var h=f[e];
if(this.reflected)h.coverReflectionBack.style.backgroundColor=b;c.isSet(a)&&a>0&&c.fx.apply(h.imageNode,{"box-shadow":d})}this.fadeEdges&&this._updateEdgeFaders()},getPosition:function(){return this._currentPosition},setPosition:function(a){this._slideTo(this._positions[a],true)},_validateProperties:function(){return true},_isValidCover:function(a){var b=true;return b=(b=(b=b&&c.isSet(a))&&c.isSet(a.image))&&c.isSet(a.title)},_initProperties:function(){var a=this.position;if(a!==0&&!a)a=Math.floor(this.covers.length/
2);this._currentPosition=a;this._view.x=0;this._middleViewIndex=Math.floor(this._view.numberOfCoverToRender/2);this._lastRenderedIndex=this._currentPosition;this._transformsQueue=[];this.handleOrientationChange===true&&c.subscribe("/window/events/orientationchange",{context:this,method:"_onOrientationChange"})},_initDom:function(){var a=this._domNode=document.createElement("div");c.fx.apply(a,{"user-select":"none"});var b=this._trayNode=document.createElement("div");b.style.position="absolute";a.appendChild(b);
c.fx.apply(b,{"transform-style":"preserve-3d"});var d=this._gestureNode=document.createElement("div");d.style.position="absolute";a.appendChild(d);var e=this.covers,f=e.length;for(d=0;d<f;d++){var g=e[d],h=document.createElement("div"),i=document.createElement("div"),m=document.createElement("div"),o=document.createElement("img"),k=document.createElement("div");m.appendChild(o);m.appendChild(k);i.appendChild(m);h.appendChild(i);b.appendChild(h);h.style.position="absolute";m.style.position="absolute";
g.coverNode=h;g.coverOutlineNode=i;g.coverInnerNode=m;g.imageNode=o;g.coverReflection=k;g.transformation=null;g.diffTransform=true;g.displayed=false;if(this.reflected){h=document.createElement("canvas");i=document.createElement("div");k.appendChild(h);k.appendChild(i);h.style.position="absolute";i.style.position="absolute";g.coverReflectionFront=h;g.coverReflectionBack=i}if(this.displayTitle){h=document.createElement("div");k.appendChild(h);h.style.position="absolute";k=$(g.title);h.appendChild(k);
g.titleNode=h;g.titleInnerNode=k}c.fx.apply(g.coverNode,{perspective:this._PERSPECTIVE,"transform-style":"preserve-3d"});c.fx.apply(g.coverOutlineNode,{"transform-style":"preserve-3d"})}if(this.fadeEdges){b=this._faderLeft=document.createElement("canvas");d=this._faderRight=document.createElement("canvas");a.appendChild(b);a.appendChild(d);b.style.position="absolute";d.style.position="absolute"}this._hideBackFaces();this._organizeDepth();this.updateSize(this.size,this.viewportWidth);this.setBackgroundColor(this.backgroundColor);
c.setTimeout(this,"_setImages",this._DELAY_BEFORE_IMAGE_LOADING)},_initListeners:function(){this._movementtracker=new c.ux.MovementTracker({target:this._gestureNode});c.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});c.subscribe("/movementtracker/events/mvtchanged",{context:this,method:"_handleMovementChanged"});c.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"});if(this.handleGesture){this._gestureNode.listenToGesture("instant_rotation",
{context:this,method:"_handleRotation",arguments:null},{preventDefault:true});this._gestureNode.listenToGesture("gesture_end",{context:this,method:"_handleGestureEnd",arguments:null},{preventDefault:true})}},_handleRotation:function(a){if(this._displayMode==false){var b=this._view;a=b.observerRotation+a.rotation;if(!(a>17||a<-70)){b.currentObserverRotation=a;var d=this.covers,e=d.length;for(a=0;a<e;a++){var f=d[a];c.fx.setTransformPart(f.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:b.currentObserverRotation});
c.fx.applyComposedTransform(f.coverOutlineNode)}}}},_handleGestureEnd:function(){if(this._displayMode==false)this._view.observerRotation=this._view.currentObserverRotation},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId)this._dragging=false},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(!this._displayMode){var b=a.movement;a=b.pointStatement[b.pointStatement.length-1];b=a.x-b.pointStatement[b.pointStatement.length-2].x;b/=2;var d=
this._getBoundsInfos(this._view.x);if(d.outsideOfBounds)if(d.direction>0&&a.directionX>0||d.direction<0&&a.directionX<0)b/=this._OUTOFBOUND_FRICTIONAL_FORCES;this._dragging=true;this._slideTo(this._view.x-b)}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(!this._flipping){var b=this._currentPosition,d=a.movement.pointStatement[a.movement.pointStatement.length-1],e=this._getAbsolutePosition(this._domNode);if(this._displayMode)if(this._onMiddleCover(d.x-
e.x,d.y-e.y)){b=a.uxEvent;b.dispatch(b.target,"click")}else{this._flipping=true;this._unflipCover(b)}else if(this._onMiddleCover(d.x-e.x,d.y-e.y)){a=this.covers[b];if(c.isSet(a.action))c.isCallback(a.action)?c.call(a.action,a):c.log("[CoverFlow] Invalid action for cover : "+b);else if(c.isSet(a.backFaceId)){this._flipping=true;this._prepareCoverBackFace(b);c.setTimeout(this,"_flipCover",1,b)}}}}else this._backToBounds()},_prepareCoverBackFace:function(a){a=this.covers[a];var b=$(a.backFaceId);c.fx.apply(b,
{display:"block",position:"absolute",width:this.size+"px",height:this.size+"px","backface-visibility":"hidden"});c.fx.apply(a.coverInnerNode,{"transform-origin-z":this._view.zMiddleCover+"px","backface-visibility":"hidden"});c.fx.set3dTransform(b,{type:"rotate",x:0,y:1,z:0,angle:180});c.fx.applyTransformTransition(a.coverOutlineNode,"0ms","0ms",this._TRANSITION_FUNC);c.fx.setTransformPart(a.coverOutlineNode,2,{type:"translate",x:0,y:0,z:this._view.zMiddleCover});c.fx.applyComposedTransform(a.coverOutlineNode);
a.coverOutlineNode.appendChild(b)},_flipCover:function(a){var b=this.covers[a];c.fx.onTransitionEnd(b.coverOutlineNode,c.bind(this._postFlipCover,this,a));c.fx.applyTransformTransition(b.coverOutlineNode,this._DURATION_FLIP+"ms","0ms",this._TRANSITION_FUNC);c.fx.setTransformPart(b.coverOutlineNode,1,{type:"rotate",x:0,y:1,z:0,angle:180});c.fx.setTransformPart(b.coverOutlineNode,2,{type:"translate",x:0,y:this._view.distanceFromTop,z:this._view.zMiddleCover*1.5});c.fx.setTransformPart(b.coverOutlineNode,
3,{type:"rotate",x:1,y:0,z:0,angle:0});c.fx.applyComposedTransform(b.coverOutlineNode);this._displayMode=true},_postFlipCover:function(){this._flipping=false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND;c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zMiddleCover/2})},_unflipCover:function(a){var b=this.covers[a];c.fx.setTransformPart(b.coverOutlineNode,1,{type:"rotate",x:0,y:1,z:0,angle:0});c.fx.setTransformPart(b.coverOutlineNode,2,{type:"translate",x:0,y:0,
z:0});c.fx.setTransformPart(b.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:this._view.currentObserverRotation});c.fx.applyComposedTransform(b.coverOutlineNode);c.fx.apply(b.coverInnerNode,{"transform-origin-z":"0px"});c.fx.onTransitionEnd(b.coverOutlineNode,c.bind(this._postUnflipCover,this,a))},_postUnflipCover:function(a){a=this.covers[a];c.fx.applyTransformTransition(a.coverOutlineNode,"0ms","0ms",this._TRANSITION_FUNC);$(a.backFaceId).style.display="none";this._flipping=this._displayMode=
false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND+4;c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},_onOrientationChange:function(a){this.updateSize(this.size,a.width)},_getPosition:function(a){var b=null,d,e=this._positions,f=e.length;for(d=0;d<f;d++){b=d;if(a<e[d]+this._view.shiftX/2)break}return b},_slideTo:function(a,b){var d=this._view,e=c.math.round(a,2);if(e!=d.x||b===true){d.x=e;c.fx.set3dTransform(this._trayNode,{type:"translate",x:-d.x+
d.distanceToCenter,y:-d.distanceFromTop,z:0});this._updateView()}},_updateView:function(){var a=this._getPosition(this._view.x);if(a!=this._currentPosition){this._currentPosition=a;this._addToQueue(this._currentPosition)}},_startRenderer:function(){if(this._renderer==null)this._renderer=c.setTimeout(this,"_rendererProcess",1)},_stopRenderer:function(){if(this._renderer!=null){clearTimeout(this._renderer);this._renderer=null}},_rendererProcess:function(){var a=this._transformsQueue,b=a.length,d=a[0];
if(d.rendering==false){d.rendering=true;a=d.position;c.fx.onTransitionEnd(this.covers[a].coverInnerNode,c.bind(this._handleCoverRendered,this,a));this._updateTransformations(a);d=c.math.round(this._DURATION_MIDDLE/(b*2),0);b=c.math.round(this._DURATION_AROUND/(b*2),0);this._updateTransitions(a,d,b);this._applyTransformations()}else if(d.rendered==true){a.shift();b=a.length;if(b==0){this._stopRenderer();return}}else b>1&&this._handleCoverRendered(d.position);this._renderer=c.setTimeout(this,"_rendererProcess",
this._RENDERER_INTERVAL)},_handleCoverRendered:function(a){this._lastRenderedIndex=a;a=this._transformsQueue;if(a.length!=0)a[0].rendered=true},_addToQueue:function(a){this._transformsQueue.push({timestamp:(new Date).getTime(),position:a,rendered:false,rendering:false});this._startRenderer()},_updateTransformations:function(a){var b=this._middleViewIndex+(Math.abs(this._lastRenderedIndex-a)-1),d=a-b,e=a+(b+1),f=this.covers,g=f.length;if(a<b)d=0;if(e>g)e=g;for(b=0;b<g;b++)f[b].diffTransform=false;
for(b=d;b<e;b++){d=f[b];d.oldTransformation=d.transformation;d.transformation=this._getTargetedTransformation(b,a);d.diffTransform=this._transformationsDifferent(d.oldTransformation,d.transformation)}},_updateTransitions:function(a,b,d){var e,f=this.covers,g=f.length;for(e=0;e<g;e++){var h=f[e];if(h.diffTransform){var i=this._TRANSITION_FUNC;e==a?c.fx.applyTransformTransition(h.coverInnerNode,b+"ms","0ms",i):c.fx.applyTransformTransition(h.coverInnerNode,d+"ms","0ms",i)}}},_applyTransformations:function(){var a=
this._currentPosition,b=this.covers,d=b.length,e=Math.floor(d/2),f;for(f=0;f<d;f++){var g=b[f],h=g.coverNode,i=g.coverInnerNode,m=g.depth1;if(f<e&&f>=a||f>=e&&f<=a)m=g.depth2;if(g.depth!=m){g.depth=m;c.fx.setTransformPart(h,2,{type:"translate",x:this._positions[f],y:0,z:m});c.fx.applyComposedTransform(h)}if(g.diffTransform){c.fx.setTransformPart(i,1,g.transformation.rotation);c.fx.setTransformPart(i,2,g.transformation.translation);c.fx.applyComposedTransform(i);if(this.displayTitle){h=this.displayTitleDuration;
if(f==this._currentPosition)if(h>0){if(c.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}this._timerTitle=c.setTimeout(this,"_showTitle",this._DELAY_FOR_TITLE_DISPLAY,f)}else this._showTitle(f);else{h>0&&c.fx.applyTransition(g.titleNode,"opacity","0ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(f,0)}}}}},_transformationsDifferent:function(a,b){return a.rotation.angle!=b.rotation.angle},_initTransformations:function(){var a=this.covers,b=a.length,d=Math.floor(b/
2),e,f=0,g=b-1+d;for(e=0;e<b;e++){var h=a[e],i=h.coverNode;if(e<=d){f++;g--}else{f--;g++}h.depth1=f;h.depth2=g;c.fx.initComposedTransform(i);c.fx.setTransformPart(i,1,{type:"scale",x:this._view.coverScale,y:this._view.coverScale,z:1});c.fx.initComposedTransform(h.coverOutlineNode);c.fx.initComposedTransform(h.coverInnerNode);h.transformation=this._getTargetedTransformation(e,this._currentPosition)}this._applyTransformations();c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},
_createTransformations:function(){var a=this._view,b=a.coverRotation,d=a.zAroundCover,e=a.shiftFromMiddle;this._transformations={left:{rotation:{type:"rotate",x:0,y:1,z:0,angle:b},translation:{type:"translate",x:-e,y:0,z:d}},middle:{rotation:{type:"rotate",x:0,y:1,z:0,angle:0},translation:{type:"translate",x:0,y:0,z:a.zMiddleCover}},right:{rotation:{type:"rotate",x:0,y:1,z:0,angle:-b},translation:{type:"translate",x:e,y:0,z:d}}}},_getTargetedTransformation:function(a,b){var d=this._transformations;
return a<b?d.left:a>b?d.right:d.middle},_showTitle:function(a){if(c.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}if(a==this._currentPosition){var b=this.displayTitleDuration;b>0&&c.fx.applyTransition(this.covers[a].titleNode,"opacity",b+"ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(a,1)}},_setTitleOpacity:function(a,b){this.covers[a].titleNode.style.opacity=b},_hideBackFaces:function(){var a,b=this.covers,d=b.length;for(a=0;a<d;a++){var e=b[a];if(c.isSet(e.backFaceId))$(e.backFaceId).style.display=
"none"}},_setImages:function(){var a,b=this.covers,d=b.length;for(a=0;a<d;a++){var e=b[a];this.reflected&&this._applyReflection(a);e.imageNode.src=e.image}},_organizeDepth:function(){var a=this._Z_INDEX_BACKGROUND;this._domNode.style.zIndex=a;this._trayNode.style.zIndex=a+1;this._gestureNode.style.zIndex=a+4;if(this.reflected){var b,d=this.covers,e=d.length;for(b=0;b<e;b++){var f=d[b];if(this.displayTitle)f.titleNode.style.zIndex=a+4;f.coverReflectionFront.style.zIndex=a+3;f.coverReflectionBack.style.zIndex=
a+2}}if(this.fadeEdges){this._faderLeft.style.zIndex=a+4;this._faderRight.style.zIndex=a+4}},_applyReflection:function(a){var b=this.covers[a],d=b.imageNode,e=b.coverReflectionFront;b.imageLoadingHandler=c.bind(function(){this._reflect(a,d,e,d.width,d.height)},this);d.addEventListener("load",b.imageLoadingHandler)},_reflect:function(a,b,d,e,f){d.width=e;d.height=f;d=d.getContext("2d");d.save();d.translate(0,f/1.5);d.scale(1,-1);d.drawImage(b,0,0,e,f/1.5);d.restore();d.globalCompositeOperation="destination-out";
var g=d.createLinearGradient(0,0,0,f);g.addColorStop(0,"rgba(255, 255, 255, "+this._REFLECTION_ATTENUATION+")");g.addColorStop(0.6,"rgba(255, 255, 255, 1.0)");d.fillStyle=g;d.fillRect(0,0,e,f);b.removeEventListener("load",this.covers[a].imageLoadingHandler)},_updateEdgeFaders:function(){var a=this.backgroundColor,b=this._faderLeft,d=this._faderRight,e=b.getContext("2d"),f=e.createLinearGradient(0,0,b.width,0);f.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");f.addColorStop(1,"rgba("+a.r+", "+
a.g+", "+a.b+", 0.0)");e.fillStyle=f;e.fillRect(0,0,b.width,b.height);e=d.getContext("2d");f=e.createLinearGradient(0,0,d.width,0);f.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 0.0)");f.addColorStop(1,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");e.fillStyle=f;e.fillRect(0,0,d.width,d.height)},_backToBounds:function(){var a=this._getBoundsInfos(this._view.x);if(a.outsideOfBounds){this._slideTo(a.positionOfBound,this._DURATION_BACKTO_BOUND);return true}return false},_getBoundsInfos:function(a){var b=
this._view,d={};d.outsideOfBounds=false;if(a<0||a>b.sizeX){d.outsideOfBounds=true;if(a<0){d.distanceToBound=Math.abs(a);d.direction=1;d.positionOfBound=0}else{d.distanceToBound=Math.abs(a-b.sizeX);d.direction=-1;d.positionOfBound=b.sizeX}}return d},_onMiddleCover:function(a,b){var d=this._view,e=this.size,f=c.math.round,g=f(e*d.coverScale*1.5,0),h=f(e/2-g/2-d.distanceFromTop,0),i=f(e/2-g/2+d.distanceToCenter,0),m=h+g;g=i+g;if(this._displayMode){g=f(e*d.coverScale*2.1,0);h=f(e/2-g/2-d.distanceFromTop/
2.1,0);i=f(e/2-g/2+d.distanceToCenter,0);m=h+g;g=i+g}if(a>=i&&a<=g&&b>=h&&b<=m)return true;return false},_getAbsolutePosition:function(a){for(var b={x:0,y:0},d=a;d&&d!=document.body;){var e=c.fx.getTransformPosition(d);b.x+=e.x;b.y+=e.y;d=d.parentNode}return{x:a.getLeftPosition()+b.x,y:a.getTopPosition()+b.y}}};return c.ui.xyz.CoverFlow});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker"],function(c){c.ui.xyz.Cube=function(a){this.uId=c.getUId();this._properties=a;this._axis=this._faces=null;this._view={size:0,shiftX:0,shiftY:0,shiftZ:0,observerX:0,observerY:0,rotationX:0,rotationY:0,externalRotationX:0,externalRotationY:0};this._selectionEvent=this._radius=this._movementtracker=this._domNode=this._rotationEndCallback=this._rotationCallback=
this._dispatch=this._focusDuration=this._focus=null;this._dragging=false;this._nearestFace=this._rotations=null;if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};c.ui.xyz.Cube.prototype={getDomNode:function(){return this._domNode},rotate:function(a,b,d){this._view.externalRotationX=c.math.round((this._view.externalRotationX+a)%360,3);this._view.externalRotationY=c.math.round((this._view.externalRotationY+b)%360,3);this._rotateWithDuration(a,b,d)},
faceFocus:function(a){this._faceFocus(a)},setFace:function(a){var b=a.id-1;this._faces[b].faceNode.removeChild(this._faces[b].innerNode);for(var d in a)this._faces[b][d]=a[d];this._faces[b].innerNode=$(this._faces[b].faceId);this._faces[b].faceNode.appendChild(this._faces[b].innerNode)},_validateProperties:function(){return true},_raisePropertyError:function(a){c.log("[Cube] Error: "+a+" missing or invalid")},_isValidFace:function(a){var b=true;return b=(b=(b=(b=b&&c.isSet(a))&&c.isSet(a.id))&&c.isSet(a.faceId))&&
a.id>0&&a.id<7},_initProperties:function(){this._faces=[].concat(this._properties.faces);this._view.size=this._properties.size;this._radius=this._view.size/2;this._axis=null;if(c.isSet(this._properties.axis)&&(this._properties.axis=="x"||this._properties.axis=="y"||this._properties.axis=="xy"))this._axis=this._properties.axis;if(c.isSet(this._view.shiftX))this._view.shiftX=this._properties.shiftX;if(c.isSet(this._view.shiftY))this._view.shiftY=this._properties.shiftY;if(c.isSet(this._properties.shiftZ))this._view.shiftZ=
this._properties.shiftZ;this._view.observerX=this._radius;if(c.isSet(this._properties.observerX))this._view.observerX=this._properties.observerX;this._view.observerY=this._radius;if(c.isSet(this._properties.observerY))this._view.observerY=this._properties.observerY;this._focus=false;if(this._properties.focus===true)this._focus=true;this._focusDuration=0;if(c.isSet(this._properties.focusDuration)&&this._properties.focusDuration>0)this._focusDuration=this._properties.focusDuration;this._dispatch=false;
if(this._properties.dispatch===true)this._dispatch=true;this._rotationCallback=null;if(c.isSet(this._properties.rotationCallback))this._rotationCallback=this._properties.rotationCallback;this._rotationEndCallback=null;if(c.isSet(this._properties.rotationEndCallback))this._rotationEndCallback=this._properties.rotationEndCallback},_initDom:function(){this._domNode=document.createElement("div");c.fx.apply(this._domNode,{position:"absolute","user-select":"none",perspective:800,"perspective-origin":this._view.observerX+
"px "+this._view.observerY+"px",width:this._view.size+"px",height:this._view.size+"px",left:this._view.shiftX+"px",top:this._view.shiftY+"px"});this._cubeNode=document.createElement("div");c.fx.apply(this._cubeNode,{"transform-style":"preserve-3d",width:this._view.size+"px",height:this._view.size+"px"});this._domNode.appendChild(this._cubeNode);for(var a=0;a<this._faces.length;a++){var b=this._faces[this._faces[a].id-1];b.faceNode=document.createElement("div");c.fx.apply(b.faceNode,{position:"absolute",
width:this._view.size+"px",height:this._view.size+"px"});b.innerNode=$(b.faceId);this._cubeNode.appendChild(b.faceNode);b.faceNode.appendChild(b.innerNode)}this._initTransformations()},_initListeners:function(){if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=null){this._movementtracker=new c.ux.MovementTracker({target:this._domNode});c.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});c.subscribe("/movementtracker/events/mvtchanged",
{context:this,method:"_handleMovementChanged"});c.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"})}},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId){this._dragging=false;this._selectionEvent=a.uxEvent;c.fx.applyTransformTransition(this._cubeNode,"0ms","0ms","linear")}},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=
null){a=a.movement;var b=a.pointStatement[a.pointStatement.length-2],d=a.pointStatement[a.pointStatement.length-1];a=d.x-b.x;b=d.y-b.y;d=c.math.getAngle(this._view.size,a);if(a<0)d=-d;a=c.math.getAngle(this._view.size,b);if(b<0)a=-a;this._dragging=true;b=c.math.round(c.math.radToDeg(d),3);a=c.math.round(c.math.radToDeg(a),3);this._rotate(b,a);this._view.externalRotationX=c.math.round((this._view.externalRotationX+b)%360,3);this._view.externalRotationY=c.math.round((this._view.externalRotationY+a)%
360,3);this._notifyRotation({x:b,y:a})}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(this._dispatch&&c.isSet(this._selectionEvent)){this._selectionEvent.dispatch(this._selectionEvent.target,"click");this._selectionEvent=null}}else{this._storeRotation();this._notifyRotationEnd({x:this._view.externalRotationX,y:this._view.externalRotationY});this._view.externalRotationX=0;this._view.externalRotationY=0;this._focus==true&&this._faceFocus(this._focusDuration)}},
_notifyRotation:function(a){this._rotationCallback!=null&&c.call(this._rotationCallback,a)},_notifyRotationEnd:function(a){this._rotationEndCallback!=null&&c.call(this._rotationEndCallback,a)},_rotateWithDuration:function(a,b,d){c.fx.applyTransformTransition(this._cubeNode,d+"ms","0ms","linear");this._rotate(a,b,true);this._storeRotation()},_faceFocus:function(a){this._updateNearestFace();c.fx.removeComposedTransform(this._cubeNode);c.fx.initComposedTransform(this._cubeNode);this._view.rotationX=
0;this._view.rotationY=0;this._storeRotation();this._initNormalVectors();var b=this._rotations[this._nearestFace.index];this.rotate(b.y*-b.angle,b.x*b.angle,a)},_updateNearestFace:function(){this._nearestFace={index:0,angle:0};for(var a=0;a<6;a++)if(this._faces[a].angle>this._nearestFace.angle){this._nearestFace.index=a;this._nearestFace.angle=this._faces[a].angle}},_initTransformations:function(){this._rotations=[];this._rotations[0]={type:"rotate",x:1,y:0,z:0,angle:0};this._rotations[1]={type:"rotate",
x:0,y:1,z:0,angle:90};this._rotations[2]={type:"rotate",x:0,y:1,z:0,angle:180};this._rotations[3]={type:"rotate",x:0,y:1,z:0,angle:-90};this._rotations[4]={type:"rotate",x:1,y:0,z:0,angle:90};this._rotations[5]={type:"rotate",x:1,y:0,z:0,angle:-90};this._initNormalVectors();for(var a=0;a<this._faces.length;a++){c.fx.initComposedTransform(this._faces[a].faceNode);c.fx.setTransformPart(this._faces[a].faceNode,1,{type:"translate",x:0,y:0,z:this._radius});c.fx.setTransformPart(this._faces[a].faceNode,
2,this._rotations[a]);c.fx.applyComposedTransform(this._faces[a].faceNode)}c.fx.initComposedTransform(this._cubeNode);c.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});c.fx.applyComposedTransform(this._cubeNode)},_rotate:function(a,b,d){if(this._axis=="y"||this._axis=="xy"||d){this._view.rotationX=c.math.round((this._view.rotationX+a)%360,3);c.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX})}if(this._axis=="x"||this._axis==
"xy"||d){this._view.rotationY=c.math.round((this._view.rotationY-b)%360,3);c.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY})}c.fx.applyComposedTransform(this._cubeNode)},_storeRotation:function(){c.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX});c.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY});c.fx.setTransformPart(this._cubeNode,3,null);c.fx.storeComposedTransform(this._cubeNode);
c.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});c.fx.applyComposedTransform(this._cubeNode);this._updateNormalVectors();this._view.rotationX=0;this._view.rotationY=0},_initNormalVectors:function(){for(var a=[0,0,1],b=0;b<6;b++){var d=c.math.createTransformMatrix();d.rotateAxisAngle(this._rotations[b].x,this._rotations[b].y,this._rotations[b].z,-this._rotations[b].angle);this._faces[b].normalVector=c.math.multiplyMatrixVector(d.getValues(),a)}},_updateNormalVectors:function(){for(var a=
[0,0,-1],b=0;b<6;b++){var d=c.math.createTransformMatrix();d.rotateAxisAngle(0,1,0,-this._view.rotationX);d.rotateAxisAngle(1,0,0,-this._view.rotationY);this._faces[b].normalVector=c.math.multiplyMatrixVector(d.getValues(),this._faces[b].normalVector);d=c.math.getAngleBetweenVectors(a,this._faces[b].normalVector);this._faces[b].angle=c.math.radToDeg(d)}}};return c.ui.xyz.Cube});

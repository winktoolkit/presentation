define=function(){if(typeof wink=="undefined")wink={};var b=arguments,a=b.length;return(a==1?b[0]:a==2?b[1]:b[2])(wink)};define.amd={vendor:"winktoolkit.org"};define(function(){if(typeof wink=="undefined")wink={};return wink});
define(["../../_kernel/js/kernel"],function(b){b.version="1.4.1";b.api={};b.mm={};b.net={};b.plugins={};b.ui={form:{},layout:{},xy:{},xyz:{}};b.ux={};var a=Array.prototype.slice,c=window;b.byId=function(g){return b.isString(g)?document.getElementById(g):g};b.query=function(g,e){return a.call((e||document).querySelectorAll(g))};var d="en_EN";b.setLocale=function(g){d=g};b.translate=function(g,e){var h=g,i=window.i18n||{};if(b.isSet(e)&&b.isSet(e.i18n))i=e.i18n;var j=i[d];if(b.isUndefined(j))j=i;i=
j[g];b.isUndefined(i)||(h=i);return h};b.isUndefined=function(g){return g===undefined};b.isNull=function(g){return g===null};b.isSet=function(g){return!b.isUndefined(g)&&!b.isNull(g)};b.isCallback=function(g){return!!(g&&g.method)};b.isString=function(g){return typeof g=="string"||g instanceof String};b.isInteger=function(g){return parseInt(g)===g};b.isNumber=function(g){return typeof g=="number"||g instanceof Number};b.isArray=function(g){return typeof g=="array"||g instanceof Array};b.isBoolean=
function(g){return typeof g=="boolean"||g instanceof Boolean};b.isFunction=function(g){return Object.prototype.toString.call(g)==="[object Function]"};b.trim=function(g){return g.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};b.bind=function(g,e){var h=a.call(arguments,2);return function(){var i=h.concat(a.call(arguments,0));return g.apply(e,i)}};b.call=function(g,e){var h=c,i=g.method,j=[];if(b.isSet(g.context))h=g.context;if(arguments.length==2)j=[e];if(b.isSet(g.arguments)){var o=g.arguments;b.isArray(o)||
(o=[g.arguments]);j=j.concat(o)}return h[i].apply(h,j)};b.connect=function(g,e,h){if(!b.isSet(h.context))h.context=c;var i=g[e];if(b.isNull(i)||b.isUndefined(i.cbs)){var j=function(){var m=arguments.callee.target,n=[],l,k=arguments.length;for(l=0;l<k;l++){var p=arguments[l];n=b.isArray(p)?n.concat([p]):n.concat(p)}m&&m.apply(g,n);m=g[e].cbs;for(var q in m)b.isArray(m[q].arguments)?b.call({context:m[q].context,method:m[q].method,arguments:n.concat(m[q].arguments)}):b.call({context:m[q].context,method:m[q].method,
arguments:n.concat([m[q].arguments])})};j.target=i;j.cbs=[];i=g[e]=j}for(var o in i.cbs)if(i.cbs[o].context==h.context&&i.cbs[o].method==h.method)return;i.cbs.push(h)};b.disconnect=function(g,e,h){if(!b.isSet(h.context))h.context=c;g=g[e];if(!b.isUndefined(g.cbs))for(var i in g.cbs)g.cbs[i].context==h.context&&g.cbs[i].method==h.method&&delete g.cbs[i]};b.setTimeout=function(g,e,h){var i=a.call(arguments,3);return setTimeout(function(){g[e].apply(g,i)},h)};b.setInterval=function(g,e,h){var i=a.call(arguments,
3);return setInterval(function(){g[e].apply(g,i)},h)};var f=100;b.getUId=function(){return f+=1};if(b.isUndefined(c._))_=b.bind(b.translate,b);if(b.isUndefined(c.$$))$$=b.bind(b.query,b);if(b.isUndefined(c.$))$=b.bind(b.byId,b);return b});
define(["../../../_base/_base/js/base"],function(b){var a=HTMLElement.prototype,c=b.isUndefined,d=function(m,n){for(var l={x:0,y:0},k=this;k&&k!=m;){l.x+=k.offsetLeft;l.y+=k.offsetTop;if(n){l.x+=b.fx.getTransformPosition(k).x;l.y+=b.fx.getTransformPosition(k).y}k=k.offsetParent}return l},f=function(m,n){return this.getPosition(m,n).y},g=function(m,n){return this.getPosition(m,n).x},e=function(m,n,l){b.fx.applyTranslate(this,m,n,l)},h=function(m,n){b.fx.applyScale(this,m,n)},i=function(m){b.fx.applyRotate(this,
m)},j=function(m,n,l){b.ux.gesture.listenTo(this,m,n,l)},o=function(m,n){b.ux.gesture.unlistenTo(this,m,n)};a.winkGetPosition=d;a.winkGetTopPosition=f;a.winkGetLeftPosition=g;a.winkTranslate=e;a.winkScale=h;a.winkRotate=i;a.winkListenToGesture=j;a.winkUnlistenToGesture=o;if(c(a.getPosition))a.getPosition=d;if(c(a.getTopPosition))a.getTopPosition=f;if(c(a.getLeftPosition))a.getLeftPosition=g;if(c(a.rotate))a.rotate=i;if(c(a.scale))a.scale=h;if(c(a.translate))a.translate=e;if(c(a.listenToGesture))a.listenToGesture=
j;if(c(a.unlistenToGesture))a.unlistenToGesture=o;return b});define(["../../../_base/_base/js/base"],function(b){b.error={logLevel:0,log:function(a){if(this.logLevel==1)typeof console!="undefined"?console.log(a):alert(a)}};b.log=b.bind(b.error.log,b.error);return b.error});
define(["../../../_base/_base/js/base"],function(b){var a=window.JSON;b.json={parse:function(c){if(b.isSet(a)&&b.isSet(a.parse))return a.parse(c);else{var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;c=String(c);d.lastIndex=0;if(d.test(c))c=c.replace(d,function(g){return"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))var f=eval("("+c+")");return f}},concat:function(c,d){for(var f in d)c[f]=d[f];return c}};b.parseJSON=b.bind(b.json.parse,b.json);b.mixin=b.bind(b.json.concat,b.json);return b.json});
define(["../../../_base/_base/js/base","../../error/js/error"],function(b){function a(g,e){if(b.isCallback(e)){var h=[g.toLowerCase(),e];f.push(h)}}function c(g,e){var h=g.toLowerCase(),i,j=f.length;for(i=0;i<j;i++){var o=f[i];if(o[0]==h&&o[1].method==e.method&&o[1].context==e.context){f.splice(i,1);break}}}function d(g,e){var h=g.toLowerCase(),i,j=f.length;for(i=0;i<j;i++){var o=f[i];o&&o[0]==h&&b.isSet(o[1])&&b.call(o[1],e)}}var f=[];b.topics={_getTopics:function(){return f}};b.topics.subscribe=
a;b.topics.unsubscribe=c;b.topics.publish=d;b.publish=d;b.subscribe=a;b.unsubscribe=c;return b.topics});
define(["../../../_base/_base/js/base"],function(b){var a,c,d,f,g,e,h,i,j,o,m,n,l,k,p,q,r,s,t,u,w,z,D,E;a=c=d=f=g=e=h=i=w=z=D=E=false;j=o=m=n=l=k=p=q=r=0;var B=b.isSet;c=function(v,A){return RegExp(v).test(A)};var y=function(v,A,x){var C={v:0,r:0,u:0};v=RegExp(A).exec(v);if(B(v)&&v.length>1){v=v[2];A=RegExp("[^\\"+x+"0-9]").exec(v);if(B(A))v=v.slice(0,A.index);x=v.split(x);if(x.length>0)C.v=x[0];if(x.length>1)C.r=x[1];if(x.length>2)C.u=x[2];if(x.length>3)C.u+="."+x[3]}return C};a=navigator||{};s=
a.userAgent;t=a.platform;u=a.appVersion;a=c(" AppleWebKit/",s);z=c(/bada/gi,s);D=c(/Opera/gi,s);if(B(t)){if(c(/iphone/i,t))d=true;if(c(/ipod/i,t))f=true;if(c(/ipad/i,t))g=true;if(c(/blackberry/i,t))w=true}if(B(u)){if(c(/android/i,u))e=true;if(c(/safari/i,u)){h=true;t=y(u,"( Version/)([^ ]+)",".");n=t.v;l=t.r;k=t.u}if(c(/MSIE/i,u)){E=true;t=y(u,"( MSIE )([^ ]+)",".");n=t.v;l=t.r}}if(!h&&!a)i=c(/mozilla/i,s);c=d||f||e||w||z||c(" Mobile/",s);if(a){t=y(s,"( AppleWebKit/)([^ ]+)",".");j=t.v;o=t.r;m=t.u}if(c&&
B(u)){p=e?["( Android )([^ ]+)","."]:["( OS )([^ ]+)","_"];if(w)p=["( BlackBerry )([^ ]+)","."];y=y(u,p[0],p[1]);p=y.v;q=y.r;r=y.u}b.ua={isWebkit:a,isMobile:c,isIPhone:d,isIPod:f,isIPad:g,isIOS:d||f||g,isAndroid:e,isBlackBerry:w,isBada:z,isOpera:D,isSafari:h,isMozilla:i,isIE:E,webkitVersion:j,webkitMinorVersion:o,webkitUpdateVersion:m,browserVersion:n,browserMinorVersion:l,browserUpdateVersion:k,osVersion:p,osMinorVersion:q,osUpdateVersion:r};return b.ua});
define(["../../../_base/_base/js/base"],function(b){function a(e){if(g(d[e]))d[e]=d[e]();return d[e]}function c(e,h,i){if(typeof d[e]=="undefined"){var j=h;if(i&&g(h))j=h();d[e]=j}}var d={},f={},g=b.isFunction;b.has=a;b.has.prefixes=["-webkit-","-moz-","-o-","ms-","-khtml-"];b.has.prefix=null;b.has.inquire=c;b.has.inquireMap=function(e,h){if(!(!e||e.length==0))for(var i in e)c(i,e[i],h)};b.has.setProp=function(e,h){f[e]=h};b.has.deferProp=function(e,h){f[e]=g(h)?h:function(){a(h)}};b.has.prop=function(e){var h=
f[e];if(g(h)){h();h=f[e];if(g(h))h=e}return h||e};return b.has});define(["../../../_base/_base/js/base","./feat"],function(b){b=b.has;var a=b.inquire,c=window;a("json-parse",function(){var d;d=false;if(c.JSON&&typeof JSON.parse=="function"){d=JSON.parse('{"w":1}');d=!!(d&&d.w)}return d});return b});
define(["../../../_base/_base/js/base","./feat"],function(b){function a(k){var p=false;if(typeof o[k]==n){g(k,k);p=true}else{var q=d.prefix;q=q!=null?[q]:m;var r,s=q.length;for(r=0;r<s;r++){var t,u=q[r]+k;t=u;var w=/(-)([a-z])/;for(u=u.match(w);u!=null;){t=t.replace(w,RegExp.$2.toUpperCase());u=t.match(w)}t=t;if(typeof o[t]==n){d.prefix=q[r];g(k,t);p=true;break}}}return p}function c(k){return function(){a(k)}}var d=b.has,f=d.inquireMap,g=d.setProp,e=d.deferProp,h=window,i=h.document,j=i.createElement("div"),
o=j.style,m=d.prefixes,n="string",l={a:"transform-property",b:"transition-property",c:"transition-duration",d:"transition-delay",e:"transition-timing-function",f:"border-radius",g:"text-shadow",h:"box-shadow",i:"gradient",j:"perspective",k:"transform-origin",l:"transform-style",m:"transform",n:"css-transition",o:"css-perspective",p:"css-transform",q:"perspective-origin",r:"backface-visibility",s:"tap-highlight-color",t:"user-select",bg:"background-image"};e(l.a,l.p);e(l.m,l.p);e(l.b,l.n);e(l.c,l.n);
e(l.d,l.n);e(l.e,l.n);e(l.f,"css-border-radius");e(l.g,"css-text-shadow");e(l.h,"css-box-shadow");e(l.i,"css-gradient");e(l.j,l.o);e(l.k,l.o);e(l.l,l.o);e(l.q,l.o);e(l.r,c(l.r));e(l.s,c(l.s));e(l.t,c(l.t));f({"css-transform":function(){var k=a(l.m),p=d.prefix,q=l.m;if(p!=null)q=p+q;k?g(l.a,d.prop(l.m)):g(l.a,l.m);g(l.m,q);return k},"css-transition":function(){var k=true;return k=(k=(k=(k=k&&a(l.b))&&a(l.c))&&a(l.d))&&a(l.e)},"css-translate3d":function(){return d("css-matrix")},"css-border-radius":function(){return a(l.f)},
"css-text-shadow":function(){return a(l.g)},"css-box-shadow":function(){return a(l.h)},"css-gradient":function(){var k=l.i,p=l.bg,q=d.prefix;q=q!=null?["",q]:[""].concat(m);var r,s=q.length;for(r=0;r<s;r++){var t=q[r]+k;o.cssText=p+":"+(t+"(linear,left top,right bottom,from(#9f9),to(white));");if(o[p]&&o[p].indexOf(k)!=-1){g(k,t);return true}}return false},"css-perspective":function(){var k=a(l.j)&&a(l.k)&&a(l.l)&&a(l.q);k=k&&a(l.k+"-x")&&a(l.k+"-y")&&a(l.k+"-z");if(!k)return false;var p=d.prefix||
"";k=i.createElement("style");k.textContent="@media ("+p+"transform-3d){#wink_has{height:2px}}";i.getElementsByTagName("head")[0].appendChild(k);j.id="wink_has";i.documentElement.appendChild(j);p=j.offsetHeight===2;k.parentNode.removeChild(k);j.parentNode.removeChild(j);return p},"css-matrix":function(){var k=h.WebKitCSSMatrix;if(typeof k=="undefined")return false;var p=new k("matrix(1,0,0,1,6,7)"),q=p.m41==6&&p.m42==7&&p.m41==p.e&&p.m42==p.f;if(q){k=new k("matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,6,7,8,1)");
q=q&&p.m41==k.m41&&p.m42==k.m42&&k.m43==8}return q},"css-matrix-stack-inversed":function(){var k=b.ua;if(!d("css-matrix")||!k)return false;var p=k.isIOS?parseInt(""+k.osVersion+k.osMinorVersion+k.osUpdateVersion):500;k=k.isAndroid?parseInt(""+k.osVersion+k.osMinorVersion+k.osUpdateVersion):300;return p<421||k<300},"css-position-fixed":function(){var k=b.ua;if(k.isAndroid&&k.osVersion==2&&k.osMinorVersion==1||k.isBada)return false;if(k.isIOS)return k.osVersion<5?false:true;k=document.body;if(document.createElement&&
k&&k.appendChild&&k.removeChild){if(!j.getBoundingClientRect)return null;j.innerHTML="x";j.style.cssText="position:fixed;top:100px;";k.appendChild(j);var p=k.style.height,q=k.scrollTop;k.style.height="3000px";k.scrollTop=500;var r=j.getBoundingClientRect().top;k.style.height=p;p=r===100;k.removeChild(j);k.scrollTop=q;return p}return false}});return d});
define(["../../../_base/_base/js/base","./feat"],function(b){function a(h){return"on"+e[h]in g}var c=b.has;b=c.inquireMap;var d=c.setProp,f=c.deferProp,g=window.document.documentElement,e={ts:"touchstart",tm:"touchmove",te:"touchend",gs:"gesturestart",gc:"gesturechange",ge:"gestureend",tre:"transitionend"};f(e.ts,e.ts);f(e.tm,e.tm);f(e.te,e.te);f(e.tre,e.tre);b({touchstart:function(){var h=a("ts");d(e.ts,h?e.ts:"mousedown");return h},touchmove:function(){var h=a("tm");d(e.tm,h?e.tm:"mousemove");return h},
touchend:function(){var h=a("te");d(e.te,h?e.te:"mouseup");return h},touch:function(){return c(e.ts)&&c(e.tm)&&c(e.te)},gesturestart:function(){return a("gs")},gesturechange:function(){return a("gc")},gestureend:function(){return a("ge")},gesture:function(){return c(e.gs)&&c(e.gc)&&c(e.ge)},transitionend:function(){if(c("css-transition")){var h=c.prefix,i=e.tre;if(h=="-webkit-")i="webkitTransitionEnd";else if(h=="-o-")i="oTransitionEnd";d(e.tre,i);return true}return false}});return c});
define(["../../../_base/_base/js/base","./feat"],function(b){return b.has});
define(["../../../_base/_base/js/base","../../../_base/_feat/js/feat_css"],function(b){function a(m,n){var l=m.className;if((" "+l+" ").indexOf(" "+n+" ")<0)m.className=l+(l?" ":"")+n}function c(m,n){var l=b.trim((" "+m.className+" ").replace(" "+n+" "," "));if(m.className!=l)m.className=l}function d(m,n){var l,k=m.style;for(l in n){var p=i(l);k[p]=n[l]}}function f(m,n,l,k,p){var q=n;if(n.indexOf(",")==-1)q=i(n);else{n=n.split(",");var r=n.length;for(q=0;q<r;q++)n[q]=i(b.trim(n[q]));q=n.join(",")}d(m,
{"transition-property":q,"transition-duration":l,"transition-delay":k,"transition-timing-function":p})}function g(m){return window.getComputedStyle(m)[i("transform-property")]}function e(m,n){d(m,{"transform-property":n})}var h=b.isSet,i=b.has.prop,j={u:undefined};b.fx={};b.fx.addClass=a;b.fx.removeClass=c;b.fx.apply=d;b.fx.applyTransition=f;b.fx.applyTransformTransition=function(m,n,l,k){f(m,"transform",n,l,k)};b.fx.onTransitionEnd=function(m,n,l){var k=i("transitionend"),p=function(q){l!==true&&
m.removeEventListener(k,p,false);n(q)};m.addEventListener(k,p,false);return p};b.fx.getTransformPosition=function(m){var n={x:null,y:null};m=g(m);if(b.has("css-matrix")){if(m=="none")m="";m=new WebKitCSSMatrix(m);n.x=m.m41;n.y=m.m42}else{var l=RegExp(/matrix/i);if(l.test(m)){l=RegExp("[, ()]+","g");m=m.split(l);if(m.length>6&&m[0]=="matrix"){n.x=parseInt(m[5]);n.y=parseInt(m[6])}}}return n};b.fx.applyTranslate=function(m,n,l,k){o(m,n,l,j.u,j.u,j.u,k)};b.fx.applyScale=function(m,n,l){o(m,j.u,j.u,n,
l,j.u,j.u)};b.fx.applyRotate=function(m,n){o(m,j.u,j.u,j.u,j.u,n,j.u)};b.fx.getTransform=g;b.fx.setTransform=e;var o=function(m,n,l,k,p,q,r){var s=m._cssT||{};s=m._cssT={t:h(n)||h(l)?{tx:n,ty:l}:s.t,s:h(k)||h(p)?{sx:k,sy:p}:s.s,r:h(q)?{a:q}:s.r};k=s.t&&(h(s.t.tx)||h(s.t.ty));l=s.s&&(h(s.s.sx)||h(s.s.sy));n=s.r&&h(s.r.a);if(!b.has("css-translate3d")||b.ua.isAndroid&&(l||n))r=true;if(k){p=s.t.ty;r=r;k="";k=s.t.tx;h(k)||(k=0);p=p;h(p)||(p=0);q="0";var t=false;t=(t=t||b.isString(k)&&k.indexOf("%",0)!=
-1)||b.isString(p)&&p.indexOf("%",0)!=-1;if(!t){k+="px";p+="px";q+="px"}r=k=r?"translate("+k+", "+p+")":"translate3d("+k+", "+p+", "+q+")"}else r="";r=r;if(l){l=s.s.sy;k="";k=s.s.sx;h(k)||(k=1);l=l;h(l)||(l=1);l=k=b.has("css-perspective")?"scale3d("+k+", "+l+", 1)":"scale("+k+", "+l+")"}else l="";l=l;if(n){n="";s=s.r.a;h(s)||(s=0);s=n="rotate("+s+"deg)"}else s="";s=b.trim(r+" "+l+" "+s);e(m,s)};b.addClass=a;b.removeClass=c;return b.fx});
define(["../../../_base/_base/js/base"],function(b){b.math={round:function(a,c){b.isSet(c)||(c=0);var d=Math.pow(10,c);return Math.round(a*d)/d}};return b.math});
define(["../../../_base/_base/js/base","../../../_base/error/js/error","../../../_base/json/js/json"],function(b){var a=b.isSet;b.ux.Event=function(c){this.uId=b.getUId();this.multitouch=this.srcEvent=this.target=this.timestamp=this.y=this.x=this.type=null;b.mixin(this,c);this._validateProperties()};b.ux.Event.prototype={preventDefault:function(){this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},dispatch:function(c,d){var f=this.srcEvent,g=f.type;if(a(d))g=
d;g=g;var e="HTMLEvents";if(/blur|focus|resize|scroll/i.test(g))e="UIEvent";else if(/click|mouse(down|move|up)/i.test(g))e="MouseEvent";else if(/touch(start|move|end|cancel)/i.test(g))e="TouchEvent";var h=document.createEvent(e),i=f.changedTouches;if(e=="HTMLEvents")h.initEvent(g,f.bubbles,f.cancelable);else if(e=="UIEvent")h.initUIEvent(g,f.bubbles,f.cancelable,window,f.detail);else if(e=="MouseEvent"){e=f.screenX;var j=f.screenY,o=f.clientX,m=f.clientY;if(f.initTouchEvent&&i&&i.length>0){i=i[0];
e=i.screenX;j=i.screenY;o=i.clientX;m=i.clientY}h.initMouseEvent(g,f.bubbles,f.cancelable,document.defaultView,f.detail,e,j,o,m,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,f.relatedTarget)}else e=="TouchEvent"&&h.initTouchEvent(g,f.bubbles,f.cancelable,window,f.detail,f.screenX,f.screenY,f.clientX,f.clientY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.touches,f.targetTouches,i,f.scale,f.rotation);c.dispatchEvent(h)},_validateProperties:function(){return true}};return b.ux.Event});
define(["../../../_base/_base/js/base","../../../_base/error/js/error","../../../_base/_feat/js/feat_event","../../event/js/event"],function(b){function a(i){var j={};j.x=i.pageX;j.y=i.pageY;j.target=i.target;return j}var c=[],d=b.has.prop,f={start:d("touchstart"),move:d("touchmove"),end:d("touchend"),gesturestart:d("gesturestart"),gesturechange:d("gesturechange"),gestureend:d("gestureend")},g={};for(var e in f)g[f[e]]=e;b.ux.touch={};b.ux.touch.addListener=function(i,j,o,m){if(b.isUndefined(f[j])){b.log("[touch] Cannot add listener for unknown eventType: "+
j);return false}b.isSet(m)||(m={});if(m===true)m={preventDefault:true};m={preventDefault:m.preventDefault===true?true:false,tracking:m.tracking===false?false:true,captureFlow:m.captureFlow===true?true:false};var n=null,l=h(i);if(l==null){n=new b.ux.touch.Element({domNode:i,tracking:m.tracking});c.push(n)}else n=c[l];if(!n.isListening(j)){if(n.eventHandler==null)n.eventHandler=function(k){var p=n,q=g[k.type],r={};r.type=q;r.srcEvent=k;r.timestamp=k.timeStamp;r.multitouch=false;if(!r.timestamp)r.timestamp=
(new Date).getTime();if(b.has("touch"))if(q=="gesturestart"||q=="gesturechange"||q=="gestureend"){r.target=k.target;r.x=0;r.y=0}else{var s=null;if(q=="end"){if(k.changedTouches&&k.changedTouches.length>0)s=k.changedTouches[0]}else if(k.targetTouches&&k.targetTouches.length>0)s=k.targetTouches[0];else if(k.changedTouches&&k.changedTouches.length>0)s=k.changedTouches[0];if(s!=null){s=a(s);r.x=s.x;r.y=s.y;r.target=s.target;if(k.touches&&k.touches.length>1)r.multitouch=true}}else{s=a(k);r.x=s.x;r.y=s.y;
r.target=s.target}k=new b.ux.Event(r);if(!p.isListening("start")||p.tracking==false)p.tracked=true;else if(q=="start")p.tracked=true;if(p.tracked==true){if(q=="end")p.tracked=false;p.notifyEvent(k)}};n.eventCaptures[j]=m.captureFlow;n.domNode.addEventListener(f[j],n.eventHandler,n.eventCaptures[j])}n.addEventCallback(j,o,m.preventDefault)};b.ux.touch.removeListener=function(i,j,o){i=h(i);if(i!=null){i=c[i];i.removeEventCallback(j,o);i.isListening(j)||i.domNode.removeEventListener(f[j],i.eventHandler,
i.eventCaptures[j])}};b.ux.touch.getTouchProperties=a;var h=function(i){var j,o=c.length;for(j=0;j<o;j++)if(c[j].domNode==i)return j;return null};b.ux.touch.Element=function(i){this.uId=b.getUId();this.domNode=null;this.tracked=this.tracking=false;this.eventHandler=null;this.eventCaptures={};this._els={};b.mixin(this,i);this._validateProperties()};b.ux.touch.Element.prototype={addEventCallback:function(i,j,o){if(!b.isCallback(j))return false;var m=this._els[i];if(m){i=m.callbacks;var n=i.length;for(o=
0;o<n;o++){var l=i[o];if(j.context==l.context&&j.method==l.method)return false}}else{m={preventDefault:o,callbacks:[]};this._els[i]=m}m.callbacks.push(j);return true},removeEventCallback:function(i,j){if(!b.isCallback(j))return false;var o=this._els[i];if(!o)return false;var m=o.callbacks,n,l=m.length;for(n=0;n<l;n++){var k=m[n];if(j.context==k.context&&j.method==k.method){o.callbacks.splice(n,1);break}}return true},isListening:function(i){if((i=this._els[i])&&i.callbacks.length>0)return true;return false},
notifyEvent:function(i){var j=this._els[i.type];if(j){j.preventDefault==true&&i.preventDefault();j=j.callbacks;for(var o=0;o<j.length;o++)b.call(j[o],i)}},_validateProperties:function(){return true}};return b.ux.touch});
define(["../../../_base/_base/js/base","../../../_base/error/js/error"],function(b){var a=b.isSet,c=b.isArray;b.net.Xhr=function(d){this.uId=b.getUId();this.request={xhrObject:null,params:d};this._create()};b.net.Xhr.prototype={sendData:function(d,f,g,e,h,i){var j=this.request,o=j.xhrObject,m=encodeURIComponent;g=g.toUpperCase();if(!(a(f)&&!c(f))){if(o){var n=null;if(a(f)){var l,k=f.length;for(l=0;l<k;l++){var p=f[l],q=p.name;p=p.value;if(g=="GET")d+=l==0&&d.indexOf("?")==-1?"?"+m(q)+"="+m(p):"&"+
m(q)+"="+m(p);else if(l==0)n=m(q)+"="+m(p);else n+="&"+m(q)+"="+m(p)}}try{o.open(g,d,true);o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");if(a(i))if(c(i)){k=i.length;for(l=0;l<k;l++){var r=i[l];o.setRequestHeader(r.name,r.value)}}o.send(n)}catch(s){return false}o.onreadystatechange=function(){if(o.readyState==4){var t=o.status;if(t>=200&&t<400||t==0)a(e)&&b.call(e,j);else a(h)&&b.call(h,j)}}}else return false;return true}},_create:function(){var d=window.XMLHttpRequest;
if(d){var f;try{f=new d}catch(g){f=false}this.request.xhrObject=f}}};b.Xhr=b.net.Xhr;return b.Xhr});
define(["../../../../_base/_base/js/base","../../../../fx/_xy/js/2dfx"],function(b){var a=b.fx.apply,c=null,d=null,f=false;b.ui.xy.layer={visible:false,color:"#000",opacity:0.3,zIndex:998,show:function(){f||this._initDom();c.onclick=function(){var g=b.ui.xy.layer.onclick;b.isSet(g)&&g()};if(!this.visible){a(d,{height:document.body.scrollHeight+"px"});a(c,{display:"block"});this.visible=true}},hide:function(){if(f&&this.visible){a(c,{display:"none"});this.visible=false}},refresh:function(){f&&this.visible&&
a(d,{height:document.body.scrollHeight+"px"})},update:function(){f||this._initDom();a(c,{"z-index":this.zIndex});a(d,{backgroundColor:this.color,opacity:this.opacity})},_initDom:function(){var g=document;c=g.createElement("div");a(c,{position:"absolute",display:"none",top:0,width:"100%","z-index":this.zIndex,"tap-highlight-color":"rgba(0, 0, 0, 0)"});d=g.createElement("div");a(d,{width:"100%",backgroundColor:this.color,opacity:this.opacity});c.appendChild(d);g.body.appendChild(c);f=true}};b.layer=
b.ui.xy.layer;return b.layer});define(["../../../_base/_base/js/base","./feat"],function(b){b=b.has;var a=b.inquireMap;a({"native-geolocation":function(){return!!navigator.geolocation},"native-device-orientation":function(){return"ondeviceorientation"in window},"native-device-motion":function(){return"ondevicemotion"in window}});return b});define(["../../../_base/_base/js/base","./feat"],function(b){b=b.has;var a=b.inquireMap,c=window;a({canvas:function(){return!!c.CanvasRenderingContext2D}});return b});
define(["../../../_amd/core","../../../math/_matrix/js/matrix"],function(b){var a=[];b.fx.set3dTransform=function(f,g,e){if(!c(g))return false;var h;if(e===true)h=b.fx.getTransform(f);e=b.math.createTransformMatrix(h);g=d(g);e.multiply(g);b.fx.setTransform(f,e.getCssMatrix())};b.fx.initComposedTransform=function(f,g){var e;if(g===true)e=b.fx.getTransform(f);e=b.math.createTransformMatrix(e);b.fx.removeComposedTransform(f);a.push({node:f,transforms:[e]})};b.fx.setTransformPart=function(f,g,e){if(!c(e))return false;
if(g<1||g>10)return false;var h,i=a.length;for(h=0;h<i;h++){var j=a[h];if(j.node==f){f=null;if(b.isSet(e))f=d(e);j.transforms[g]=f;break}}};b.fx.applyComposedTransform=function(f,g){var e,h=a.length;for(e=0;e<h;e++){var i=a[e];if(i.node==f){e=i.transforms;h=e[0].clone();var j,o=e.length;for(j=1;j<o;j++){var m=e[j];b.isSet(m)&&h.multiply(m)}if(g===true)i.transforms=[h];b.fx.setTransform(f,h.getCssMatrix());break}}};b.fx.storeComposedTransform=function(f){b.fx.applyComposedTransform(f,true)};b.fx.removeComposedTransform=
function(f){var g,e=a.length;for(g=0;g<e;g++)if(a[g].node==f){a.splice(g,1);break}};var c=function(f){var g=true,e=b.isSet;if(e(f)){var h=["translate","scale","rotate"];if((g=(g=(g=(g=(g=g&&e(f.type))&&h.indexOf(f.type)!=-1)&&e(f.x))&&e(f.y))&&e(f.z))&&f.type=="rotate")g=g&&e(f.angle)}return g},d=function(f){var g=b.math.createTransformMatrix();switch(f.type){case "translate":g.translate(f.x,f.y,f.z);break;case "scale":g.scale(f.x,f.y,f.z);break;case "rotate":g.rotateAxisAngle(f.x,f.y,f.z,f.angle);
break}return g};return b.fx});
define(["../../../_amd/core"],function(b){if(typeof b.fx.animation=="undefined")b.fx.animation={};b.fx.animate=function(e,h,i){return a(e,h,i)};b.fx.fadeIn=function(e,h){return c(e,1,h)};b.fx.fadeOut=function(e,h){return c(e,0,h)};b.fx.collapse=function(e,h){var i=h||{},j=g(e,i.rows,i.cols);if(j!=null){e.parentNode.appendChild(j.copy.container.node);b.fx.apply(e,{opacity:0});var o=i.duration||2E3;d(j,{x:i.x-j.source.x,y:i.y-j.source.y});var m=b.math.round(o/3,0);o=(o-m)/j.copy.orderMax;for(var n=
new b.fx.animation.AnimationGroup,l={translate:function(u,w,z){u.node.translate(w,z)}},k=0;k<j.rows;k++)for(var p=0;p<j.cols;p++){var q=j.copy.subparts[k][p],r=Math.max(j.rows,j.cols)-Math.ceil(q.order),s=new b.fx.animation.Animation;s.addStep({property:"transform",value:{context:l,method:"translate",arguments:[i.dx,i.dy]},duration:m,delay:b.math.round(q.order*o,0),func:"cubic-bezier(1.0, 0.0, 1.0, 1.0)"});b.fx.apply(q.node,{zIndex:r});n.addAnimation(q.node,s)}var t=b.isCallback(i.onEnd)?i.onEnd:
null;n.start({onEnd:{context:{onEnd:function(){e.parentNode.removeChild(j.copy.container.node);b.isSet(t)&&b.call(t,{})}},method:"onEnd"}})}};b.fx.split=function(e,h,i){return g(e,h,i)};var a=function(e,h,i){var j=i||{};i=j.start!==false;j=j.onEnd?j.onEnd:null;h=b.isArray(h)?h:[h];for(var o=0;o<h.length;o++){var m=h[o];if(!b.isSet(m.property)||!b.isSet(m.value))return null;if(!b.isSet(m.duration))m.duration=1E3;if(!b.isSet(m.delay))m.delay=0;if(!b.isSet(m.func))m.func="linear"}e=new b.fx.animation.Animation({node:e,
onEnd:j});e.addStep(h);i&&e.start();return e},c=function(e,h,i){i=i||{};return a(e,{property:"opacity",value:h,duration:i.duration,delay:i.delay,func:i.func},i)},d=function(e,h){for(var i=Math.abs(e.cols*e.copy.subW),j=Math.abs(e.rows*e.copy.subH),o=Math.sqrt(i*i+j*j),m=Math.max(e.rows,e.cols),n=Number.MAX_VALUE,l={i:0,j:0},k=0,p=0;p<e.rows;p++)for(var q=0;q<e.cols;q++){var r=e.copy.subparts[p][q];j={x:r.x+r.w/2,y:r.y+r.h/2};i=Math.abs(j.x-h.x);j=Math.abs(j.y-h.y);i=Math.sqrt(i*i+j*j);r.distance=
i;if(i<n){n=i;l={i:p,j:q}}i=r.distance*m/o;r.order=Math.max(i,1);if(k<i)k=i}e.copy.subparts[l.i][l.j].order=0;e.copy.orderMax=k},f=function(e){var h=function(i,j,o){i=(i.ownerDocument.defaultView||window).getComputedStyle(i,null).getPropertyValue(j);return o?parseFloat(i):i};return{x:e.getLeftPosition(),y:e.getTopPosition(),h:h(e,"height",true),w:h(e,"width",true),bh:h(e,"border-top-width",true)+h(e,"border-bottom-width",true),bw:h(e,"border-left-width",true)+h(e,"border-right-width",true),zIndex:h(e,
"z-index")}},g=function(e,h,i){if(!b.isSet(e)||!b.isSet(h)||!b.isSet(i))return null;h={rows:h,cols:i,source:f(e),copy:{subH:null,subW:null,container:{node:null,style:null},subparts:[]}};var j=(h.source.h+h.source.bh)/h.rows,o=(h.source.w+h.source.bw)/h.cols;h.copy.subH=j;h.copy.subW=o;i=b.math.round(j,0);var m=b.math.round(o,0);o=o-m;j=b.math.round((j-i)*h.rows,0);o=b.math.round(o*h.cols,0);h.copy.container.node=document.createElement(e.tagName);b.fx.apply(h.copy.container.node,{position:"absolute",
padding:0,margin:0,border:"none",top:h.source.y+"px",left:h.source.x+"px",height:h.source.h+h.source.bh+"px",width:h.source.w+h.source.bw+"px",background:"none",overflow:"hidden",zIndex:h.source.zIndex});for(var n=0;n<h.rows;n++){h.copy[n]||(h.copy.subparts[n]=[]);for(var l=0;l<h.cols;l++){var k={i:n,j:l},p=l==h.cols-1,q=n==h.rows-1;k.x=l*m;k.y=n*i;k.h=i;k.w=m;if(p)k.w=Math.max(k.w+o,0);if(q)k.h=Math.max(k.h+j,0);k.node=document.createElement(e.tagName);b.fx.apply(k.node,{position:"absolute",padding:0,
margin:0,border:"none",left:k.x+"px",top:k.y+"px",height:k.h+"px",width:k.w+"px",overflow:"hidden"});k.inner=e.cloneNode(true);k.inner.removeAttribute("id");b.fx.apply(k.inner,{position:"static",marginTop:-k.y+"px",marginLeft:-k.x+"px"});k.node.appendChild(k.inner);h.copy.subparts[n].push(k);h.copy.container.node.appendChild(k.node)}}return h};b.fx.animation.Animation=function(e){this.uId=b.getUId();e=e||{};this._steps=[];this._node=e.node;this._onEnd=e.onEnd};b.fx.animation.Animation.prototype={addStep:function(e){e=
b.isArray(e)?e:[e];for(var h=[],i=[],j=[],o=[],m={},n=0;n<e.length;n++){var l=e[n],k=l.property,p=l.value,q=l.duration,r=Math.max(b.isSet(l.delay)?l.delay:1,1);l=b.isSet(l.func)?l.func:"default";k=b.has.prop(k);h.push(k);i.push(q+"ms");j.push(r+"ms");o.push(l);m[k]=p}this._steps.push({propValues:m,transition:{property:h.join(","),duration:i.join(","),delay:j.join(","),func:o.join(",")}})},start:function(e,h){var i=h||{},j=e||this._node;i.onEnd=i.onEnd||this._onEnd;if(b.isSet(j))this._nextStep({uId:b.getUId(),
node:j,currentStep:-1,iterations:i.iterations?i.iterations:1,currentIt:0,onEnd:b.isCallback(i.onEnd)?i.onEnd:null})},getSteps:function(){return this._steps},chain:function(e){if(!(!e instanceof b.fx.animation.Animation)){e=e.getSteps();for(var h=0;h<e.length;h++)this._steps.push(e[h]);return this}},_end:function(e){e.currentIt++;if(e.currentIt<e.iterations){e.currentStep=-1;this._nextStep(e)}else b.isSet(e.onEnd)&&b.call(e.onEnd,{})},_nextStep:function(e){e.currentStep++;if(e.currentStep>=this._steps.length)this._end(e);
else{var h=e.node,i=this._steps[e.currentStep];e.transitionStates={};for(var j in i.propValues)e.transitionStates[j]=false;j=b.bind(this._transitionEnd,this,e);e.trEndHandler=b.fx.onTransitionEnd(h,j,true);e.timer=b.setTimeout(this,"_startStep",0,h,i,e)}},_startStep:function(e,h,i){clearTimeout(i.timer);i=h.transition;b.fx.applyTransition(e,i.property,i.duration,i.delay,i.func);this._setStyle(e,h.propValues)},_transitionEnd:function(e,h){var i=e.transitionStates[h.propertyName]=true;for(var j in e.transitionStates)if(e.transitionStates[j]==
false){i=false;break}if(i){e.node.removeEventListener(b.has.prop("transitionend"),e.trEndHandler,false);this._nextStep(e)}},_setStyle:function(e,h){var i=0,j={};for(var o in h){var m=h[o];if(b.isCallback(m))b.call(m,{node:e});else{j[o]=m;i++}}i>0&&b.fx.apply(e,j)}};b.fx.animation.AnimationGroup=function(){this.uId=b.getUId();this._animations=[];this._onEndCallback=this._countDone=null};b.fx.animation.AnimationGroup.prototype={addAnimation:function(e,h){!h instanceof b.fx.animation.Animation||this._animations.push({node:e,
anim:h})},start:function(e){e=e||{};this._countDone=0;var h=b.isCallback(e.onEnd);this._onEndCallback=h?e.onEnd:null;e={onEnd:h?{context:this,method:"_onAnimEnd"}:null};for(h=0;h<this._animations.length;h++){var i=this._animations[h];i.anim.start(i.node,e)}},clear:function(){this._animations=[]},_onAnimEnd:function(){this._countDone++;this._countDone==this._animations.length&&b.call(this._onEndCallback,{})}};return b.fx});
define(["../../../_amd/core"],function(b){b.math.radToDeg=function(a){return a*180/Math.PI};b.math.degToRad=function(a){return a*Math.PI/180};b.math.getAngle=function(a,c){var d=Math.abs(c);if(d>a*2)d=a*2;var f=2*a*a;d=Math.acos(-((Math.pow(d,2)-(Math.pow(a,2)+Math.pow(a,2)))/f));if(isNaN(d))d=0;return d};b.math.getAngleBetweenVectors=function(a,c){var d=b.math.getScalarVector(a,c),f=b.math.getNormVector(a)*b.math.getNormVector(c);d=Math.acos(d/f);if(isNaN(d))d=0;return d};b.math.normalizeVector=
function(a){var c=[0,0,0,1],d=b.math.getNormVector(a);if(d<=0)return c;c[0]=a[0]/d;c[1]=a[1]/d;c[2]=a[2]/d;return c};b.math.getNormVector=function(a){a=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];return a=Math.sqrt(a)};b.math.getNormalVector=function(a,c){var d=[0,0,0,1];d[0]=a[1]*c[2]-a[2]*c[1];d[1]=a[2]*c[0]-a[0]*c[2];d[2]=a[0]*c[1]-a[1]*c[0];return d};b.math.getScalarVector=function(a,c){var d=0;return d=a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};b.math.getVector=function(a,c){var d=[0,0,0,1];d[0]=c[0]-a[0];d[1]=c[1]-a[1];
d[2]=c[2]-a[2];return d};b.math.multiplyMatrixVector=function(a,c){var d=[0,0,0,1];c[3]||(c[3]=1);d[0]=c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3];d[1]=c[0]*a[4]+c[1]*a[5]+c[2]*a[6]+c[3]*a[7];d[2]=c[0]*a[8]+c[1]*a[9]+c[2]*a[10]+c[3]*a[11];d[3]=c[0]*a[12]+c[1]*a[13]+c[2]*a[14]+c[3]*a[15];return d};return b.math});
define(["../../../_amd/core"],function(b){b.math.createTransformMatrix=function(a){var c=new b.math.Matrix({});b.isSet(a)&&c.loadCssTransform(a);return c};b.math.Matrix=function(a){this.uId=b.getUId();this._properties=a;this._values=[];this._cssMatrix=null;this._validateProperties()!==false&&this._initProperties()};b.math.Matrix.prototype={scale:function(a,c,d){this._load(this._cssMatrixToValues(this._cssMatrix.scale(a,c,d)))},translate:function(a,c,d){this._load(this._cssMatrixToValues(this._cssMatrix.translate(a,
c,d)))},rotateAxisAngle:function(a,c,d,f){this._load(this._cssMatrixToValues(this._cssMatrix.rotateAxisAngle(a,c,d,f)))},multiply:function(a){a=a.getCssMatrix();var c=this._cssMatrix;if(b.has("css-matrix-stack-inversed")){var d=a;a=c;c=d}this._load(this._cssMatrixToValues(a.multiply(c)))},clone:function(){return new b.math.Matrix({values:this._values})},loadCssTransform:function(a){if(isString(a)){if(a.indexOf("matrix3d")!=-1){a=a.substring(9,a.length-1).split(", ");for(var c=[],d=0;d<a.length;d++)c[d]=
a[d]*1;this._load(c)}}else try{this._load(this._cssMatrixToValues(a))}catch(f){}},getValues:function(){return this._values},getCssMatrix:function(){return this._cssMatrix},_validateProperties:function(){return true},_initProperties:function(){b.isSet(this._properties.values)?this._load(this._properties.values):this._loadIdentity()},_loadIdentity:function(){this._load([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},_load:function(a){if(!b.isSet(a)||a.length!=16)return false;this._values=a;this._cssMatrix=this._valuesToCssMatrix(this._values)},
_valuesToCssMatrix:function(a){var c=new WebKitCSSMatrix;c.m11=a[0];c.m12=a[1];c.m13=a[2];c.m14=a[3];c.m21=a[4];c.m22=a[5];c.m23=a[6];c.m24=a[7];c.m31=a[8];c.m32=a[9];c.m33=a[10];c.m34=a[11];c.m41=a[12];c.m42=a[13];c.m43=a[14];c.m44=a[15];return c},_cssMatrixToValues:function(a){var c=[];c[0]=a.m11;c[1]=a.m12;c[2]=a.m13;c[3]=a.m14;c[4]=a.m21;c[5]=a.m22;c[6]=a.m23;c[7]=a.m24;c[8]=a.m31;c[9]=a.m32;c[10]=a.m33;c[11]=a.m34;c[12]=a.m41;c[13]=a.m42;c[14]=a.m43;c[15]=a.m44;return c}};return b.math});
define(["../../../_amd/core"],function(b){b.ux.gesture={_gestureElements:[],_knownGestures:["two_digits_click","two_digits_press","enlargement","narrowing","rotation","instant_scale","instant_rotation","gesture_end"],TWO_DIGITS_CLICK_MAX_DURATION:350,TWO_DIGITS_PRESS_MIN_DURATION:400,SCALE_MIN_VALUE:0.2,ROTATION_MIN_VALUE:5,listenTo:function(a,c,d,f){if(!this._isGestureKnown(c)){b.log("[gesture] Cannot listen to this unknown gesture: "+c);return false}if(!b.isCallback(d)){b.log("[gesture] Invalid callback: "+
d);return false}var g={preventDefault:false};if(b.isSet(f))g.preventDefault=f===true?true:f.preventDefault===true;f=null;f=this._getGestureElementIndex(a);if(f==null){f=this._createGestureElement(a,g.preventDefault);this._gestureElements.push(f);b.ux.touch.addListener(f.domNode,"start",{context:this,method:"_handleStart",arguments:[f]},{preventDefault:f.preventDefault,tracking:false});b.ux.touch.addListener(f.domNode,"gesturestart",{context:this,method:"_handleGestureStart",arguments:[f]},{preventDefault:f.preventDefault})}else f=
this._gestureElements[f];f.addCallback(c,d)},unlistenTo:function(a,c,d){if(!this._isGestureKnown(c)){b.log("[gesture] Cannot listen to this unknown gesture: "+c);return false}if(!b.isCallback(d)){b.log("[gesture] Invalid callback: "+d);return false}var f=null;a=this._getGestureElementIndex(a);if(a!=null){f=this._gestureElements[a];f.removeCallback(c,d)}},_createGestureElement:function(a,c){return{uId:b.getUId(),domNode:a,preventDefault:c,digits:[],multitouch:false,multitouchStartTime:null,multitouchEndTime:null,
scale:1,rotation:0,gestureHandlers:[],getGestureHandler:function(d){for(var f=0;f<this.gestureHandlers.length;f++)if(this.gestureHandlers[f].gesture==d)return this.gestureHandlers[f];return null},isListening:function(d){return this.getGestureHandler(d)!=null},addCallback:function(d,f){this.isListening(d)?this.getGestureHandler(d).callbacks.push(f):this.gestureHandlers.push({gesture:d,callbacks:[f]})},removeCallback:function(d,f){if(this.isListening(d))for(var g=0;g<this.getGestureHandler(d).callbacks.length;g++){var e=
this.getGestureHandler(d).callbacks[g];if(e.context==f.context&&e.method==f.method){if(this.getGestureHandler(d).callbacks.length==1)for(g=0;g<this.gestureHandlers.length;g++){if(this.gestureHandlers[g].gesture==d){this.gestureHandlers.splice(g,1);break}}else this.getGestureHandler(d).callbacks.splice(g,1);break}}},reset:function(){this.digits=[];this.multitouch=false;this.multitouchEndTime=this.multitouchStartTime=null;this.scale=1;this.rotation=0}}},_isGestureKnown:function(a){return this._knownGestures.indexOf(a)!=
-1},_getGestureElementIndex:function(a){for(var c=0;c<this._gestureElements.length;c++)if(this._gestureElements[c].domNode==a)return c;return null},_notifyGesture:function(a,c,d){if(c.isListening(a)){a=c.getGestureHandler(a).callbacks;for(c=0;c<a.length;c++)b.call(a[c],d)}},_handleStart:function(a,c){c.reset();c.checkTimer&&clearTimeout(c.checkTimer);var d=0;if(b.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){c.multitouch=true;c.multitouchStartTime=this._getTimeStamp();
c.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));c.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a));b.ux.touch.addListener(c.domNode,"move",{context:this,method:"_handleMove",arguments:[c]},{preventDefault:c.preventDefault});b.ux.touch.addListener(c.domNode,"end",{context:this,method:"_handleEnd",arguments:[c]});c.checkTimer=b.setTimeout(this,"_checkTwoDigitsPressed",this.TWO_DIGITS_PRESS_MIN_DURATION,c)}else{c.multitouch=false;b.ux.touch.removeListener(c.domNode,"move",{context:this,
method:"_handleMove",arguments:[c]});b.ux.touch.removeListener(c.domNode,"end",{context:this,method:"_handleEnd",arguments:[c]})}},_handleMove:function(a,c){var d=0;if(b.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){c.digits=[];c.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));c.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a))}},_handleEnd:function(a,c){if(c.multitouch==true){var d=0;if(b.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;
if(d!=2)c.multitouch=false;if(d==0){b.ux.touch.removeListener(c.domNode,"move",{context:this,method:"_handleMove"});b.ux.touch.removeListener(c.domNode,"end",{context:this,method:"_handleEnd"});c.multitouchEndTime=this._getTimeStamp();c.multitouchEndTime-c.multitouchStartTime<this.TWO_DIGITS_CLICK_MAX_DURATION&&this._notifyGesture("two_digits_click",c,{digit1:c.digits[0],digit2:c.digits[1]})}}},_checkTwoDigitsPressed:function(a){a.multitouch==true&&this._notifyGesture("two_digits_press",a,{digit1:a.digits[0],
digit2:a.digits[1]})},_handleGestureStart:function(a,c){b.ux.touch.addListener(c.domNode,"gesturechange",{context:this,method:"_handleGestureChange",arguments:[c]},{preventDefault:c.preventDefault});b.ux.touch.addListener(c.domNode,"gestureend",{context:this,method:"_handleGestureEnd",arguments:[c]});c.gestureStartTime=this._getTimeStamp()},_handleGestureChange:function(a,c){if(c.multitouch==true){var d=a.srcEvent.scale-c.scale,f=a.srcEvent.rotation-c.rotation,g={digit1:c.digits[0],digit2:c.digits[1],
scale:b.math.round(a.srcEvent.scale,2)},e={digit1:c.digits[0],digit2:c.digits[1],rotation:b.math.round(a.srcEvent.rotation,2)};if(Math.abs(d)>this.SCALE_MIN_VALUE){c.scale=a.srcEvent.scale;var h=null;h=d>0?"enlargement":"narrowing";this._notifyGesture(h,c,g)}if(Math.abs(f)>this.ROTATION_MIN_VALUE){c.rotation=a.srcEvent.rotation;this._notifyGesture("rotation",c,e)}this._notifyGesture("instant_scale",c,g);this._notifyGesture("instant_rotation",c,e)}},_handleGestureEnd:function(a,c){b.ux.touch.removeListener(c.domNode,
"gesturechange",{context:this,method:"_handleGestureChange"});b.ux.touch.removeListener(c.domNode,"gestureend",{context:this,method:"_handleGestureEnd"});c.gestureEndTime=this._getTimeStamp();this._notifyGesture("gesture_end",c,{gestureDuration:c.gestureEndTime-c.gestureStartTime})},_getDigit:function(a,c){var d=b.ux.touch.getTouchProperties(a);return{x:d.x,y:d.y,timestamp:c.timestamp,target:d.target}},_getTimeStamp:function(){return(new Date).getTime()}};return b.ux.gesture});
define(["../../../_amd/core"],function(b){b.ux.GestureRecognizer=function(a){this.uId=b.getUId();this._properties=a;this._gestureEndCallback=this._gestureCallback=this._gestureStartCallback=null;this._points=[];this._templates=[];this._isDown=false;this.numTemplates=8;this.numPoint=64;this.squareSize=250;this.origin={x:0,y:0};this.diagonal=Math.sqrt(this.squareSize*this.squareSize+this.squareSize*this.squareSize);this.halfDiagonal=0.5*this.diagonal;this.angleRange=b.ux.GestureRecognizer.prototype.utils.deg2Rad(45);
this.anglePrecision=b.ux.GestureRecognizer.prototype.utils.deg2Rad(2);this.phi=0.5*(-1+Math.sqrt(5));this._domNode=null;if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};b.ux.GestureRecognizer.prototype={utils:{resample:function(a,c){for(var d=b.ux.GestureRecognizer.prototype.utils.pathLength(a)/(c-1),f=0,g=Array(a[0]),e=1;e<a.length;e++){var h=b.ux.GestureRecognizer.prototype.utils.distance(a[e-1],a[e]);if(f+h>=d){f={x:a[e-1].x+(d-f)/h*(a[e].x-a[e-1].x),y:a[e-
1].y+(d-f)/h*(a[e].y-a[e-1].y)};g[g.length]=f;a.splice(e,0,f);f=0}else f+=h}if(g.length==c-1)g[g.length]={x:a[a.length-1].x,y:a[a.length-1].y};return g},indicativeAngle:function(a){var c=b.ux.GestureRecognizer.prototype.utils.centroid(a);return Math.atan2(c.y-a[0].y,c.x-a[0].x)},rotateBy:function(a,c){for(var d=b.ux.GestureRecognizer.prototype.utils.centroid(a),f=Math.cos(c),g=Math.sin(c),e=[],h=0;h<a.length;h++)e[e.length]={x:(a[h].x-d.x)*f-(a[h].y-d.y)*g+d.x,y:(a[h].x-d.x)*g+(a[h].y-d.y)*f+d.y};
return e},scaleTo:function(a,c){for(var d=b.ux.GestureRecognizer.prototype.utils.boundingBox(a),f=[],g=0;g<a.length;g++)f[f.length]={x:a[g].x*(c/d.width),y:a[g].y*(c/d.height)};return f},translateTo:function(a,c){for(var d=b.ux.GestureRecognizer.prototype.utils.centroid(a),f=[],g=0;g<a.length;g++)f[f.length]={x:a[g].x+c.x-d.x,y:a[g].y+c.y-d.y};return f},distanceAtBestAngle:function(a,c,d,f,g,e){for(var h=e*d+(1-e)*f,i=b.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,c,h),j=(1-e)*d+e*f,o=b.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,
c,j);Math.abs(f-d)>g;)if(i<o){f=j;j=h;o=i;h=e*d+(1-e)*f;i=b.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,c,h)}else{d=h;h=j;i=o;j=(1-e)*d+e*f;o=b.ux.GestureRecognizer.prototype.utils.distanceAtAngle(a,c,j)}return Math.min(i,o)},distanceAtAngle:function(a,c,d){a=b.ux.GestureRecognizer.prototype.utils.rotateBy(a,d);return b.ux.GestureRecognizer.prototype.utils.pathDistance(a,c.points)},centroid:function(a){for(var c=0,d=0,f=0;f<a.length;f++){c+=a[f].x;d+=a[f].y}c/=a.length;d/=a.length;return{x:c,
y:d}},boundingBox:function(a){for(var c=+Infinity,d=-Infinity,f=+Infinity,g=-Infinity,e=0;e<a.length;e++){if(a[e].x<c)c=a[e].x;if(a[e].x>d)d=a[e].x;if(a[e].y<f)f=a[e].y;if(a[e].y>g)g=a[e].y}return{x:c,y:f,width:d-c,height:g-f}},pathDistance:function(a,c){for(var d=0,f=0;f<a.length;f++)d+=b.ux.GestureRecognizer.prototype.utils.distance(a[f],c[f]);return d/a.length},pathLength:function(a){for(var c=0,d=1;d<a.length;d++)c+=b.ux.GestureRecognizer.prototype.utils.distance(a[d-1],a[d]);return c},distance:function(a,
c){var d=c.x-a.x,f=c.y-a.y;return Math.sqrt(d*d+f*f)},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI}},getDomNode:function(){return this._domNode},_touchStart:function(a){var c=a.x,d=a.y;this._points.length=1;this._points[0]={x:c,y:d};this._isDown=true;this._gestureStartCallback!=null&&b.call(this._gestureStartCallback,a)},_touchMove:function(a){var c=a.x,d=a.y;if(this._isDown)this._points[this._points.length]={x:c,y:d};this._gestureCallback!=null&&b.call(this._gestureCallback,
a)},_touchEnd:function(a){if(this._isDown){if(this._points.length>=10){var c=this._recognize(this._points);b.publish("/gesturerecognizer/events/result",c)}else b.publish("/gesturerecognizer/events/result",{result:null,score:0});this._isDown=false;this._gestureEndCallback!=null&&b.call(this._gestureEndCallback,a)}},_addTemplate:function(a,c){this._templates.push(new this.Template(a,this.numPoint,this.squareSize,this.origin,c))},_recognize:function(a){a=b.ux.GestureRecognizer.prototype.utils.resample(a,
this.numPoint);var c=b.ux.GestureRecognizer.prototype.utils.indicativeAngle(a);a=b.ux.GestureRecognizer.prototype.utils.rotateBy(a,-c);a=b.ux.GestureRecognizer.prototype.utils.scaleTo(a,this.squareSize);a=b.ux.GestureRecognizer.prototype.utils.translateTo(a,this.origin);c=+Infinity;for(var d=0,f=0;f<this._templates.length;f++){var g=b.ux.GestureRecognizer.prototype.utils.distanceAtBestAngle(a,this._templates[f],-this.angleRange,+this.angleRange,this.anglePrecision,this.phi);if(g<c){c=g;d=f}}return{result:this._templates[d].name,
score:1-c/this.halfDiagonal}},_initListeners:function(){b.ux.touch.addListener(this._domNode,"start",{context:this,method:"_touchStart",arguments:null},{preventDefault:true});b.ux.touch.addListener(this._domNode,"move",{context:this,method:"_touchMove",arguments:null},{preventDefault:true});b.ux.touch.addListener(this._domNode,"end",{context:this,method:"_touchEnd",arguments:null},{preventDefault:true})},_initProperties:function(){for(var a=this._properties.templates.length,c=0;c<a;c++)this._addTemplate(this._properties.templates[c].name,
this._properties.templates[c].points);this.numTemplates=a;this._domNode=this._properties.node;if(this._properties&&this._properties.gestureStartCallback)this._gestureStartCallback=this._properties.gestureStartCallback;if(this._properties&&this._properties.gestureCallback)this._gestureCallback=this._properties.gestureCallback;if(this._properties&&this._properties.gestureEndCallback)this._gestureEndCallback=this._properties.gestureEndCallback},_validateProperties:function(){return true},Template:function(a,
c,d,f,g){this.name=a;this.points=b.ux.GestureRecognizer.prototype.utils.resample(g,c);a=b.ux.GestureRecognizer.prototype.utils.indicativeAngle(this.points);this.points=b.ux.GestureRecognizer.prototype.utils.rotateBy(this.points,-a);this.points=b.ux.GestureRecognizer.prototype.utils.scaleTo(this.points,d);this.points=b.ux.GestureRecognizer.prototype.utils.translateTo(this.points,f)}};return b.ux.GestureRecognizer});
define(["../../../_amd/core"],function(b){b.ux.MovementTracker=function(a){this.uId=b.getUId();this._properties=a;this._previousPoint=this._startPoint=this._pointStatement=this._target=null;this._tracking=false;this._acceptEvents=true;this._multitouch=false;this._params={captureFlow:true,preventStart:true,preventMove:false,shiftThreshold:0,trackThresholdX:0,trackThresholdY:0};if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};b.ux.MovementTracker.prototype={updateTrackThresholdX:function(a){if(this._isValidThreshold(a))this._params.trackThresholdX=
a;else this._raisePropertyError("trackThresholdX")},updateTrackThresholdY:function(a){if(this._isValidThreshold(a))this._params.trackThresholdY=a;else this._raisePropertyError("trackThresholdY")},destroy:function(){this._removeListeners()},_validateProperties:function(){return true},_isValidThreshold:function(a){return b.isInteger(a)&&a>=0},_raisePropertyError:function(a){b.log("[MovementTracker] Error: "+a+" missing or invalid")},_initProperties:function(){this._target=$(this._properties.target);
if(this._properties.captureFlow===false)this._params.captureFlow=false;if(this._properties.preventStart===false)this._params.preventStart=false;if(this._properties.preventMove===true)this._params.preventMove=true;if(b.isSet(this._properties.trackThresholdX))this._params.trackThresholdX=this._properties.trackThresholdX;if(b.isSet(this._properties.trackThresholdY))this._params.trackThresholdY=this._properties.trackThresholdY;delete this._properties},_initListeners:function(){b.ux.touch.addListener(this._target,
"start",{context:this,method:"_handleTouchStart"},{preventDefault:this._params.preventStart,captureFlow:this._params.captureFlow});b.ux.touch.addListener(this._target,"move",{context:this,method:"_handleTouchMove"},{preventDefault:this._params.preventMove,captureFlow:this._params.captureFlow});b.ux.touch.addListener(this._target,"end",{context:this,method:"_handleTouchEnd"},{captureFlow:this._params.captureFlow})},_removeListeners:function(){b.ux.touch.removeListener(this._target,"start",{context:this,
method:"_handleTouchStart"});b.ux.touch.removeListener(this._target,"move",{context:this,method:"_handleTouchMove"});b.ux.touch.removeListener(this._target,"end",{context:this,method:"_handleTouchEnd"})},_handleTouchStart:function(a){if(b.ua.isAndroid)if(!this.defered){this.defered=true;if((new Date).getTime()-a.timestamp>100){this._acceptEvents=false;a.preventDefault();var c,d={exec:b.bind(function(){clearTimeout(c);this._acceptEvents=true;this._handleTouchStart(a)},this)};c=b.setTimeout(d,"exec",
0);return}}if(this._acceptEvents!=false){this._multitouch=false;if(a.multitouch==true)this._multitouch=true;else{this._acceptEvents=false;this._pointStatement=[];this._previousPoint=null;this._tracking=false;this._startPoint={x:a.x,y:a.y};d=this._onNewTouch(a);b.publish(d.name,d.params);this._acceptEvents=true}}},_handleTouchMove:function(a){if(this._acceptEvents!=false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);b.publish(a.name,a.params);this._acceptEvents=true}},_handleTouchEnd:function(a){if(this._acceptEvents!=
false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);b.publish(a.name,a.params);this._acceptEvents=true}},_onNewTouch:function(a){if(this._tracking==false)if(this._params.trackThresholdX==0||this._params.trackThresholdY==0)this._tracking=true;else{var c={x:a.x,y:a.y},d=Math.abs(c.x-this._startPoint.x);c=Math.abs(c.y-this._startPoint.y);if(d>this._params.trackThresholdX||c>this._params.trackThresholdY)this._tracking=true}d={name:"/movementtracker/events/notrack",params:{publisher:this,
uxEvent:a,target:this._target}};if(this._tracking==false)return d;if(this._pointStatement.length==0)d.name="/movementtracker/events/mvtbegin";else if(a.type=="move")d.name="/movementtracker/events/mvtchanged";else if(a.type=="end")d.name="/movementtracker/events/mvtstored";this._addTouch(a);d.params.movement=this._getCurrentMovement();return d},_addTouch:function(a){a={x:a.x,y:a.y,timestamp:a.timestamp};var c=0,d=0,f=0,g=0,e=0,h=0;if(this._previousPoint==null){a.duration=0;a.globalDuration=0;c=a.x;
d=a.y}else{c=this._previousPoint.x;d=this._previousPoint.y;f=this._previousPoint.globalDx;g=this._previousPoint.globalDy;e=this._previousPoint.directionX;h=this._previousPoint.directionY;a.duration=a.timestamp-this._previousPoint.timestamp;a.globalDuration=a.duration+this._previousPoint.globalDuration}a.dx=Math.abs(a.x-c);a.dy=Math.abs(a.y-d);a.globalDx=a.dx+f;a.globalDy=a.dy+g;a.directionX=e;a.directionY=h;if(e==0&&this._previousPoint!=null){if(a.x<c)a.directionX=-1;else if(a.x>c)a.directionX=1;
this._previousPoint.directionX=a.directionX}if(h==0&&this._previousPoint!=null){if(a.y<d)a.directionY=-1;else if(a.y>d)a.directionY=1;this._previousPoint.directionY=a.directionY}if(e>0&&a.x+this._params.shiftThreshold<c)a.directionX=-1;else if(e<0&&a.x-this._params.shiftThreshold>c)a.directionX=1;if(h>0&&a.y+this._params.shiftThreshold<d)a.directionY=-1;else if(h<0&&a.y-this._params.shiftThreshold>d)a.directionY=1;this._pointStatement.push(a);this._previousPoint=a},_getCurrentMovement:function(){var a=
this._pointStatement[this._pointStatement.length-1];return{pointStatement:this._pointStatement,duration:a.globalDuration,dx:a.globalDx,dy:a.globalDy}}};return b.ux.MovementTracker});
define(["../../../_amd/core"],function(b){b.ux.window={height:null,width:null,fullHeight:null,fullWidth:null,screenHeight:screen.height,screenWidth:screen.width,orientation:null,_i:null,_V:"vertical",_H:"horizontal",_init:function(){var a=b.bind(this._updateData,this);"onorientationchange"in window?window.addEventListener("orientationchange",a,true):window.addEventListener("resize",a,true);if(b.ua.isAndroid){scrollTo(0,1,0);this._i=setInterval(a,1E3)}else window.addEventListener("scroll",a,true);
a()},_updateData:function(){var a=window.innerWidth,c=window.innerHeight,d=false;if(this.width+2<a||this.width-2>a||this.height+2<c||this.height-2>c)d=true;this._updateSize();this._updateOrientation();d&&b.publish("/window/events/resize",{height:c,width:a,orientation:this.orientation})},_updateSize:function(){this.height=window.innerHeight;this.width=window.innerWidth;try{this.fullHeight=document.body.scrollHeight;this.fullWidth=document.body.scrollWidth}catch(a){}},_updateOrientation:function(){var a;
a=b.isSet(window.orientation)&&b.ua.isIOS?Math.abs(window.orientation)==90?this._H:this._V:this.width>this.height?this._H:this._V;if(a!=this.orientation){this.orientation=a;b.publish("/window/events/orientationchange",{height:this.height,width:this.width,orientation:a})}}};window.addEventListener("DOMContentLoaded",function(){b.ux.window._init()});b.ux.Window=function(){this.getProperties=function(){return{screenWidth:b.ux.window.screenWidth,screenHeight:b.ux.window.screenHeight,width:b.ux.window.width,
height:b.ux.window.height,orientation:b.ux.window.orientation}}};return b.ux.window});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker","../../../../ux/gesture/js/gesture","../../../../ux/window/js/window"],function(b){b.ui.xyz.CoverFlow=function(a){this.uId=b.getUId();this.backgroundColor=this.covers=null;this.fadeEdges=this.displayTitle=this.reflected=false;this.size=0;this.viewportWidth=null;this.handleOrientationChange=this.handleGesture=false;this.coverSpacing=null;this.borderSize=
this.displayTitleDuration=0;this._timerTitle=this._lastRenderedIndex=this._middleViewIndex=this._renderer=this._transformsQueue=this._transformations=this._positions=this._movementtracker=this._faderRight=this._faderLeft=this._gestureNode=this._trayNode=this._domNode=null;this._flipping=this._displayMode=this._dragging=false;this._view={x:0,sizeX:0,shiftX:25,shiftFromMiddle:200,coverRotation:55,coverScale:0.28,zMiddleCover:175,zAroundCover:0,numberOfCoverToRender:5,distanceToCenter:0,distanceFromTop:0,
zGestureNode:1E3,observerRotation:0,currentObserverRotation:0};b.mixin(this,a);if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};b.ui.xyz.CoverFlow.prototype={_Z_INDEX_BACKGROUND:5,_DURATION_BACKTO_BOUND:200,_DURATION_MIDDLE:600,_DURATION_AROUND:300,_DURATION_FLIP:1E3,_TRANSITION_FUNC:"default",_OUTOFBOUND_FRICTIONAL_FORCES:4,_RENDERER_INTERVAL:15,_DELAY_BEFORE_IMAGE_LOADING:50,_PERSPECTIVE:500,_REFLECTION_ATTENUATION:0.6,_DELAY_FOR_TITLE_DISPLAY:400,
getDomNode:function(){return this._domNode},updateSize:function(a,c){this.size=a;this.viewportWidth=c;var d=this._view,f=0.07;if(b.isSet(this.coverSpacing))f=this.coverSpacing*0.0030;d.shiftX=f*a;this._positions=[];var g;f=this.covers;var e=f.length;for(g=0;g<e;g++)this._positions[g]=d.shiftX*g;d.sizeX=this._positions[e-1];d.shiftFromMiddle=0.7*a;g=Math.max(c/a-1,0);d.distanceToCenter=g*(a/2);d.distanceFromTop=a*(d.coverScale/1.5);d=a*(1+g);g=d+"px";var h=a+"px";b.fx.apply(this._domNode,{width:g,
height:h});b.fx.apply(this._trayNode,{width:g,height:h});b.fx.apply(this._gestureNode,{width:g,height:h});for(g=0;g<e;g++){var i=f[g];b.fx.apply(i.coverNode,{width:h,height:h});b.fx.apply(i.coverInnerNode,{width:h,height:h});b.fx.apply(i.imageNode,{width:h,height:h});b.fx.apply(i.coverReflection,{width:h});this.reflected&&b.fx.apply(i.coverReflectionBack,{width:h,height:this._REFLECTION_ATTENUATION*a+"px"});this.displayTitle&&b.fx.apply(i.titleNode,{width:h})}if(this.fadeEdges){f=this._faderLeft;
e=this._faderRight;g=c/15;f.width=g;f.height=a;e.width=g;e.height=a;e.style.left=d-g+1+"px";this._updateEdgeFaders()}this._createTransformations();this._initTransformations();this._slideTo(this._positions[this._currentPosition],true)},setBackgroundColor:function(a){var c=this.backgroundColor=a;a=this.borderSize;var d={r:255-c.r,g:255-c.g,b:255-c.b};c="rgba("+c.r+", "+c.g+", "+c.b+", 1.0)";this._domNode.style.backgroundColor=c;d=a+"px -"+a+"px 6px rgba("+d.r+", "+d.g+", "+d.b+", 0.5)";var f,g=this.covers,
e=g.length;for(f=0;f<e;f++){var h=g[f];if(this.reflected)h.coverReflectionBack.style.backgroundColor=c;b.isSet(a)&&a>0&&b.fx.apply(h.imageNode,{"box-shadow":d})}this.fadeEdges&&this._updateEdgeFaders()},getPosition:function(){return this._currentPosition},setPosition:function(a){this._slideTo(this._positions[a],true)},_validateProperties:function(){return true},_isValidCover:function(a){var c=true;return c=(c=(c=c&&b.isSet(a))&&b.isSet(a.image))&&b.isSet(a.title)},_initProperties:function(){var a=
this.position;if(a!==0&&!a)a=Math.floor(this.covers.length/2);this._currentPosition=a;this._view.x=0;this._middleViewIndex=Math.floor(this._view.numberOfCoverToRender/2);this._lastRenderedIndex=this._currentPosition;this._transformsQueue=[];this.handleOrientationChange===true&&b.subscribe("/window/events/orientationchange",{context:this,method:"_onOrientationChange"})},_initDom:function(){var a=this._domNode=document.createElement("div");b.fx.apply(a,{"user-select":"none"});var c=this._trayNode=document.createElement("div");
c.style.position="absolute";a.appendChild(c);b.fx.apply(c,{"transform-style":"preserve-3d"});var d=this._gestureNode=document.createElement("div");d.style.position="absolute";a.appendChild(d);var f=this.covers,g=f.length;for(d=0;d<g;d++){var e=f[d],h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("div"),o=document.createElement("img"),m=document.createElement("div");j.appendChild(o);j.appendChild(m);i.appendChild(j);h.appendChild(i);c.appendChild(h);h.style.position=
"absolute";j.style.position="absolute";e.coverNode=h;e.coverOutlineNode=i;e.coverInnerNode=j;e.imageNode=o;e.coverReflection=m;e.transformation=null;e.diffTransform=true;e.displayed=false;if(this.reflected){h=document.createElement("canvas");i=document.createElement("div");m.appendChild(h);m.appendChild(i);h.style.position="absolute";i.style.position="absolute";e.coverReflectionFront=h;e.coverReflectionBack=i}if(this.displayTitle){h=document.createElement("div");m.appendChild(h);h.style.position=
"absolute";m=$(e.title);h.appendChild(m);e.titleNode=h;e.titleInnerNode=m}b.fx.apply(e.coverNode,{perspective:this._PERSPECTIVE,"transform-style":"preserve-3d"});b.fx.apply(e.coverOutlineNode,{"transform-style":"preserve-3d"})}if(this.fadeEdges){c=this._faderLeft=document.createElement("canvas");d=this._faderRight=document.createElement("canvas");a.appendChild(c);a.appendChild(d);c.style.position="absolute";d.style.position="absolute"}this._hideBackFaces();this._organizeDepth();this.updateSize(this.size,
this.viewportWidth);this.setBackgroundColor(this.backgroundColor);b.setTimeout(this,"_setImages",this._DELAY_BEFORE_IMAGE_LOADING)},_initListeners:function(){this._movementtracker=new b.ux.MovementTracker({target:this._gestureNode});b.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});b.subscribe("/movementtracker/events/mvtchanged",{context:this,method:"_handleMovementChanged"});b.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"});
if(this.handleGesture){this._gestureNode.listenToGesture("instant_rotation",{context:this,method:"_handleRotation",arguments:null},{preventDefault:true});this._gestureNode.listenToGesture("gesture_end",{context:this,method:"_handleGestureEnd",arguments:null},{preventDefault:true})}},_handleRotation:function(a){if(this._displayMode==false){var c=this._view;a=c.observerRotation+a.rotation;if(!(a>17||a<-70)){c.currentObserverRotation=a;var d=this.covers,f=d.length;for(a=0;a<f;a++){var g=d[a];b.fx.setTransformPart(g.coverOutlineNode,
3,{type:"rotate",x:1,y:0,z:0,angle:c.currentObserverRotation});b.fx.applyComposedTransform(g.coverOutlineNode)}}}},_handleGestureEnd:function(){if(this._displayMode==false)this._view.observerRotation=this._view.currentObserverRotation},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId)this._dragging=false},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(!this._displayMode){var c=a.movement;a=c.pointStatement[c.pointStatement.length-
1];c=a.x-c.pointStatement[c.pointStatement.length-2].x;c/=2;var d=this._getBoundsInfos(this._view.x);if(d.outsideOfBounds)if(d.direction>0&&a.directionX>0||d.direction<0&&a.directionX<0)c/=this._OUTOFBOUND_FRICTIONAL_FORCES;this._dragging=true;this._slideTo(this._view.x-c)}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(!this._flipping){var c=this._currentPosition,d=a.movement.pointStatement[a.movement.pointStatement.length-1],f=this._domNode.getPosition(null,
true);if(this._displayMode)if(this._onMiddleCover(d.x-f.x,d.y-f.y)){c=a.uxEvent;c.dispatch(c.target,"click")}else{this._flipping=true;this._unflipCover(c)}else if(this._onMiddleCover(d.x-f.x,d.y-f.y)){a=this.covers[c];if(b.isSet(a.action))b.isCallback(a.action)?b.call(a.action,a):b.log("[CoverFlow] Invalid action for cover : "+c);else if(b.isSet(a.backFaceId)){this._flipping=true;this._prepareCoverBackFace(c);b.setTimeout(this,"_flipCover",1,c)}}}}else this._backToBounds()},_prepareCoverBackFace:function(a){a=
this.covers[a];var c=$(a.backFaceId);b.fx.apply(c,{display:"block",position:"absolute",width:this.size+"px",height:this.size+"px","backface-visibility":"hidden"});b.fx.apply(a.coverInnerNode,{"transform-origin-z":this._view.zMiddleCover+"px","backface-visibility":"hidden"});b.fx.set3dTransform(c,{type:"rotate",x:0,y:1,z:0,angle:180});b.fx.applyTransformTransition(a.coverOutlineNode,"0ms","0ms",this._TRANSITION_FUNC);b.fx.setTransformPart(a.coverOutlineNode,2,{type:"translate",x:0,y:0,z:this._view.zMiddleCover});
b.fx.applyComposedTransform(a.coverOutlineNode);a.coverOutlineNode.appendChild(c)},_flipCover:function(a){var c=this.covers[a];b.fx.onTransitionEnd(c.coverOutlineNode,b.bind(this._postFlipCover,this,a));b.fx.applyTransformTransition(c.coverOutlineNode,this._DURATION_FLIP+"ms","0ms",this._TRANSITION_FUNC);b.fx.setTransformPart(c.coverOutlineNode,1,{type:"rotate",x:0,y:1,z:0,angle:180});b.fx.setTransformPart(c.coverOutlineNode,2,{type:"translate",x:0,y:this._view.distanceFromTop,z:this._view.zMiddleCover*
1.5});b.fx.setTransformPart(c.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:0});b.fx.applyComposedTransform(c.coverOutlineNode);this._displayMode=true},_postFlipCover:function(){this._flipping=false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND;b.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zMiddleCover/2})},_unflipCover:function(a){var c=this.covers[a];b.fx.setTransformPart(c.coverOutlineNode,1,{type:"rotate",x:0,y:1,z:0,angle:0});b.fx.setTransformPart(c.coverOutlineNode,
2,{type:"translate",x:0,y:0,z:0});b.fx.setTransformPart(c.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:this._view.currentObserverRotation});b.fx.applyComposedTransform(c.coverOutlineNode);b.fx.apply(c.coverInnerNode,{"transform-origin-z":"0px"});b.fx.onTransitionEnd(c.coverOutlineNode,b.bind(this._postUnflipCover,this,a))},_postUnflipCover:function(a){a=this.covers[a];b.fx.applyTransformTransition(a.coverOutlineNode,"0ms","0ms",this._TRANSITION_FUNC);$(a.backFaceId).style.display="none";this._flipping=
this._displayMode=false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND+4;b.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},_onOrientationChange:function(a){this.updateSize(this.size,a.width)},_getPosition:function(a){var c=null,d,f=this._positions,g=f.length;for(d=0;d<g;d++){c=d;if(a<f[d]+this._view.shiftX/2)break}return c},_slideTo:function(a,c){var d=this._view,f=b.math.round(a,2);if(f!=d.x||c===true){d.x=f;b.fx.set3dTransform(this._trayNode,{type:"translate",
x:-d.x+d.distanceToCenter,y:-d.distanceFromTop,z:0});this._updateView()}},_updateView:function(){var a=this._getPosition(this._view.x);if(a!=this._currentPosition){this._currentPosition=a;this._addToQueue(this._currentPosition)}},_startRenderer:function(){if(this._renderer==null)this._renderer=b.setTimeout(this,"_rendererProcess",1)},_stopRenderer:function(){if(this._renderer!=null){clearTimeout(this._renderer);this._renderer=null}},_rendererProcess:function(){var a=this._transformsQueue,c=a.length,
d=a[0];if(d.rendering==false){d.rendering=true;a=d.position;b.fx.onTransitionEnd(this.covers[a].coverInnerNode,b.bind(this._handleCoverRendered,this,a));this._updateTransformations(a);d=b.math.round(this._DURATION_MIDDLE/(c*2),0);c=b.math.round(this._DURATION_AROUND/(c*2),0);this._updateTransitions(a,d,c);this._applyTransformations()}else if(d.rendered==true){a.shift();c=a.length;if(c==0){this._stopRenderer();return}}else c>1&&this._handleCoverRendered(d.position);this._renderer=b.setTimeout(this,
"_rendererProcess",this._RENDERER_INTERVAL)},_handleCoverRendered:function(a){this._lastRenderedIndex=a;a=this._transformsQueue;if(a.length!=0)a[0].rendered=true},_addToQueue:function(a){this._transformsQueue.push({timestamp:(new Date).getTime(),position:a,rendered:false,rendering:false});this._startRenderer()},_updateTransformations:function(a){var c=this._middleViewIndex+(Math.abs(this._lastRenderedIndex-a)-1),d=a-c,f=a+(c+1),g=this.covers,e=g.length;if(a<c)d=0;if(f>e)f=e;for(c=0;c<e;c++)g[c].diffTransform=
false;for(c=d;c<f;c++){d=g[c];d.oldTransformation=d.transformation;d.transformation=this._getTargetedTransformation(c,a);d.diffTransform=this._transformationsDifferent(d.oldTransformation,d.transformation)}},_updateTransitions:function(a,c,d){var f,g=this.covers,e=g.length;for(f=0;f<e;f++){var h=g[f];if(h.diffTransform){var i=this._TRANSITION_FUNC;f==a?b.fx.applyTransformTransition(h.coverInnerNode,c+"ms","0ms",i):b.fx.applyTransformTransition(h.coverInnerNode,d+"ms","0ms",i)}}},_applyTransformations:function(){var a=
this._currentPosition,c=this.covers,d=c.length,f=Math.floor(d/2),g;for(g=0;g<d;g++){var e=c[g],h=e.coverNode,i=e.coverInnerNode,j=e.depth1;if(g<f&&g>=a||g>=f&&g<=a)j=e.depth2;if(e.depth!=j){e.depth=j;b.fx.setTransformPart(h,2,{type:"translate",x:this._positions[g],y:0,z:j});b.fx.applyComposedTransform(h)}if(e.diffTransform){b.fx.setTransformPart(i,1,e.transformation.rotation);b.fx.setTransformPart(i,2,e.transformation.translation);b.fx.applyComposedTransform(i);if(this.displayTitle){h=this.displayTitleDuration;
if(g==this._currentPosition)if(h>0){if(b.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}this._timerTitle=b.setTimeout(this,"_showTitle",this._DELAY_FOR_TITLE_DISPLAY,g)}else this._showTitle(g);else{h>0&&b.fx.applyTransition(e.titleNode,"opacity","0ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(g,0)}}}}},_transformationsDifferent:function(a,c){return a.rotation.angle!=c.rotation.angle},_initTransformations:function(){var a=this.covers,c=a.length,d=Math.floor(c/
2),f,g=0,e=c-1+d;for(f=0;f<c;f++){var h=a[f],i=h.coverNode;if(f<=d){g++;e--}else{g--;e++}h.depth1=g;h.depth2=e;b.fx.initComposedTransform(i);b.fx.setTransformPart(i,1,{type:"scale",x:this._view.coverScale,y:this._view.coverScale,z:1});b.fx.initComposedTransform(h.coverOutlineNode);b.fx.initComposedTransform(h.coverInnerNode);h.transformation=this._getTargetedTransformation(f,this._currentPosition)}this._applyTransformations();b.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},
_createTransformations:function(){var a=this._view,c=a.coverRotation,d=a.zAroundCover,f=a.shiftFromMiddle;this._transformations={left:{rotation:{type:"rotate",x:0,y:1,z:0,angle:c},translation:{type:"translate",x:-f,y:0,z:d}},middle:{rotation:{type:"rotate",x:0,y:1,z:0,angle:0},translation:{type:"translate",x:0,y:0,z:a.zMiddleCover}},right:{rotation:{type:"rotate",x:0,y:1,z:0,angle:-c},translation:{type:"translate",x:f,y:0,z:d}}}},_getTargetedTransformation:function(a,c){var d=this._transformations;
return a<c?d.left:a>c?d.right:d.middle},_showTitle:function(a){if(b.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}if(a==this._currentPosition){var c=this.displayTitleDuration;c>0&&b.fx.applyTransition(this.covers[a].titleNode,"opacity",c+"ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(a,1)}},_setTitleOpacity:function(a,c){this.covers[a].titleNode.style.opacity=c},_hideBackFaces:function(){var a,c=this.covers,d=c.length;for(a=0;a<d;a++){var f=c[a];if(b.isSet(f.backFaceId))$(f.backFaceId).style.display=
"none"}},_setImages:function(){var a,c=this.covers,d=c.length;for(a=0;a<d;a++){var f=c[a];this.reflected&&this._applyReflection(a);f.imageNode.src=f.image}},_organizeDepth:function(){var a=this._Z_INDEX_BACKGROUND;this._domNode.style.zIndex=a;this._trayNode.style.zIndex=a+1;this._gestureNode.style.zIndex=a+4;if(this.reflected){var c,d=this.covers,f=d.length;for(c=0;c<f;c++){var g=d[c];if(this.displayTitle)g.titleNode.style.zIndex=a+4;g.coverReflectionFront.style.zIndex=a+3;g.coverReflectionBack.style.zIndex=
a+2}}if(this.fadeEdges){this._faderLeft.style.zIndex=a+4;this._faderRight.style.zIndex=a+4}},_applyReflection:function(a){var c=this.covers[a],d=c.imageNode,f=c.coverReflectionFront;c.imageLoadingHandler=b.bind(function(){this._reflect(a,d,f,d.width,d.height)},this);d.addEventListener("load",c.imageLoadingHandler)},_reflect:function(a,c,d,f,g){d.width=f;d.height=g;d=d.getContext("2d");d.save();d.translate(0,g/1.5);d.scale(1,-1);d.drawImage(c,0,0,f,g/1.5);d.restore();d.globalCompositeOperation="destination-out";
var e=d.createLinearGradient(0,0,0,g);e.addColorStop(0,"rgba(255, 255, 255, "+this._REFLECTION_ATTENUATION+")");e.addColorStop(0.6,"rgba(255, 255, 255, 1.0)");d.fillStyle=e;d.fillRect(0,0,f,g);c.removeEventListener("load",this.covers[a].imageLoadingHandler)},_updateEdgeFaders:function(){var a=this.backgroundColor,c=this._faderLeft,d=this._faderRight,f=c.getContext("2d"),g=f.createLinearGradient(0,0,c.width,0);g.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");g.addColorStop(1,"rgba("+a.r+", "+
a.g+", "+a.b+", 0.0)");f.fillStyle=g;f.fillRect(0,0,c.width,c.height);f=d.getContext("2d");g=f.createLinearGradient(0,0,d.width,0);g.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 0.0)");g.addColorStop(1,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");f.fillStyle=g;f.fillRect(0,0,d.width,d.height)},_backToBounds:function(){var a=this._getBoundsInfos(this._view.x);if(a.outsideOfBounds){this._slideTo(a.positionOfBound,this._DURATION_BACKTO_BOUND);return true}return false},_getBoundsInfos:function(a){var c=
this._view,d={};d.outsideOfBounds=false;if(a<0||a>c.sizeX){d.outsideOfBounds=true;if(a<0){d.distanceToBound=Math.abs(a);d.direction=1;d.positionOfBound=0}else{d.distanceToBound=Math.abs(a-c.sizeX);d.direction=-1;d.positionOfBound=c.sizeX}}return d},_onMiddleCover:function(a,c){var d=this._view,f=this.size,g=b.math.round,e=g(f*d.coverScale*1.5,0),h=g(f/2-e/2-d.distanceFromTop,0),i=g(f/2-e/2+d.distanceToCenter,0),j=h+e;e=i+e;if(this._displayMode){e=g(f*d.coverScale*2.1,0);h=g(f/2-e/2-d.distanceFromTop/
2.1,0);i=g(f/2-e/2+d.distanceToCenter,0);j=h+e;e=i+e}if(a>=i&&a<=e&&c>=h&&c<=j)return true;return false}};return b.ui.xyz.CoverFlow});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker"],function(b){b.ui.xyz.Cube=function(a){this.uId=b.getUId();this._properties=a;this._axis=this._faces=null;this._view={size:0,shiftX:0,shiftY:0,shiftZ:0,observerX:0,observerY:0,rotationX:0,rotationY:0,externalRotationX:0,externalRotationY:0};this._selectionEvent=this._radius=this._movementtracker=this._domNode=this._rotationEndCallback=this._rotationCallback=
this._dispatch=this._focusDuration=this._focus=null;this._dragging=false;this._nearestFace=this._rotations=null;if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};b.ui.xyz.Cube.prototype={getDomNode:function(){return this._domNode},rotate:function(a,c,d){this._view.externalRotationX=b.math.round((this._view.externalRotationX+a)%360,3);this._view.externalRotationY=b.math.round((this._view.externalRotationY+c)%360,3);this._rotateWithDuration(a,c,d)},
faceFocus:function(a){this._faceFocus(a)},setFace:function(a){var c=a.id-1;this._faces[c].faceNode.removeChild(this._faces[c].innerNode);for(var d in a)this._faces[c][d]=a[d];this._faces[c].innerNode=$(this._faces[c].faceId);this._faces[c].faceNode.appendChild(this._faces[c].innerNode)},_validateProperties:function(){return true},_raisePropertyError:function(a){b.log("[Cube] Error: "+a+" missing or invalid")},_isValidFace:function(a){var c=true;return c=(c=(c=(c=c&&b.isSet(a))&&b.isSet(a.id))&&b.isSet(a.faceId))&&
a.id>0&&a.id<7},_initProperties:function(){this._faces=[].concat(this._properties.faces);this._view.size=this._properties.size;this._radius=this._view.size/2;this._axis=null;if(b.isSet(this._properties.axis)&&(this._properties.axis=="x"||this._properties.axis=="y"||this._properties.axis=="xy"))this._axis=this._properties.axis;if(b.isSet(this._view.shiftX))this._view.shiftX=this._properties.shiftX;if(b.isSet(this._view.shiftY))this._view.shiftY=this._properties.shiftY;if(b.isSet(this._properties.shiftZ))this._view.shiftZ=
this._properties.shiftZ;this._view.observerX=this._radius;if(b.isSet(this._properties.observerX))this._view.observerX=this._properties.observerX;this._view.observerY=this._radius;if(b.isSet(this._properties.observerY))this._view.observerY=this._properties.observerY;this._focus=false;if(this._properties.focus===true)this._focus=true;this._focusDuration=0;if(b.isSet(this._properties.focusDuration)&&this._properties.focusDuration>0)this._focusDuration=this._properties.focusDuration;this._dispatch=false;
if(this._properties.dispatch===true)this._dispatch=true;this._rotationCallback=null;if(b.isSet(this._properties.rotationCallback))this._rotationCallback=this._properties.rotationCallback;this._rotationEndCallback=null;if(b.isSet(this._properties.rotationEndCallback))this._rotationEndCallback=this._properties.rotationEndCallback},_initDom:function(){this._domNode=document.createElement("div");b.fx.apply(this._domNode,{position:"absolute","user-select":"none",perspective:800,"perspective-origin":this._view.observerX+
"px "+this._view.observerY+"px",width:this._view.size+"px",height:this._view.size+"px",left:this._view.shiftX+"px",top:this._view.shiftY+"px"});this._cubeNode=document.createElement("div");b.fx.apply(this._cubeNode,{"transform-style":"preserve-3d",width:this._view.size+"px",height:this._view.size+"px"});this._domNode.appendChild(this._cubeNode);for(var a=0;a<this._faces.length;a++){var c=this._faces[this._faces[a].id-1];c.faceNode=document.createElement("div");b.fx.apply(c.faceNode,{position:"absolute",
width:this._view.size+"px",height:this._view.size+"px"});c.innerNode=$(c.faceId);this._cubeNode.appendChild(c.faceNode);c.faceNode.appendChild(c.innerNode)}this._initTransformations()},_initListeners:function(){if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=null){this._movementtracker=new b.ux.MovementTracker({target:this._domNode});b.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});b.subscribe("/movementtracker/events/mvtchanged",
{context:this,method:"_handleMovementChanged"});b.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"})}},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId){this._dragging=false;this._selectionEvent=a.uxEvent;b.fx.applyTransformTransition(this._cubeNode,"0ms","0ms","linear")}},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=
null){a=a.movement;var c=a.pointStatement[a.pointStatement.length-2],d=a.pointStatement[a.pointStatement.length-1];a=d.x-c.x;c=d.y-c.y;d=b.math.getAngle(this._view.size,a);if(a<0)d=-d;a=b.math.getAngle(this._view.size,c);if(c<0)a=-a;this._dragging=true;c=b.math.round(b.math.radToDeg(d),3);a=b.math.round(b.math.radToDeg(a),3);this._rotate(c,a);this._view.externalRotationX=b.math.round((this._view.externalRotationX+c)%360,3);this._view.externalRotationY=b.math.round((this._view.externalRotationY+a)%
360,3);this._notifyRotation({x:c,y:a})}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(this._dispatch&&b.isSet(this._selectionEvent)){this._selectionEvent.dispatch(this._selectionEvent.target,"click");this._selectionEvent=null}}else{this._storeRotation();this._notifyRotationEnd({x:this._view.externalRotationX,y:this._view.externalRotationY});this._view.externalRotationX=0;this._view.externalRotationY=0;this._focus==true&&this._faceFocus(this._focusDuration)}},
_notifyRotation:function(a){this._rotationCallback!=null&&b.call(this._rotationCallback,a)},_notifyRotationEnd:function(a){this._rotationEndCallback!=null&&b.call(this._rotationEndCallback,a)},_rotateWithDuration:function(a,c,d){b.fx.applyTransformTransition(this._cubeNode,d+"ms","0ms","linear");this._rotate(a,c,true);this._storeRotation()},_faceFocus:function(a){this._updateNearestFace();b.fx.removeComposedTransform(this._cubeNode);b.fx.initComposedTransform(this._cubeNode);this._view.rotationX=
0;this._view.rotationY=0;this._storeRotation();this._initNormalVectors();var c=this._rotations[this._nearestFace.index];this.rotate(c.y*-c.angle,c.x*c.angle,a)},_updateNearestFace:function(){this._nearestFace={index:0,angle:0};for(var a=0;a<6;a++)if(this._faces[a].angle>this._nearestFace.angle){this._nearestFace.index=a;this._nearestFace.angle=this._faces[a].angle}},_initTransformations:function(){this._rotations=[];this._rotations[0]={type:"rotate",x:1,y:0,z:0,angle:0};this._rotations[1]={type:"rotate",
x:0,y:1,z:0,angle:90};this._rotations[2]={type:"rotate",x:0,y:1,z:0,angle:180};this._rotations[3]={type:"rotate",x:0,y:1,z:0,angle:-90};this._rotations[4]={type:"rotate",x:1,y:0,z:0,angle:90};this._rotations[5]={type:"rotate",x:1,y:0,z:0,angle:-90};this._initNormalVectors();for(var a=0;a<this._faces.length;a++){b.fx.initComposedTransform(this._faces[a].faceNode);b.fx.setTransformPart(this._faces[a].faceNode,1,{type:"translate",x:0,y:0,z:this._radius});b.fx.setTransformPart(this._faces[a].faceNode,
2,this._rotations[a]);b.fx.applyComposedTransform(this._faces[a].faceNode)}b.fx.initComposedTransform(this._cubeNode);b.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});b.fx.applyComposedTransform(this._cubeNode)},_rotate:function(a,c,d){if(this._axis=="y"||this._axis=="xy"||d){this._view.rotationX=b.math.round((this._view.rotationX+a)%360,3);b.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX})}if(this._axis=="x"||this._axis==
"xy"||d){this._view.rotationY=b.math.round((this._view.rotationY-c)%360,3);b.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY})}b.fx.applyComposedTransform(this._cubeNode)},_storeRotation:function(){b.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX});b.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY});b.fx.setTransformPart(this._cubeNode,3,null);b.fx.storeComposedTransform(this._cubeNode);
b.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});b.fx.applyComposedTransform(this._cubeNode);this._updateNormalVectors();this._view.rotationX=0;this._view.rotationY=0},_initNormalVectors:function(){for(var a=[0,0,1],c=0;c<6;c++){var d=b.math.createTransformMatrix();d.rotateAxisAngle(this._rotations[c].x,this._rotations[c].y,this._rotations[c].z,-this._rotations[c].angle);this._faces[c].normalVector=b.math.multiplyMatrixVector(d.getValues(),a)}},_updateNormalVectors:function(){for(var a=
[0,0,-1],c=0;c<6;c++){var d=b.math.createTransformMatrix();d.rotateAxisAngle(0,1,0,-this._view.rotationX);d.rotateAxisAngle(1,0,0,-this._view.rotationY);this._faces[c].normalVector=b.math.multiplyMatrixVector(d.getValues(),this._faces[c].normalVector);d=b.math.getAngleBetweenVectors(a,this._faces[c].normalVector);this._faces[c].angle=b.math.radToDeg(d)}}};return b.ui.xyz.Cube});

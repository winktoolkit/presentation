define=function(){if(typeof wink=="undefined")wink={};var c=arguments,a=c.length;return(a==1?c[0]:a==2?c[1]:c[2])(wink)};define.amd={vendor:"winktoolkit.org"};define(function(){if(typeof wink=="undefined")wink={};return wink});
define(["../../_kernel/js/kernel"],function(c){c.version="1.4.2";c.api={};c.mm={};c.net={};c.plugins={};c.ui={form:{},layout:{},xy:{},xyz:{}};c.ux={};var a=Array.prototype.slice,b=window;c.byId=function(e){return c.isString(e)?document.getElementById(e):e};c.query=function(e,f){return new d(e,f)};var d=function(){var e=function(h,k){c.isUndefined(e.prototype.initialized)&&this.init();var n;try{n=a.call((k||document).querySelectorAll(h))}catch(r){n=[]}for(var o=this.length=n.length,m=0;m<o;m++)this[m]=
n[m];this.selector=h;return this},f=e.prototype={init:function(){f.each(["pop","push","reverse","shift","sort","splice","unshift","slice","indexOf","lastIndexOf"],function(h,k){f[k]=[][k]});c.query.extend(c,["getPosition","getTopPosition","getLeftPosition"],true);c.query.extend(c.fx,["getTransformPosition","hasClass"],true);c.query.extend(c.fx,["translate","rotate","scale","addClass","removeClass","apply","applyTransition","applyTransformTransition","onTransitionEnd"],false);c.query.extend(c.ux.gesture,
["listenTo","unlistenTo"],false);f.initialized=true},extend:function(h,k,n,r){var o=r||f;r={};var m,l=k.length;for(m=0;m<l;m++){var p=k[m],q=h?h[p]:null;if(c.isFunction(q))r[p]={c:h,f:q,r:n}}f.each(r,function(s,t){var u=t.f,w=t.c,v=t.r;o[s]=function(){var y=this.size();if(y!=0){var B,C=this.toArray(),z=[],x=this.splice.call(arguments,0);for(B=0;B<y;B++)z.push(u.apply(w,[C[B]].concat(x)));if(!v)return this;if(z.length==1)return z[0];return z}}})},size:function(){return this.length},toArray:function(){return a.call(this,
0)},each:function(h,k){for(i in h){var n=h[i];k.call(n,i,n)}}};return e}();c.query.extend=d.prototype.extend;var g="en_EN";c.setLocale=function(e){g=e};c.translate=function(e,f){var h=e,k=window.i18n||{};if(c.isSet(f)&&c.isSet(f.i18n))k=f.i18n;var n=k[g];if(c.isUndefined(n))n=k;k=n[e];c.isUndefined(k)||(h=k);return h};c.isUndefined=function(e){return e===undefined};c.isNull=function(e){return e===null};c.isSet=function(e){return!c.isUndefined(e)&&!c.isNull(e)};c.isCallback=function(e){return!!(e&&
e.method||c.isFunction(e))};c.isString=function(e){return typeof e=="string"||e instanceof String};c.isInteger=function(e){return parseInt(e)===e};c.isNumber=function(e){return typeof e=="number"||e instanceof Number};c.isArray=function(e){return typeof e=="array"||e instanceof Array};c.isBoolean=function(e){return typeof e=="boolean"||e instanceof Boolean};c.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"};c.trim=function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,
"")};c.bind=function(e,f){var h=a.call(arguments,2);return function(){var k=h.concat(a.call(arguments,0));return e.apply(f,k)}};c.call=function(e,f){if(c.isFunction(e))return e.apply(b,c.isArray(f)?f:[f]);var h=b,k=e.method,n=[];if(c.isSet(e.context))h=e.context;if(arguments.length==2)n=[f];if(c.isSet(e.arguments)){var r=e.arguments;c.isArray(r)||(r=[e.arguments]);n=n.concat(r)}return h[k].apply(h,n)};c.connect=function(e,f,h){var k=c.isFunction(h);if(!k&&!c.isSet(h.context))h.context=b;var n=e[f];
if(c.isNull(n)||c.isUndefined(n.cbs)){var r=function(){var l=r.target,p=[].splice.call(arguments,0);l&&l.apply(e,p);var q=r.cbs,s=q.length;for(l=0;l<s;l++){var t=q[l];c.isFunction(t)?c.call(t,p):c.call({context:t.context,method:t.method,arguments:p.concat(t.arguments)})}};r.target=n;r.cbs=[];n=e[f]=r}n=n.cbs;var o=n.length;for(f=0;f<o;f++){var m=n[f];if(k&&h==m||!k&&m.context==h.context&&m.method==h.method)return}n.push(h)};c.disconnect=function(e,f,h){var k=c.isFunction(h);if(!k&&!c.isSet(h.context))h.context=
b;e=e[f];if(!c.isUndefined(e.cbs)){f=e.cbs;var n=f.length;for(e=0;e<n;e++){var r=f[e];if(k&&h==r||!k&&r.context==h.context&&r.method==h.method){f.splice(e,1);break}}}};c.setTimeout=function(e,f,h){var k=a.call(arguments,3);return setTimeout(function(){e[f].apply(e,k)},h)};c.setInterval=function(e,f,h){var k=a.call(arguments,3);return setInterval(function(){e[f].apply(e,k)},h)};c.getPosition=function(e,f,h){var k={x:0,y:0};for(e=e;e&&e!=f;){k.x+=e.offsetLeft;k.y+=e.offsetTop;if(h){k.x+=c.fx.getTransformPosition(e).x;
k.y+=c.fx.getTransformPosition(e).y}e=e.offsetParent}return k};c.getTopPosition=function(e,f,h){return c.getPosition(e,f,h).y};c.getLeftPosition=function(e,f,h){return c.getPosition(e,f,h).x};var j=100;c.getUId=function(){return j+=1};if(c.isUndefined(b._))_=c.bind(c.translate,c);if(c.isUndefined(b.$))$=function(){return c.query.apply(c,arguments)};if(c.isUndefined(b.$$))$$=c.bind(c.query,c);return c});define(["../../../_amd/core"],function(){return wink});
define(["../../../_amd/core"],function(){wink.error={logLevel:0,log:function(c){if(this.logLevel==1)typeof console!="undefined"?console.log(c):alert(c)}};wink.log=wink.bind(wink.error.log,wink.error);return wink.error});
define(["../../../_amd/core"],function(){var c=window.JSON;wink.json={parse:function(a){if(wink.isSet(c)&&wink.isSet(c.parse))return c.parse(a);else{var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;a=String(a);b.lastIndex=0;if(b.test(a))a=a.replace(b,function(g){return"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))var d=eval("("+a+")");return d}},concat:function(a,b){for(var d in b)a[d]=b[d];return a}};wink.parseJSON=wink.bind(wink.json.parse,wink.json);wink.mixin=wink.bind(wink.json.concat,wink.json);return wink.json});
define(["../../../_amd/core"],function(){function c(g,j){if(wink.isCallback(j)){var e=[g.toLowerCase(),j];d.push(e)}}function a(g,j){var e=g.toLowerCase(),f=wink.isFunction(j),h,k=d.length;for(h=0;h<k;h++){var n=d[h];if(n[0]==e&&(f&&j==n[1]||!f&&n[1].method==j.method&&n[1].context==j.context)){d.splice(h,1);break}}}function b(g,j){var e=g.toLowerCase(),f,h=d.length;for(f=0;f<h;f++){var k=d[f];k&&k[0]==e&&wink.isSet(k[1])&&wink.call(k[1],j)}}var d=[];wink.topics={_getTopics:function(){return d}};wink.topics.subscribe=
c;wink.topics.unsubscribe=a;wink.topics.publish=b;wink.publish=b;wink.subscribe=c;wink.unsubscribe=a;return wink.topics});
define(["../../../_amd/core"],function(){var c,a,b,d,g,j,e,f,h,k,n,r,o,m,l,p,q,s,t,u,w,v,y,B;c=a=b=d=g=j=e=f=w=v=y=B=false;h=k=n=r=o=m=l=p=q=0;var C=wink.isSet;a=function(x,D){return RegExp(x).test(D)};var z=function(x,D,A){var E={v:0,r:0,u:0};x=RegExp(D).exec(x);if(C(x)&&x.length>1){x=x[2];D=RegExp("[^\\"+A+"0-9]").exec(x);if(C(D))x=x.slice(0,D.index);A=x.split(A);if(A.length>0)E.v=A[0];if(A.length>1)E.r=A[1];if(A.length>2)E.u=A[2];if(A.length>3)E.u+="."+A[3]}return E};c=navigator||{};s=c.userAgent;
t=c.platform;u=c.appVersion;c=a(" AppleWebKit/",s);v=a(/bada/gi,s);y=a(/Opera/gi,s);if(C(t)){if(a(/iphone/i,t))b=true;if(a(/ipod/i,t))d=true;if(a(/ipad/i,t))g=true;if(a(/blackberry/i,t))w=true}if(C(u)){if(a(/android/i,u))j=true;if(a(/safari/i,u)){e=true;t=z(u,"( Version/)([^ ]+)",".");r=t.v;o=t.r;m=t.u}if(a(/MSIE/i,u)){B=true;t=z(u,"( MSIE )([^ ]+)",".");r=t.v;o=t.r}}if(!e&&!c)f=a(/mozilla/i,s);a=b||d||j||w||v||a(" Mobile/",s);if(c){t=z(s,"( AppleWebKit/)([^ ]+)",".");h=t.v;k=t.r;n=t.u}if(a&&C(u)){l=
j?["( Android )([^ ]+)","."]:["( OS )([^ ]+)","_"];if(w)l=["( BlackBerry )([^ ]+)","."];z=z(u,l[0],l[1]);l=z.v;p=z.r;q=z.u}wink.ua={isWebkit:c,isMobile:a,isIPhone:b,isIPod:d,isIPad:g,isIOS:b||d||g,isAndroid:j,isBlackBerry:w,isBada:v,isOpera:y,isSafari:e,isMozilla:f,isIE:B,webkitVersion:h,webkitMinorVersion:k,webkitUpdateVersion:n,browserVersion:r,browserMinorVersion:o,browserUpdateVersion:m,osVersion:l,osMinorVersion:p,osUpdateVersion:q};return wink.ua});
define(["../../../_amd/core"],function(){function c(j){if(g(b[j]))b[j]=b[j]();return b[j]}function a(j,e,f){if(typeof b[j]=="undefined"){var h=e;if(f&&g(e))h=e();b[j]=h}}var b={},d={},g=wink.isFunction;wink.has=c;wink.has.prefixes=["-webkit-","-moz-","-o-","ms-","-khtml-"];wink.has.prefix=null;wink.has.inquire=a;wink.has.inquireMap=function(j,e){if(!(!j||j.length==0))for(var f in j)a(f,j[f],e)};wink.has.setProp=function(j,e){d[j]=e};wink.has.deferProp=function(j,e){d[j]=g(e)?e:function(){c(e)}};wink.has.prop=
function(j){var e=d[j];if(g(e)){e();e=d[j];if(g(e))e=j}return e||j};return wink.has});define(["../../../_amd/core"],function(){var c=wink.has,a=c.inquireMap,b=window;a({"json-parse":function(){var d;d=false;if(b.JSON&&typeof JSON.parse=="function"){d=JSON.parse('{"w":1}');d=!!(d&&d.w)}return d},"json-stringify":function(){var d;d=false;if(b.JSON&&typeof JSON.stringify=="function"){d=JSON.stringify({w:true});d=d=='{"w":true}'}return d}});return c});
define(["../../../_amd/core"],function(){function c(m){var l=false;if(typeof k[m]==r){g(m,m);l=true}else{var p=b.prefix;p=p!=null?[p]:n;var q,s=p.length;for(q=0;q<s;q++){var t,u=p[q]+m;t=u;var w=/(-)([a-z])/;for(u=u.match(w);u!=null;){t=t.replace(w,RegExp.$2.toUpperCase());u=t.match(w)}t=t;if(typeof k[t]==r){b.prefix=p[q];g(m,t);l=true;break}}}return l}function a(m){return function(){c(m)}}var b=wink.has,d=b.inquireMap,g=b.setProp,j=b.deferProp,e=window,f=e.document,h=f.createElement("div"),k=h.style,
n=b.prefixes,r="string",o={a:"transform-property",b:"transition-property",c:"transition-duration",d:"transition-delay",e:"transition-timing-function",f:"border-radius",g:"text-shadow",h:"box-shadow",i:"gradient",j:"perspective",k:"transform-origin",l:"transform-style",m:"transform",n:"css-transition",o:"css-perspective",p:"css-transform",q:"perspective-origin",r:"backface-visibility",s:"tap-highlight-color",t:"user-select",bg:"background-image",tr:"transition",an:"animation"};j(o.a,o.p);j(o.m,o.p);
j(o.b,o.n);j(o.c,o.n);j(o.d,o.n);j(o.e,o.n);j(o.f,"css-border-radius");j(o.g,"css-text-shadow");j(o.h,"css-box-shadow");j(o.i,"css-gradient");j(o.j,o.o);j(o.k,o.o);j(o.l,o.o);j(o.q,o.o);j(o.tr,o.n);j(o.an,"css-animation");j(o.r,a(o.r));j(o.s,a(o.s));j(o.t,a(o.t));d({"css-transform":function(){var m=c(o.m),l=b.prefix,p=o.m;if(l!=null)p=l+p;m?g(o.a,b.prop(o.m)):g(o.a,o.m);g(o.m,p);return m},"css-transition":function(){var m=true;return m=(m=(m=(m=(m=m&&c(o.b))&&c(o.c))&&c(o.d))&&c(o.e))&&c(o.tr)},"css-animation":function(){return c(o.an)},
"css-translate3d":function(){return b("css-matrix")},"css-border-radius":function(){return c(o.f)},"css-text-shadow":function(){return c(o.g)},"css-box-shadow":function(){return c(o.h)},"css-gradient":function(){var m=o.i,l=o.bg,p=b.prefix;p=p!=null?["",p]:[""].concat(n);var q,s=p.length;for(q=0;q<s;q++){var t=p[q]+m;k.cssText=l+":"+(t+"(linear,left top,right bottom,from(#9f9),to(white));");if(k[l]&&k[l].indexOf(m)!=-1){g(m,t);return true}}return false},"css-perspective":function(){var m=c(o.j)&&
c(o.k)&&c(o.l)&&c(o.q);m=m&&c(o.k+"-x")&&c(o.k+"-y")&&c(o.k+"-z");if(!m)return false;var l=b.prefix||"";m=f.createElement("style");m.textContent="@media ("+l+"transform-3d){#wink_has{height:2px}}";f.getElementsByTagName("head")[0].appendChild(m);h.id="wink_has";f.documentElement.appendChild(h);l=h.offsetHeight===2;m.parentNode.removeChild(m);h.parentNode.removeChild(h);return l},"css-matrix":function(){var m=e.WebKitCSSMatrix;if(typeof m=="undefined")return false;var l=new m("matrix(1,0,0,1,6,7)"),
p=l.m41==6&&l.m42==7&&l.m41==l.e&&l.m42==l.f;if(p){m=new m("matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,6,7,8,1)");p=p&&l.m41==m.m41&&l.m42==m.m42&&m.m43==8}return p},"css-matrix-stack-inversed":function(){var m=wink.ua;if(!b("css-matrix")||!m)return false;var l=m.isIOS?parseInt(""+m.osVersion+m.osMinorVersion+m.osUpdateVersion):500;m=m.isAndroid?parseInt(""+m.osVersion+m.osMinorVersion+m.osUpdateVersion):300;return l<421||m<300},"css-position-fixed":function(){var m=wink.ua;if(m.isAndroid&&m.osVersion==2&&
m.osMinorVersion==1||m.isBada)return false;if(m.isIOS)return m.osVersion<5?false:true;m=document.body;if(document.createElement&&m&&m.appendChild&&m.removeChild){if(!h.getBoundingClientRect)return null;h.innerHTML="x";h.style.cssText="position:fixed;top:100px;";m.appendChild(h);var l=m.style.height,p=m.scrollTop;m.style.height="3000px";m.scrollTop=500;var q=h.getBoundingClientRect().top;m.style.height=l;l=q===100;m.removeChild(h);m.scrollTop=p;return l}return false},"css-overflow-scrolling":function(){return c("overflow-scrolling")}});
return b});
define(["../../../_amd/core"],function(){function c(h){return"on"+f[h]in e}var a=wink.has,b=a.inquireMap,d=a.setProp,g=a.deferProp,j=window,e=j.document.documentElement,f={ts:"touchstart",tm:"touchmove",te:"touchend",gs:"gesturestart",gc:"gesturechange",ge:"gestureend",tre:"transitionend"};g(f.ts,f.ts);g(f.tm,f.tm);g(f.te,f.te);g(f.tre,f.tre);b({touchstart:function(){var h=c("ts");d(f.ts,h?f.ts:"mousedown");return h},touchmove:function(){var h=c("tm");d(f.tm,h?f.tm:"mousemove");return h},touchend:function(){var h=
c("te");d(f.te,h?f.te:"mouseup");return h},touch:function(){return a(f.ts)&&a(f.tm)&&a(f.te)},gesturestart:function(){return c("gs")},gesturechange:function(){return c("gc")},gestureend:function(){return c("ge")},gesture:function(){return a(f.gs)&&a(f.gc)&&a(f.ge)},transitionend:function(){if(a("css-transition")){var h=a.prefix,k=f.tre;if(h=="-webkit-")k="webkitTransitionEnd";else if(h=="-o-")k="oTransitionEnd";d(f.tre,k);return true}return false},hashchange:function(){return"onhashchange"in j}});
return a});
define(["../../../_amd/core"],function(){var c=wink.has.inquireMap,a=window.document,b=a.documentElement;c({dynamicBase:function(){var d,g=a.createElement("head"),j=a.createElement("body");d=a.getElementsByTagName("base");var e=location.protocol+"//"+location.host,f=e+"/old/";b.appendChild(g);b.appendChild(j);if(d.length>0){d=d[0];f=d.href}else{d=a.createElement("base");d.href=f;g.appendChild(d)}var h=a.createElement("a");h.href="rlt";j.appendChild(h);var k=h.pathname;d.href=e+"/new/";e=h.pathname;
b.removeChild(g);b.removeChild(j);d.href=f;return k!==e}});return wink.has});
define(["../../../_amd/core"],function(){function c(l,p){var q=l.className;if((" "+q+" ").indexOf(" "+p+" ")<0)l.className=q+(q?" ":"")+p}function a(l,p){var q=wink.trim((" "+l.className+" ").replace(" "+p+" "," "));if(l.className!=q)l.className=q}function b(l,p){return(" "+l.className+" ").indexOf(" "+p+" ")>=0}function d(l,p){var q,s=l.style;for(q in p){var t=r(q);s[t]=p[q]}}function g(l,p,q,s,t){var u=p;if(p.indexOf(",")==-1)u=r(p);else{p=p.split(",");var w=p.length;for(u=0;u<w;u++)p[u]=r(wink.trim(p[u]));
u=p.join(",")}d(l,{"transition-property":u,"transition-duration":q,"transition-delay":s,"transition-timing-function":t})}function j(l,p,q,s){m(l,p,q,o.u,o.u,o.u,s)}function e(l,p,q){m(l,o.u,o.u,p,q,o.u,o.u)}function f(l,p){m(l,o.u,o.u,o.u,o.u,p,o.u)}function h(l){return window.getComputedStyle(l)[r("transform-property")]}function k(l,p){d(l,{"transform-property":p})}var n=wink.isSet,r=wink.has.prop,o={u:undefined};wink.fx={};wink.fx.addClass=c;wink.fx.removeClass=a;wink.fx.hasClass=b;wink.fx.apply=
d;wink.fx.applyTransition=g;wink.fx.applyTransformTransition=function(l,p,q,s){g(l,"transform",p,q,s)};wink.fx.onTransitionEnd=function(l,p,q){var s=r("transitionend"),t=function(u){q!==true&&l.removeEventListener(s,t,false);p(u)};l.addEventListener(s,t,false);return t};wink.fx.getTransformPosition=function(l){var p={x:null,y:null};l=h(l);if(wink.has("css-matrix")){if(l=="none")l="";l=new WebKitCSSMatrix(l);p.x=l.m41;p.y=l.m42}else{var q=RegExp(/matrix/i);if(q.test(l)){q=RegExp("[, ()]+","g");l=l.split(q);
if(l.length>6&&l[0]=="matrix"){p.x=parseInt(l[5]);p.y=parseInt(l[6])}}}return p};wink.fx.applyTranslate=j;wink.fx.translate=j;wink.fx.applyScale=e;wink.fx.scale=e;wink.fx.applyRotate=f;wink.fx.rotate=f;wink.fx.getTransform=h;wink.fx.setTransform=k;var m=function(l,p,q,s,t,u,w){var v=l._cssT||{};v=l._cssT={t:n(p)||n(q)?{tx:p,ty:q}:v.t,s:n(s)||n(t)?{sx:s,sy:t}:v.s,r:n(u)?{a:u}:v.r};s=v.t&&(n(v.t.tx)||n(v.t.ty));q=v.s&&(n(v.s.sx)||n(v.s.sy));p=v.r&&n(v.r.a);if(!wink.has("css-translate3d")||wink.ua.isAndroid&&
(q||p))w=true;if(s){t=v.t.ty;w=w;s="";s=v.t.tx;n(s)||(s=0);t=t;n(t)||(t=0);u="0";var y=false;y=(y=y||wink.isString(s)&&s.indexOf("%",0)!=-1)||wink.isString(t)&&t.indexOf("%",0)!=-1;if(!y){s+="px";t+="px";u+="px"}w=s=w?"translate("+s+", "+t+")":"translate3d("+s+", "+t+", "+u+")"}else w="";w=w;if(q){q=v.s.sy;s="";s=v.s.sx;n(s)||(s=1);q=q;n(q)||(q=1);q=s=wink.has("css-perspective")?"scale3d("+s+", "+q+", 1)":"scale("+s+", "+q+")"}else q="";q=q;if(p){p="";v=v.r.a;n(v)||(v=0);v=p="rotate("+v+"deg)"}else v=
"";v=wink.trim(w+" "+q+" "+v);k(l,v)};wink.addClass=c;wink.removeClass=a;wink.hasClass=b;return wink.fx});define(["../../../_amd/core"],function(){wink.math={round:function(c,a){wink.isSet(a)||(a=0);var b=Math.pow(10,a);return Math.round(c*b)/b},modulo:function(c,a){var b=c%a;return b<0?b+a:b}};return wink.math});
define(["../../../_amd/core"],function(){var c=wink.isSet;wink.ux.Event=function(a){this.uId=wink.getUId();this.multitouch=this.srcEvent=this.target=this.timestamp=this.y=this.x=this.type=null;wink.mixin(this,a);this._validateProperties()};wink.ux.Event.prototype={preventDefault:function(){this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},dispatch:function(a,b){var d=this.srcEvent,g=d.type;if(c(b))g=b;g=g;var j="HTMLEvents";if(/blur|focus|resize|scroll/i.test(g))j=
"UIEvent";else if(/click|mouse(down|move|up)/i.test(g))j="MouseEvent";else if(/touch(start|move|end|cancel)/i.test(g))j="TouchEvent";var e=document.createEvent(j),f=d.changedTouches;if(j=="HTMLEvents")e.initEvent(g,d.bubbles,d.cancelable);else if(j=="UIEvent")e.initUIEvent(g,d.bubbles,d.cancelable,window,d.detail);else if(j=="MouseEvent"){j=d.screenX;var h=d.screenY,k=d.clientX,n=d.clientY;if(d.initTouchEvent&&f&&f.length>0){f=f[0];j=f.screenX;h=f.screenY;k=f.clientX;n=f.clientY}e.initMouseEvent(g,
d.bubbles,d.cancelable,document.defaultView,d.detail,j,h,k,n,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget)}else j=="TouchEvent"&&e.initTouchEvent(g,d.bubbles,d.cancelable,window,d.detail,d.screenX,d.screenY,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.touches,d.targetTouches,f,d.scale,d.rotation);a.dispatchEvent(e)},_validateProperties:function(){return true}};return wink.ux.Event});
define(["../../../_amd/core"],function(){function c(f){var h={};h.x=f.pageX;h.y=f.pageY;h.target=f.target;return h}var a=[],b=wink.has.prop,d={start:b("touchstart"),move:b("touchmove"),end:b("touchend"),gesturestart:b("gesturestart"),gesturechange:b("gesturechange"),gestureend:b("gestureend")},g={};for(var j in d)g[d[j]]=j;wink.ux.touch={};wink.ux.touch.addListener=function(f,h,k,n){if(wink.isUndefined(d[h])){wink.log("[touch] Cannot add listener for unknown eventType: "+h);return false}wink.isSet(n)||
(n={});if(n===true)n={preventDefault:true};n={preventDefault:n.preventDefault===true?true:false,tracking:n.tracking===false?false:true,captureFlow:n.captureFlow===true?true:false};var r=null,o=e(f);if(o==null){r=new wink.ux.touch.Element({domNode:f,tracking:n.tracking});a.push(r)}else r=a[o];if(!r.isListening(h)){if(r.eventHandler==null)r.eventHandler=function(m){var l=r,p=g[m.type],q={};q.type=p;q.srcEvent=m;q.timestamp=m.timeStamp;q.multitouch=false;if(!q.timestamp)q.timestamp=(new Date).getTime();
if(wink.has("touch"))if(p=="gesturestart"||p=="gesturechange"||p=="gestureend"){q.target=m.target;q.x=0;q.y=0}else{var s=null;if(p=="end"){if(m.changedTouches&&m.changedTouches.length>0)s=m.changedTouches[0]}else if(m.targetTouches&&m.targetTouches.length>0)s=m.targetTouches[0];else if(m.changedTouches&&m.changedTouches.length>0)s=m.changedTouches[0];if(s!=null){s=c(s);q.x=s.x;q.y=s.y;q.target=s.target;if(m.touches&&m.touches.length>1)q.multitouch=true}}else{s=c(m);q.x=s.x;q.y=s.y;q.target=s.target}m=
new wink.ux.Event(q);if(!l.isListening("start")||l.tracking==false)l.tracked=true;else if(p=="start")l.tracked=true;if(l.tracked==true){if(p=="end")l.tracked=false;l.notifyEvent(m)}};r.eventCaptures[h]=n.captureFlow;r.domNode.addEventListener(d[h],r.eventHandler,r.eventCaptures[h])}r.addEventCallback(h,k,n.preventDefault)};wink.ux.touch.removeListener=function(f,h,k){f=e(f);if(f!=null){f=a[f];f.removeEventCallback(h,k);f.isListening(h)||f.domNode.removeEventListener(d[h],f.eventHandler,f.eventCaptures[h])}};
wink.ux.touch.getTouchProperties=c;var e=function(f){var h,k=a.length;for(h=0;h<k;h++)if(a[h].domNode==f)return h;return null};wink.ux.touch.Element=function(f){this.uId=wink.getUId();this.domNode=null;this.tracked=this.tracking=false;this.eventHandler=null;this.eventCaptures={};this._els={};wink.mixin(this,f);this._validateProperties()};wink.ux.touch.Element.prototype={addEventCallback:function(f,h,k){if(!wink.isCallback(h))return false;var n=this._els[f];if(n){f=n.callbacks;k=wink.isFunction(h);
var r,o=f.length;for(r=0;r<o;r++){var m=f[r];if(k&&h==m||!k&&h.context==m.context&&h.method==m.method)return false}}else{n={preventDefault:k,callbacks:[]};this._els[f]=n}n.callbacks.push(h);return true},removeEventCallback:function(f,h){if(!wink.isCallback(h))return false;var k=this._els[f];if(!k)return false;var n=k.callbacks,r=wink.isFunction(h),o,m=n.length;for(o=0;o<m;o++){var l=n[o];if(r&&h==l||!r&&h.context==l.context&&h.method==l.method){k.callbacks.splice(o,1);break}}return true},isListening:function(f){if((f=
this._els[f])&&f.callbacks.length>0)return true;return false},notifyEvent:function(f){var h=this._els[f.type];if(h){h.preventDefault==true&&f.preventDefault();h=h.callbacks;for(var k=0;k<h.length;k++)wink.call(h[k],f)}},_validateProperties:function(){return true}};return wink.ux.touch});
define(["../../../_amd/core"],function(){var c=wink.isSet,a=wink.isArray;wink.net.Xhr=function(b){this.uId=wink.getUId();this.request={xhrObject:null,params:b};this._create()};wink.net.Xhr.prototype={sendData:function(b,d,g,j,e,f){var h=this.request,k=h.xhrObject,n=encodeURIComponent;g=g.toUpperCase();if(!(c(d)&&!a(d))){if(k){var r=null;if(c(d)){var o,m=d.length;for(o=0;o<m;o++){var l=d[o],p=l.name;l=l.value;if(g=="GET")b+=o==0&&b.indexOf("?")==-1?"?"+n(p)+"="+n(l):"&"+n(p)+"="+n(l);else if(o==0)r=
n(p)+"="+n(l);else r+="&"+n(p)+"="+n(l)}}try{k.open(g,b,true);k.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");if(c(f))if(a(f)){m=f.length;for(o=0;o<m;o++){var q=f[o];k.setRequestHeader(q.name,q.value)}}k.send(r)}catch(s){return false}k.onreadystatechange=function(){if(k.readyState==4){var t=k.status;if(t>=200&&t<400||t==0)c(j)&&wink.call(j,h);else c(e)&&wink.call(e,h)}}}else return false;return true}},_create:function(){var b=window.XMLHttpRequest;if(b){var d;
try{d=new b}catch(g){d=false}this.request.xhrObject=d}}};wink.Xhr=wink.net.Xhr;return wink.Xhr});
define(["../../../../_amd/core"],function(){var c=wink.fx.apply,a=null,b=null,d=false;wink.ui.xy.layer={visible:false,color:"#000",opacity:0.3,zIndex:998,show:function(){d||this._initDom();a.onclick=function(){var g=wink.ui.xy.layer.onclick;wink.isSet(g)&&g()};if(!this.visible){c(b,{height:document.body.scrollHeight+"px"});c(a,{display:"block"});this.visible=true}},hide:function(){if(d&&this.visible){c(a,{display:"none"});this.visible=false}},refresh:function(){d&&this.visible&&c(b,{height:document.body.scrollHeight+
"px"})},update:function(){d||this._initDom();c(a,{"z-index":this.zIndex});c(b,{backgroundColor:this.color,opacity:this.opacity})},_initDom:function(){var g=document;a=g.createElement("div");c(a,{position:"absolute",display:"none",top:0,width:"100%","z-index":this.zIndex,"tap-highlight-color":"rgba(0, 0, 0, 0)"});b=g.createElement("div");c(b,{width:"100%",backgroundColor:this.color,opacity:this.opacity});a.appendChild(b);g.body.appendChild(a);d=true}};wink.layer=wink.ui.xy.layer;return wink.layer});
define(["../../../_amd/core"],function(){var c=wink.has,a=c.inquireMap,b=navigator,d=window;a({"native-geolocation":function(){return"geolocation"in b},"native-device-orientation":function(){return"ondeviceorientation"in d},"native-device-motion":function(){return"ondevicemotion"in d},"native-localstorage":function(){return"localStorage"in d},"native-sessionstorage":function(){return"sessionStorage"in d},"native-websockets":function(){return"WebSocket"in d},"native-worker":function(){return"Worker"in
d},"native-getusermedia":function(){return"getUserMedia"in b}});return c});define(["../../../_amd/core"],function(){var c=wink.has,a=c.inquireMap,b=window;a({canvas:function(){return!!b.CanvasRenderingContext2D},"canvas-webgl":function(){var d=false;try{var g=document.createElement("canvas");d=g.getContext("webgl")||g.getContext("experimental-webgl")}catch(j){}return!!d}});return c});
define(["../../../_amd/core","../../../math/_matrix/js/matrix"],function(c){var a=[];c.fx.set3dTransform=function(g,j,e){if(!b(j))return false;var f;if(e===true)f=c.fx.getTransform(g);e=c.math.createTransformMatrix(f);j=d(j);e.multiply(j);c.fx.setTransform(g,e.toString())};c.fx.initComposedTransform=function(g,j){var e;if(j===true)e=c.fx.getTransform(g);e=c.math.createTransformMatrix(e);c.fx.removeComposedTransform(g);a.push({node:g,transforms:[e]})};c.fx.setTransformPart=function(g,j,e){if(!b(e))return false;
if(j<1||j>10)return false;var f,h=a.length;for(f=0;f<h;f++){var k=a[f];if(k.node==g){g=null;if(c.isSet(e))g=d(e);k.transforms[j]=g;break}}};c.fx.applyComposedTransform=function(g,j){var e,f=a.length;for(e=0;e<f;e++){var h=a[e];if(h.node==g){e=h.transforms;f=e[0].clone();var k,n=e.length;for(k=1;k<n;k++){var r=e[k];c.isSet(r)&&f.multiply(r)}if(j===true)h.transforms=[f];c.fx.setTransform(g,f.toString());break}}};c.fx.storeComposedTransform=function(g){c.fx.applyComposedTransform(g,true)};c.fx.removeComposedTransform=
function(g){var j,e=a.length;for(j=0;j<e;j++)if(a[j].node==g){a.splice(j,1);break}};var b=function(g){var j=true,e=c.isSet;if(e(g)){var f=["translate","scale","rotate"];if((j=(j=(j=(j=(j=j&&e(g.type))&&f.indexOf(g.type)!=-1)&&e(g.x))&&e(g.y))&&e(g.z))&&g.type=="rotate")j=j&&e(g.angle)}return j},d=function(g){var j=c.math.createTransformMatrix();switch(g.type){case "translate":j.translate(g.x,g.y,g.z);break;case "scale":j.scale(g.x,g.y,g.z);break;case "rotate":j.rotateAxisAngle(g.x,g.y,g.z,g.angle);
break}return j};return c.fx});
define(["../../../_amd/core"],function(c){if(typeof c.fx.animation=="undefined")c.fx.animation={};c.fx.animate=function(e,f,h){return a(e,f,h)};c.fx.fadeIn=function(e,f){return b(e,1,f)};c.fx.fadeOut=function(e,f){return b(e,0,f)};c.fx.collapse=function(e,f){var h=f||{},k=j(e,h.rows,h.cols);if(k!=null){e.parentNode.appendChild(k.copy.container.node);c.fx.apply(e,{opacity:0});var n=h.duration||2E3;d(k,{x:h.x-k.source.x,y:h.y-k.source.y});var r=c.math.round(n/3,0);n=(n-r)/k.copy.orderMax;for(var o=
new c.fx.animation.AnimationGroup,m={translate:function(w,v,y){c.fx.translate(w.node,v,y)}},l=0;l<k.rows;l++)for(var p=0;p<k.cols;p++){var q=k.copy.subparts[l][p],s=Math.max(k.rows,k.cols)-Math.ceil(q.order),t=new c.fx.animation.Animation;t.addStep({property:"transform",value:{context:m,method:"translate",arguments:[h.dx,h.dy]},duration:r,delay:c.math.round(q.order*n,0),func:"cubic-bezier(1.0, 0.0, 1.0, 1.0)"});c.fx.apply(q.node,{zIndex:s});o.addAnimation(q.node,t)}var u=c.isCallback(h.onEnd)?h.onEnd:
null;o.start({onEnd:function(){e.parentNode.removeChild(k.copy.container.node);c.isSet(u)&&c.call(u,{})}})}};c.fx.split=function(e,f,h){return j(e,f,h)};var a=function(e,f,h){var k=h||{};h=k.start!==false;k=k.onEnd?k.onEnd:null;f=c.isArray(f)?f:[f];for(var n=0;n<f.length;n++){var r=f[n];if(!c.isSet(r.property)||!c.isSet(r.value))return null;if(!c.isSet(r.duration))r.duration=1E3;if(!c.isSet(r.delay))r.delay=0;if(!c.isSet(r.func))r.func="linear"}e=new c.fx.animation.Animation({node:e,onEnd:k});e.addStep(f);
h&&e.start();return e},b=function(e,f,h){h=h||{};return a(e,{property:"opacity",value:f,duration:h.duration,delay:h.delay,func:h.func},h)},d=function(e,f){for(var h=Math.abs(e.cols*e.copy.subW),k=Math.abs(e.rows*e.copy.subH),n=Math.sqrt(h*h+k*k),r=Math.max(e.rows,e.cols),o=Number.MAX_VALUE,m={i:0,j:0},l=0,p=0;p<e.rows;p++)for(var q=0;q<e.cols;q++){var s=e.copy.subparts[p][q];k={x:s.x+s.w/2,y:s.y+s.h/2};h=Math.abs(k.x-f.x);k=Math.abs(k.y-f.y);h=Math.sqrt(h*h+k*k);s.distance=h;if(h<o){o=h;m={i:p,j:q}}h=
s.distance*r/n;s.order=Math.max(h,1);if(l<h)l=h}e.copy.subparts[m.i][m.j].order=0;e.copy.orderMax=l},g=function(e){var f=function(h,k,n){h=(h.ownerDocument.defaultView||window).getComputedStyle(h,null).getPropertyValue(k);return n?parseFloat(h):h};return{x:c.getLeftPosition(e),y:c.getTopPosition(e),h:f(e,"height",true),w:f(e,"width",true),bh:f(e,"border-top-width",true)+f(e,"border-bottom-width",true),bw:f(e,"border-left-width",true)+f(e,"border-right-width",true),zIndex:f(e,"z-index")}},j=function(e,
f,h){if(!c.isSet(e)||!c.isSet(f)||!c.isSet(h))return null;f={rows:f,cols:h,source:g(e),copy:{subH:null,subW:null,container:{node:null,style:null},subparts:[]}};var k=(f.source.h+f.source.bh)/f.rows,n=(f.source.w+f.source.bw)/f.cols;f.copy.subH=k;f.copy.subW=n;h=c.math.round(k,0);var r=c.math.round(n,0);n=n-r;k=c.math.round((k-h)*f.rows,0);n=c.math.round(n*f.cols,0);f.copy.container.node=document.createElement(e.tagName);c.fx.apply(f.copy.container.node,{position:"absolute",padding:0,margin:0,border:"none",
top:f.source.y+"px",left:f.source.x+"px",height:f.source.h+f.source.bh+"px",width:f.source.w+f.source.bw+"px",background:"none",overflow:"hidden",zIndex:f.source.zIndex});for(var o=0;o<f.rows;o++){f.copy[o]||(f.copy.subparts[o]=[]);for(var m=0;m<f.cols;m++){var l={i:o,j:m},p=m==f.cols-1,q=o==f.rows-1;l.x=m*r;l.y=o*h;l.h=h;l.w=r;if(p)l.w=Math.max(l.w+n,0);if(q)l.h=Math.max(l.h+k,0);l.node=document.createElement(e.tagName);c.fx.apply(l.node,{position:"absolute",padding:0,margin:0,border:"none",left:l.x+
"px",top:l.y+"px",height:l.h+"px",width:l.w+"px",overflow:"hidden"});l.inner=e.cloneNode(true);l.inner.removeAttribute("id");c.fx.apply(l.inner,{position:"static",marginTop:-l.y+"px",marginLeft:-l.x+"px"});l.node.appendChild(l.inner);f.copy.subparts[o].push(l);f.copy.container.node.appendChild(l.node)}}return f};c.fx.animation.Animation=function(e){this.uId=c.getUId();e=e||{};this._steps=[];this._node=e.node;this._onEnd=e.onEnd};c.fx.animation.Animation.prototype={addStep:function(e){e=c.isArray(e)?
e:[e];for(var f=[],h=[],k=[],n=[],r={},o=0;o<e.length;o++){var m=e[o],l=m.property,p=m.value,q=m.duration,s=Math.max(c.isSet(m.delay)?m.delay:1,1);m=c.isSet(m.func)?m.func:"default";l=c.has.prop(l);f.push(l);h.push(q+"ms");k.push(s+"ms");n.push(m);r[l]=p}this._steps.push({propValues:r,transition:{property:f.join(","),duration:h.join(","),delay:k.join(","),func:n.join(",")}})},start:function(e,f){var h=f||{},k=e||this._node;h.onEnd=h.onEnd||this._onEnd;if(c.isSet(k))this._nextStep({uId:c.getUId(),
node:k,currentStep:-1,iterations:h.iterations?h.iterations:1,currentIt:0,onEnd:c.isCallback(h.onEnd)?h.onEnd:null})},getSteps:function(){return this._steps},chain:function(e){if(!(!e instanceof c.fx.animation.Animation)){e=e.getSteps();for(var f=0;f<e.length;f++)this._steps.push(e[f]);return this}},_end:function(e){e.currentIt++;if(e.currentIt<e.iterations){e.currentStep=-1;this._nextStep(e)}else c.isSet(e.onEnd)&&c.call(e.onEnd,{})},_nextStep:function(e){e.currentStep++;if(e.currentStep>=this._steps.length)this._end(e);
else{var f=e.node,h=this._steps[e.currentStep];e.transitionStates={};for(var k in h.propValues)e.transitionStates[k]=false;k=c.bind(this._transitionEnd,this,e);e.trEndHandler=c.fx.onTransitionEnd(f,k,true);e.timer=c.setTimeout(this,"_startStep",0,f,h,e)}},_startStep:function(e,f,h){clearTimeout(h.timer);h=f.transition;c.fx.applyTransition(e,h.property,h.duration,h.delay,h.func);this._setStyle(e,f.propValues)},_transitionEnd:function(e,f){var h=e.transitionStates[f.propertyName]=true;for(var k in e.transitionStates)if(e.transitionStates[k]==
false){h=false;break}if(h){e.node.removeEventListener(c.has.prop("transitionend"),e.trEndHandler,false);this._nextStep(e)}},_setStyle:function(e,f){var h=0,k={};for(var n in f){var r=f[n];if(c.isCallback(r))c.call(r,{node:e});else{k[n]=r;h++}}h>0&&c.fx.apply(e,k)}};c.fx.animation.AnimationGroup=function(){this.uId=c.getUId();this._animations=[];this._onEndCallback=this._countDone=null};c.fx.animation.AnimationGroup.prototype={addAnimation:function(e,f){!f instanceof c.fx.animation.Animation||this._animations.push({node:e,
anim:f})},start:function(e){e=e||{};this._countDone=0;var f=c.isCallback(e.onEnd);this._onEndCallback=f?e.onEnd:null;e={onEnd:f?{context:this,method:"_onAnimEnd"}:null};for(f=0;f<this._animations.length;f++){var h=this._animations[f];h.anim.start(h.node,e)}},clear:function(){this._animations=[]},_onAnimEnd:function(){this._countDone++;this._countDone==this._animations.length&&c.call(this._onEndCallback,{})}};return c.fx});
define(["../../../_amd/core"],function(c){c.math.radToDeg=function(a){return a*180/Math.PI};c.math.degToRad=function(a){return a*Math.PI/180};c.math.getAngle=function(a,b){var d=Math.abs(b);if(d>a*2)d=a*2;var g=2*a*a;d=Math.acos(-((Math.pow(d,2)-(Math.pow(a,2)+Math.pow(a,2)))/g));if(isNaN(d))d=0;return d};c.math.getAngleBetweenVectors=function(a,b){var d=c.math.getScalarVector(a,b),g=c.math.getNormVector(a)*c.math.getNormVector(b);d=Math.acos(d/g);if(isNaN(d))d=0;return d};c.math.normalizeVector=
function(a){var b=[0,0,0,1],d=c.math.getNormVector(a);if(d<=0)return b;b[0]=a[0]/d;b[1]=a[1]/d;b[2]=a[2]/d;return b};c.math.getNormVector=function(a){a=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];return a=Math.sqrt(a)};c.math.getNormalVector=function(a,b){var d=[0,0,0,1];d[0]=a[1]*b[2]-a[2]*b[1];d[1]=a[2]*b[0]-a[0]*b[2];d[2]=a[0]*b[1]-a[1]*b[0];return d};c.math.getScalarVector=function(a,b){var d=0;return d=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};c.math.getVector=function(a,b){var d=[0,0,0,1];d[0]=b[0]-a[0];d[1]=b[1]-a[1];
d[2]=b[2]-a[2];return d};c.math.multiplyMatrixVector=function(a,b){var d=[0,0,0,1];b[3]||(b[3]=1);d[0]=b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]*a[3];d[1]=b[0]*a[4]+b[1]*a[5]+b[2]*a[6]+b[3]*a[7];d[2]=b[0]*a[8]+b[1]*a[9]+b[2]*a[10]+b[3]*a[11];d[3]=b[0]*a[12]+b[1]*a[13]+b[2]*a[14]+b[3]*a[15];return d};return c.math});
define(["../../../_amd/core"],function(c){c.math.createTransformMatrix=function(a){var b=new c.math.Matrix({});c.isSet(a)&&b.loadCssTransform(a);return b};c.math.Matrix=function(a){this.uId=c.getUId();this._properties=a;this._values=[];this._cssMatrix=null;this._matrixConversionBug=c.ua.isBlackBerry&&c.ua.browserVersion==7&&c.ua.browserMinorVersion==1;this._validateProperties()!==false&&this._initProperties()};c.math.Matrix.prototype={scale:function(a,b,d){this._load(this._cssMatrixToValues(this._cssMatrix.scale(a,
b,d)))},translate:function(a,b,d){this._load(this._cssMatrixToValues(this._cssMatrix.translate(a,b,d)))},rotateAxisAngle:function(a,b,d,g){this._load(this._cssMatrixToValues(this._cssMatrix.rotateAxisAngle(a,b,d,g)))},multiply:function(a){a=a.getCssMatrix();var b=this._cssMatrix;if(c.has("css-matrix-stack-inversed")){var d=a;a=b;b=d}this._load(this._cssMatrixToValues(a.multiply(b)))},clone:function(){return new c.math.Matrix({values:this._values})},loadCssTransform:function(a){if(isString(a)){if(a.indexOf("matrix3d")!=
-1){a=a.substring(9,a.length-1).split(", ");for(var b=[],d=0;d<a.length;d++)b[d]=a[d]*1;this._load(b)}}else try{this._load(this._cssMatrixToValues(a))}catch(g){}},getValues:function(){return this._values},getCssMatrix:function(){return this._cssMatrix},toString:function(){return this._matrixConversionBug?"matrix3d("+this._values.join(",")+")":this._cssMatrix.toString()},_validateProperties:function(){return true},_initProperties:function(){c.isSet(this._properties.values)?this._load(this._properties.values):
this._loadIdentity()},_loadIdentity:function(){this._load([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},_load:function(a){if(!c.isSet(a)||a.length!=16)return false;this._values=a;this._cssMatrix=this._valuesToCssMatrix(this._values)},_valuesToCssMatrix:function(a){var b=new WebKitCSSMatrix;b.m11=a[0];b.m12=a[1];b.m13=a[2];b.m14=a[3];b.m21=a[4];b.m22=a[5];b.m23=a[6];b.m24=a[7];b.m31=a[8];b.m32=a[9];b.m33=a[10];b.m34=a[11];b.m41=a[12];b.m42=a[13];b.m43=a[14];b.m44=a[15];return b},_cssMatrixToValues:function(a){var b=
[];b[0]=a.m11;b[1]=a.m12;b[2]=a.m13;b[3]=a.m14;b[4]=a.m21;b[5]=a.m22;b[6]=a.m23;b[7]=a.m24;b[8]=a.m31;b[9]=a.m32;b[10]=a.m33;b[11]=a.m34;b[12]=a.m41;b[13]=a.m42;b[14]=a.m43;b[15]=a.m44;return b}};return c.math});
define(["../../../_amd/core"],function(c){c.ux.gesture={_gestureElements:[],_knownGestures:["two_digits_click","two_digits_press","enlargement","narrowing","rotation","instant_scale","instant_rotation","gesture_end"],TWO_DIGITS_CLICK_MAX_DURATION:350,TWO_DIGITS_PRESS_MIN_DURATION:400,SCALE_MIN_VALUE:0.2,ROTATION_MIN_VALUE:5,listenTo:function(a,b,d,g){if(!this._isGestureKnown(b)){c.log("[gesture] Cannot listen to this unknown gesture: "+b);return false}if(!c.isCallback(d)){c.log("[gesture] Invalid callback: "+
d);return false}var j={preventDefault:false};if(c.isSet(g))j.preventDefault=g===true?true:g.preventDefault===true;g=null;g=this._getGestureElementIndex(a);if(g==null){g=this._createGestureElement(a,j.preventDefault);this._gestureElements.push(g);c.ux.touch.addListener(g.domNode,"start",{context:this,method:"_handleStart",arguments:[g]},{preventDefault:g.preventDefault,tracking:false});c.ux.touch.addListener(g.domNode,"gesturestart",{context:this,method:"_handleGestureStart",arguments:[g]},{preventDefault:g.preventDefault})}else g=
this._gestureElements[g];g.addCallback(b,d)},unlistenTo:function(a,b,d){if(!this._isGestureKnown(b)){c.log("[gesture] Cannot listen to this unknown gesture: "+b);return false}if(!c.isCallback(d)){c.log("[gesture] Invalid callback: "+d);return false}var g=null;a=this._getGestureElementIndex(a);if(a!=null){g=this._gestureElements[a];g.removeCallback(b,d)}},_createGestureElement:function(a,b){return{uId:c.getUId(),domNode:a,preventDefault:b,digits:[],multitouch:false,multitouchStartTime:null,multitouchEndTime:null,
scale:1,rotation:0,gestureHandlers:[],getGestureHandler:function(d){for(var g=0;g<this.gestureHandlers.length;g++)if(this.gestureHandlers[g].gesture==d)return this.gestureHandlers[g];return null},isListening:function(d){return this.getGestureHandler(d)!=null},addCallback:function(d,g){this.isListening(d)?this.getGestureHandler(d).callbacks.push(g):this.gestureHandlers.push({gesture:d,callbacks:[g]})},removeCallback:function(d,g){if(this.isListening(d))for(var j=c.isFunction(g),e=0;e<this.getGestureHandler(d).callbacks.length;e++){var f=
this.getGestureHandler(d).callbacks[e];if(j&&f==g||!j&&f.context==g.context&&f.method==g.method){if(this.getGestureHandler(d).callbacks.length==1)for(j=0;j<this.gestureHandlers.length;j++){if(this.gestureHandlers[j].gesture==d){this.gestureHandlers.splice(j,1);break}}else this.getGestureHandler(d).callbacks.splice(e,1);break}}},reset:function(){this.digits=[];this.multitouch=false;this.multitouchEndTime=this.multitouchStartTime=null;this.scale=1;this.rotation=0}}},_isGestureKnown:function(a){return this._knownGestures.indexOf(a)!=
-1},_getGestureElementIndex:function(a){for(var b=0;b<this._gestureElements.length;b++)if(this._gestureElements[b].domNode==a)return b;return null},_notifyGesture:function(a,b,d){if(b.isListening(a)){a=b.getGestureHandler(a).callbacks;for(b=0;b<a.length;b++)c.call(a[b],d)}},_handleStart:function(a,b){b.reset();b.checkTimer&&clearTimeout(b.checkTimer);var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){b.multitouch=true;b.multitouchStartTime=this._getTimeStamp();
b.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));b.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a));c.ux.touch.addListener(b.domNode,"move",{context:this,method:"_handleMove",arguments:[b]},{preventDefault:b.preventDefault});c.ux.touch.addListener(b.domNode,"end",{context:this,method:"_handleEnd",arguments:[b]});b.checkTimer=c.setTimeout(this,"_checkTwoDigitsPressed",this.TWO_DIGITS_PRESS_MIN_DURATION,b)}else{b.multitouch=false;c.ux.touch.removeListener(b.domNode,"move",{context:this,
method:"_handleMove",arguments:[b]});c.ux.touch.removeListener(b.domNode,"end",{context:this,method:"_handleEnd",arguments:[b]})}},_handleMove:function(a,b){var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;if(d==2){b.digits=[];b.digits.push(this._getDigit(a.srcEvent.targetTouches[0],a));b.digits.push(this._getDigit(a.srcEvent.targetTouches[1],a))}},_handleEnd:function(a,b){if(b.multitouch==true){var d=0;if(c.isSet(a.srcEvent.targetTouches))d=a.srcEvent.targetTouches.length;
if(d!=2)b.multitouch=false;if(d==0){c.ux.touch.removeListener(b.domNode,"move",{context:this,method:"_handleMove"});c.ux.touch.removeListener(b.domNode,"end",{context:this,method:"_handleEnd"});b.multitouchEndTime=this._getTimeStamp();b.multitouchEndTime-b.multitouchStartTime<this.TWO_DIGITS_CLICK_MAX_DURATION&&this._notifyGesture("two_digits_click",b,{digit1:b.digits[0],digit2:b.digits[1]})}}},_checkTwoDigitsPressed:function(a){a.multitouch==true&&this._notifyGesture("two_digits_press",a,{digit1:a.digits[0],
digit2:a.digits[1]})},_handleGestureStart:function(a,b){c.ux.touch.addListener(b.domNode,"gesturechange",{context:this,method:"_handleGestureChange",arguments:[b]},{preventDefault:b.preventDefault});c.ux.touch.addListener(b.domNode,"gestureend",{context:this,method:"_handleGestureEnd",arguments:[b]});b.gestureStartTime=this._getTimeStamp()},_handleGestureChange:function(a,b){if(b.multitouch==true){var d=a.srcEvent.scale-b.scale,g=a.srcEvent.rotation-b.rotation,j={digit1:b.digits[0],digit2:b.digits[1],
scale:c.math.round(a.srcEvent.scale,2)},e={digit1:b.digits[0],digit2:b.digits[1],rotation:c.math.round(a.srcEvent.rotation,2)};if(Math.abs(d)>this.SCALE_MIN_VALUE){b.scale=a.srcEvent.scale;var f=null;f=d>0?"enlargement":"narrowing";this._notifyGesture(f,b,j)}if(Math.abs(g)>this.ROTATION_MIN_VALUE){b.rotation=a.srcEvent.rotation;this._notifyGesture("rotation",b,e)}this._notifyGesture("instant_scale",b,j);this._notifyGesture("instant_rotation",b,e)}},_handleGestureEnd:function(a,b){c.ux.touch.removeListener(b.domNode,
"gesturechange",{context:this,method:"_handleGestureChange"});c.ux.touch.removeListener(b.domNode,"gestureend",{context:this,method:"_handleGestureEnd"});b.gestureEndTime=this._getTimeStamp();this._notifyGesture("gesture_end",b,{gestureDuration:b.gestureEndTime-b.gestureStartTime})},_getDigit:function(a,b){var d=c.ux.touch.getTouchProperties(a);return{x:d.x,y:d.y,timestamp:b.timestamp,target:d.target}},_getTimeStamp:function(){return(new Date).getTime()}};return c.ux.gesture});
define(["../../../_amd/core"],function(c){c.ux.GestureRecognizer=function(a){this.uId=c.getUId();this._properties=a;this._gestureEndCallback=this._gestureCallback=this._gestureStartCallback=null;this._points=[];this._templates=[];this._isDown=false;this.numTemplates=8;this.numPoint=64;this.squareSize=250;this.origin={x:0,y:0};this.diagonal=Math.sqrt(this.squareSize*this.squareSize+this.squareSize*this.squareSize);this.halfDiagonal=0.5*this.diagonal;this.angleRange=this.utils.deg2Rad(45);this.anglePrecision=
this.utils.deg2Rad(2);this.phi=0.5*(-1+Math.sqrt(5));this._domNode=null;if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};c.ux.GestureRecognizer.prototype={utils:{resample:function(a,b){for(var d=this.pathLength(a)/(b-1),g=0,j=Array(a[0]),e=1;e<a.length;e++){var f=this.distance(a[e-1],a[e]);if(g+f>=d){g={x:a[e-1].x+(d-g)/f*(a[e].x-a[e-1].x),y:a[e-1].y+(d-g)/f*(a[e].y-a[e-1].y)};j[j.length]=g;a.splice(e,0,g);g=0}else g+=f}if(j.length==b-1)j[j.length]={x:a[a.length-
1].x,y:a[a.length-1].y};return j},indicativeAngle:function(a){var b=this.centroid(a);return Math.atan2(b.y-a[0].y,b.x-a[0].x)},rotateBy:function(a,b){for(var d=this.centroid(a),g=Math.cos(b),j=Math.sin(b),e=[],f=0;f<a.length;f++)e[e.length]={x:(a[f].x-d.x)*g-(a[f].y-d.y)*j+d.x,y:(a[f].x-d.x)*j+(a[f].y-d.y)*g+d.y};return e},scaleTo:function(a,b){for(var d=this.boundingBox(a),g=[],j=0;j<a.length;j++)g[g.length]={x:a[j].x*(b/d.width),y:a[j].y*(b/d.height)};return g},translateTo:function(a,b){for(var d=
this.centroid(a),g=[],j=0;j<a.length;j++)g[g.length]={x:a[j].x+b.x-d.x,y:a[j].y+b.y-d.y};return g},distanceAtBestAngle:function(a,b,d,g,j,e){for(var f=e*d+(1-e)*g,h=this.distanceAtAngle(a,b,f),k=(1-e)*d+e*g,n=this.distanceAtAngle(a,b,k);Math.abs(g-d)>j;)if(h<n){g=k;k=f;n=h;f=e*d+(1-e)*g;h=this.distanceAtAngle(a,b,f)}else{d=f;f=k;h=n;k=(1-e)*d+e*g;n=this.distanceAtAngle(a,b,k)}return Math.min(h,n)},distanceAtAngle:function(a,b,d){return this.pathDistance(this.rotateBy(a,d),b.points)},centroid:function(a){for(var b=
0,d=0,g=0;g<a.length;g++){b+=a[g].x;d+=a[g].y}b/=a.length;d/=a.length;return{x:b,y:d}},boundingBox:function(a){for(var b=+Infinity,d=-Infinity,g=+Infinity,j=-Infinity,e=0;e<a.length;e++){if(a[e].x<b)b=a[e].x;if(a[e].x>d)d=a[e].x;if(a[e].y<g)g=a[e].y;if(a[e].y>j)j=a[e].y}return{x:b,y:g,width:d-b,height:j-g}},pathDistance:function(a,b){for(var d=0,g=0;g<a.length;g++)d+=this.distance(a[g],b[g]);return d/a.length},pathLength:function(a){for(var b=0,d=1;d<a.length;d++)b+=this.distance(a[d-1],a[d]);return b},
distance:function(a,b){var d=b.x-a.x,g=b.y-a.y;return Math.sqrt(d*d+g*g)},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI}},getDomNode:function(){return this._domNode},_touchStart:function(a){var b=a.x,d=a.y;this._points.length=1;this._points[0]={x:b,y:d};this._isDown=true;this._gestureStartCallback!=null&&c.call(this._gestureStartCallback,a)},_touchMove:function(a){var b=a.x,d=a.y;if(this._isDown)this._points[this._points.length]={x:b,y:d};this._gestureCallback!=
null&&c.call(this._gestureCallback,a)},_touchEnd:function(a){if(this._isDown){if(this._points.length>=10){var b=this._recognize(this._points);c.publish("/gesturerecognizer/events/result",b)}else c.publish("/gesturerecognizer/events/result",{result:null,score:0});this._isDown=false;this._gestureEndCallback!=null&&c.call(this._gestureEndCallback,a)}},_addTemplate:function(a,b){this._templates.push(new this.Template(a,this.numPoint,this.squareSize,this.origin,b))},_recognize:function(a){a=this.utils.resample(a,
this.numPoint);var b=this.utils.indicativeAngle(a);a=this.utils.rotateBy(a,-b);a=this.utils.scaleTo(a,this.squareSize);a=this.utils.translateTo(a,this.origin);b=+Infinity;for(var d=0,g=0;g<this._templates.length;g++){var j=this.utils.distanceAtBestAngle(a,this._templates[g],-this.angleRange,+this.angleRange,this.anglePrecision,this.phi);if(j<b){b=j;d=g}}return{result:this._templates[d].name,score:1-b/this.halfDiagonal}},_initListeners:function(){c.ux.touch.addListener(this._domNode,"start",{context:this,
method:"_touchStart",arguments:null},{preventDefault:true});c.ux.touch.addListener(this._domNode,"move",{context:this,method:"_touchMove",arguments:null},{preventDefault:true});c.ux.touch.addListener(this._domNode,"end",{context:this,method:"_touchEnd",arguments:null},{preventDefault:true})},_initProperties:function(){for(var a=this._properties.templates.length,b=0;b<a;b++)this._addTemplate(this._properties.templates[b].name,this._properties.templates[b].points);this.numTemplates=a;this._domNode=
this._properties.node;if(this._properties&&this._properties.gestureStartCallback)this._gestureStartCallback=this._properties.gestureStartCallback;if(this._properties&&this._properties.gestureCallback)this._gestureCallback=this._properties.gestureCallback;if(this._properties&&this._properties.gestureEndCallback)this._gestureEndCallback=this._properties.gestureEndCallback},_validateProperties:function(){return true},Template:function(a,b,d,g,j){this.name=a;this.points=c.ux.GestureRecognizer.prototype.utils.resample(j,
b);a=c.ux.GestureRecognizer.prototype.utils.indicativeAngle(this.points);this.points=c.ux.GestureRecognizer.prototype.utils.rotateBy(this.points,-a);this.points=c.ux.GestureRecognizer.prototype.utils.scaleTo(this.points,d);this.points=c.ux.GestureRecognizer.prototype.utils.translateTo(this.points,g)}};return c.ux.GestureRecognizer});
define(["../../../_amd/core"],function(c){c.ux.MovementTracker=function(a){this.uId=c.getUId();this._properties=a;this._previousPoint=this._startPoint=this._pointStatement=this._target=null;this._tracking=false;this._acceptEvents=true;this._multitouch=false;this._params={captureFlow:true,preventStart:true,preventMove:false,shiftThreshold:0,trackThresholdX:0,trackThresholdY:0};if(this._validateProperties()!==false){this._initProperties();this._initListeners()}};c.ux.MovementTracker.prototype={updateTrackThresholdX:function(a){if(this._isValidThreshold(a))this._params.trackThresholdX=
a;else this._raisePropertyError("trackThresholdX")},updateTrackThresholdY:function(a){if(this._isValidThreshold(a))this._params.trackThresholdY=a;else this._raisePropertyError("trackThresholdY")},destroy:function(){this._removeListeners()},_validateProperties:function(){return true},_isValidThreshold:function(a){return c.isInteger(a)&&a>=0},_raisePropertyError:function(a){c.log("[MovementTracker] Error: "+a+" missing or invalid")},_initProperties:function(){this._target=c.byId(this._properties.target);
if(this._properties.captureFlow===false)this._params.captureFlow=false;if(this._properties.preventStart===false)this._params.preventStart=false;if(this._properties.preventMove===true)this._params.preventMove=true;if(c.isSet(this._properties.trackThresholdX))this._params.trackThresholdX=this._properties.trackThresholdX;if(c.isSet(this._properties.trackThresholdY))this._params.trackThresholdY=this._properties.trackThresholdY;delete this._properties},_initListeners:function(){c.ux.touch.addListener(this._target,
"start",{context:this,method:"_handleTouchStart"},{preventDefault:this._params.preventStart,captureFlow:this._params.captureFlow});c.ux.touch.addListener(this._target,"move",{context:this,method:"_handleTouchMove"},{preventDefault:this._params.preventMove,captureFlow:this._params.captureFlow});c.ux.touch.addListener(this._target,"end",{context:this,method:"_handleTouchEnd"},{captureFlow:this._params.captureFlow})},_removeListeners:function(){c.ux.touch.removeListener(this._target,"start",{context:this,
method:"_handleTouchStart"});c.ux.touch.removeListener(this._target,"move",{context:this,method:"_handleTouchMove"});c.ux.touch.removeListener(this._target,"end",{context:this,method:"_handleTouchEnd"})},_handleTouchStart:function(a){if(c.ua.isAndroid)if(!this.defered){this.defered=true;if((new Date).getTime()-a.timestamp>100){this._acceptEvents=false;a.preventDefault();var b,d={exec:c.bind(function(){clearTimeout(b);this._acceptEvents=true;this._handleTouchStart(a)},this)};b=c.setTimeout(d,"exec",
0);return}}if(this._acceptEvents!=false){this._multitouch=false;if(a.multitouch==true)this._multitouch=true;else{this._acceptEvents=false;this._pointStatement=[];this._previousPoint=null;this._tracking=false;this._startPoint={x:a.x,y:a.y};d=this._onNewTouch(a);c.publish(d.name,d.params);this._acceptEvents=true}}},_handleTouchMove:function(a){if(this._acceptEvents!=false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);c.publish(a.name,a.params);this._acceptEvents=true}},_handleTouchEnd:function(a){if(this._acceptEvents!=
false)if(!this._multitouch){this._acceptEvents=false;a=this._onNewTouch(a);c.publish(a.name,a.params);this._acceptEvents=true}},_onNewTouch:function(a){if(this._tracking==false)if(this._params.trackThresholdX==0||this._params.trackThresholdY==0)this._tracking=true;else{var b={x:a.x,y:a.y},d=Math.abs(b.x-this._startPoint.x);b=Math.abs(b.y-this._startPoint.y);if(d>this._params.trackThresholdX||b>this._params.trackThresholdY)this._tracking=true}d={name:"/movementtracker/events/notrack",params:{publisher:this,
uxEvent:a,target:this._target}};if(this._tracking==false)return d;if(this._pointStatement.length==0)d.name="/movementtracker/events/mvtbegin";else if(a.type=="move")d.name="/movementtracker/events/mvtchanged";else if(a.type=="end")d.name="/movementtracker/events/mvtstored";this._addTouch(a);d.params.movement=this._getCurrentMovement();return d},_addTouch:function(a){a={x:a.x,y:a.y,timestamp:a.timestamp};var b=0,d=0,g=0,j=0,e=0,f=0;if(this._previousPoint==null){a.duration=0;a.globalDuration=0;b=a.x;
d=a.y}else{b=this._previousPoint.x;d=this._previousPoint.y;g=this._previousPoint.globalDx;j=this._previousPoint.globalDy;e=this._previousPoint.directionX;f=this._previousPoint.directionY;a.duration=a.timestamp-this._previousPoint.timestamp;a.globalDuration=a.duration+this._previousPoint.globalDuration}a.dx=Math.abs(a.x-b);a.dy=Math.abs(a.y-d);a.globalDx=a.dx+g;a.globalDy=a.dy+j;a.directionX=e;a.directionY=f;if(e==0&&this._previousPoint!=null){if(a.x<b)a.directionX=-1;else if(a.x>b)a.directionX=1;
this._previousPoint.directionX=a.directionX}if(f==0&&this._previousPoint!=null){if(a.y<d)a.directionY=-1;else if(a.y>d)a.directionY=1;this._previousPoint.directionY=a.directionY}if(e>0&&a.x+this._params.shiftThreshold<b)a.directionX=-1;else if(e<0&&a.x-this._params.shiftThreshold>b)a.directionX=1;if(f>0&&a.y+this._params.shiftThreshold<d)a.directionY=-1;else if(f<0&&a.y-this._params.shiftThreshold>d)a.directionY=1;this._pointStatement.push(a);this._previousPoint=a},_getCurrentMovement:function(){var a=
this._pointStatement[this._pointStatement.length-1];return{pointStatement:this._pointStatement,duration:a.globalDuration,dx:a.globalDx,dy:a.globalDy}}};return c.ux.MovementTracker});
define(["../../../_amd/core"],function(c){c.ux.window={height:null,width:null,fullHeight:null,fullWidth:null,screenHeight:screen.height,screenWidth:screen.width,orientation:null,_i:null,_V:"vertical",_H:"horizontal",_init:function(){var a=c.bind(this._updateData,this);"onorientationchange"in window?window.addEventListener("orientationchange",a,true):window.addEventListener("resize",a,true);if(c.ua.isAndroid){scrollTo(0,1,0);this._i=setInterval(a,1E3)}else window.addEventListener("scroll",a,true);
a()},_updateData:function(){var a=window.innerWidth,b=window.innerHeight,d=false;if(this.width+2<a||this.width-2>a||this.height+2<b||this.height-2>b)d=true;this._updateSize();this._updateOrientation();d&&c.publish("/window/events/resize",{height:b,width:a,orientation:this.orientation})},_updateSize:function(){this.height=window.innerHeight;this.width=window.innerWidth;try{this.fullHeight=document.body.scrollHeight;this.fullWidth=document.body.scrollWidth}catch(a){}},_updateOrientation:function(){var a;
a=c.isSet(window.orientation)&&c.ua.isIOS?Math.abs(window.orientation)==90?this._H:this._V:this.width>this.height?this._H:this._V;if(a!=this.orientation){this.orientation=a;c.publish("/window/events/orientationchange",{height:this.height,width:this.width,orientation:a})}}};window.addEventListener("DOMContentLoaded",function(){c.ux.window._init()},false);c.ux.Window=function(){this.getProperties=function(){return{screenWidth:c.ux.window.screenWidth,screenHeight:c.ux.window.screenHeight,width:c.ux.window.width,
height:c.ux.window.height,orientation:c.ux.window.orientation}}};return c.ux.window});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker","../../../../ux/gesture/js/gesture","../../../../ux/window/js/window"],function(c){c.ui.xyz.CoverFlow=function(a){this.uId=c.getUId();this.backgroundColor=this.covers=null;this.fadeEdges=this.displayTitle=this.reflected=false;this.size=0;this.viewportWidth=null;this.handleOrientationChange=this.handleGesture=false;this.coverSpacing=null;this.borderSize=
this.displayTitleDuration=0;this._timerTitle=this._lastRenderedIndex=this._middleViewIndex=this._renderer=this._transformsQueue=this._transformations=this._positions=this._movementtracker=this._faderRight=this._faderLeft=this._gestureNode=this._trayNode=this._domNode=null;this._flipping=this._displayMode=this._dragging=false;this._view={x:0,sizeX:0,shiftX:25,shiftFromMiddle:200,coverRotation:55,coverScale:0.28,zMiddleCover:175,zAroundCover:0,numberOfCoverToRender:5,distanceToCenter:0,distanceFromTop:0,
zGestureNode:1E3,observerRotation:0,currentObserverRotation:0};c.mixin(this,a);if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};c.ui.xyz.CoverFlow.prototype={_Z_INDEX_BACKGROUND:5,_DURATION_BACKTO_BOUND:200,_DURATION_MIDDLE:600,_DURATION_AROUND:300,_DURATION_FLIP:1E3,_TRANSITION_FUNC:"default",_OUTOFBOUND_FRICTIONAL_FORCES:4,_RENDERER_INTERVAL:15,_DELAY_BEFORE_IMAGE_LOADING:50,_PERSPECTIVE:500,_REFLECTION_ATTENUATION:0.6,_DELAY_FOR_TITLE_DISPLAY:400,
getDomNode:function(){return this._domNode},updateSize:function(a,b){this.size=a;this.viewportWidth=b;var d=this._view,g=0.07;if(c.isSet(this.coverSpacing))g=this.coverSpacing*0.0030;d.shiftX=g*a;this._positions=[];var j;g=this.covers;var e=g.length;for(j=0;j<e;j++)this._positions[j]=d.shiftX*j;d.sizeX=this._positions[e-1];d.shiftFromMiddle=0.7*a;j=Math.max(b/a-1,0);d.distanceToCenter=j*(a/2);d.distanceFromTop=a*(d.coverScale/1.5);d=a*(1+j);j=d+"px";var f=a+"px";c.fx.apply(this._domNode,{width:j,
height:f});c.fx.apply(this._trayNode,{width:j,height:f});c.fx.apply(this._gestureNode,{width:j,height:f});for(j=0;j<e;j++){var h=g[j];c.fx.apply(h.coverNode,{width:f,height:f});c.fx.apply(h.coverInnerNode,{width:f,height:f});c.fx.apply(h.imageNode,{width:f,height:f});c.fx.apply(h.coverReflection,{width:f});this.reflected&&c.fx.apply(h.coverReflectionBack,{width:f,height:this._REFLECTION_ATTENUATION*a+"px"});this.displayTitle&&c.fx.apply(h.titleNode,{width:f})}if(this.fadeEdges){g=this._faderLeft;
e=this._faderRight;j=b/15;g.width=j;g.height=a;e.width=j;e.height=a;e.style.left=d-j+1+"px";this._updateEdgeFaders()}this._createTransformations();this._initTransformations();this._slideTo(this._positions[this._currentPosition],true)},setBackgroundColor:function(a){var b=this.backgroundColor=a;a=this.borderSize;var d={r:255-b.r,g:255-b.g,b:255-b.b};b="rgba("+b.r+", "+b.g+", "+b.b+", 1.0)";this._domNode.style.backgroundColor=b;d=a+"px -"+a+"px 6px rgba("+d.r+", "+d.g+", "+d.b+", 0.5)";var g,j=this.covers,
e=j.length;for(g=0;g<e;g++){var f=j[g];if(this.reflected)f.coverReflectionBack.style.backgroundColor=b;c.isSet(a)&&a>0&&c.fx.apply(f.imageNode,{"box-shadow":d})}this.fadeEdges&&this._updateEdgeFaders()},getPosition:function(){return this._currentPosition},setPosition:function(a){this._slideTo(this._positions[a],true)},_validateProperties:function(){return true},_isValidCover:function(a){var b=true;return b=(b=(b=b&&c.isSet(a))&&c.isSet(a.image))&&c.isSet(a.title)},_initProperties:function(){var a=
this.position;if(a!==0&&!a)a=Math.floor(this.covers.length/2);this._currentPosition=a;this._view.x=0;this._middleViewIndex=Math.floor(this._view.numberOfCoverToRender/2);this._lastRenderedIndex=this._currentPosition;this._transformsQueue=[];this.handleOrientationChange===true&&c.subscribe("/window/events/orientationchange",{context:this,method:"_onOrientationChange"})},_initDom:function(){var a=this._domNode=document.createElement("div");c.fx.apply(a,{"user-select":"none"});var b=this._trayNode=document.createElement("div");
b.style.position="absolute";a.appendChild(b);c.fx.apply(b,{"transform-style":"preserve-3d"});var d=this._gestureNode=document.createElement("div");d.style.position="absolute";a.appendChild(d);var g=this.covers,j=g.length;for(d=0;d<j;d++){var e=g[d],f=document.createElement("div"),h=document.createElement("div"),k=document.createElement("div"),n=document.createElement("img"),r=document.createElement("div");k.appendChild(n);k.appendChild(r);h.appendChild(k);f.appendChild(h);b.appendChild(f);f.style.position=
"absolute";k.style.position="absolute";e.coverNode=f;e.coverOutlineNode=h;e.coverInnerNode=k;e.imageNode=n;e.coverReflection=r;e.transformation=null;e.diffTransform=true;e.displayed=false;if(this.reflected){f=document.createElement("canvas");h=document.createElement("div");r.appendChild(f);r.appendChild(h);f.style.position="absolute";h.style.position="absolute";e.coverReflectionFront=f;e.coverReflectionBack=h}if(this.displayTitle){f=document.createElement("div");r.appendChild(f);f.style.position=
"absolute";r=c.byId(e.title);f.appendChild(r);e.titleNode=f;e.titleInnerNode=r}c.fx.apply(e.coverNode,{perspective:this._PERSPECTIVE,"transform-style":"preserve-3d"});c.fx.apply(e.coverOutlineNode,{"transform-style":"preserve-3d"})}if(this.fadeEdges){b=this._faderLeft=document.createElement("canvas");d=this._faderRight=document.createElement("canvas");a.appendChild(b);a.appendChild(d);b.style.position="absolute";d.style.position="absolute"}this._hideBackFaces();this._organizeDepth();this.updateSize(this.size,
this.viewportWidth);this.setBackgroundColor(this.backgroundColor);c.setTimeout(this,"_setImages",this._DELAY_BEFORE_IMAGE_LOADING)},_initListeners:function(){this._movementtracker=new c.ux.MovementTracker({target:this._gestureNode});c.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});c.subscribe("/movementtracker/events/mvtchanged",{context:this,method:"_handleMovementChanged"});c.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"});
if(this.handleGesture){c.ux.gesture.listenTo(this._gestureNode,"instant_rotation",{context:this,method:"_handleRotation",arguments:null},{preventDefault:true});c.ux.gesture.listenTo(this._gestureNode,"gesture_end",{context:this,method:"_handleGestureEnd",arguments:null},{preventDefault:true})}},_handleRotation:function(a){if(this._displayMode==false){var b=this._view;a=b.observerRotation+a.rotation;if(!(a>17||a<-70)){b.currentObserverRotation=a;var d=this.covers,g=d.length;for(a=0;a<g;a++){var j=
d[a];c.fx.setTransformPart(j.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:b.currentObserverRotation});c.fx.applyComposedTransform(j.coverOutlineNode)}}}},_handleGestureEnd:function(){if(this._displayMode==false)this._view.observerRotation=this._view.currentObserverRotation},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId)this._dragging=false},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(!this._displayMode){var b=a.movement;
a=b.pointStatement[b.pointStatement.length-1];b=a.x-b.pointStatement[b.pointStatement.length-2].x;b/=2;var d=this._getBoundsInfos(this._view.x);if(d.outsideOfBounds)if(d.direction>0&&a.directionX>0||d.direction<0&&a.directionX<0)b/=this._OUTOFBOUND_FRICTIONAL_FORCES;this._dragging=true;this._slideTo(this._view.x-b)}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(!this._flipping){var b=this._currentPosition,d=a.movement.pointStatement[a.movement.pointStatement.length-
1],g=c.getPosition(this._domNode,null,true);if(this._displayMode)if(this._onMiddleCover(d.x-g.x,d.y-g.y)){b=a.uxEvent;b.dispatch(b.target,"click")}else{this._flipping=true;this._unflipCover(b)}else if(this._onMiddleCover(d.x-g.x,d.y-g.y)){a=this.covers[b];if(c.isSet(a.action))c.isCallback(a.action)?c.call(a.action,a):c.log("[CoverFlow] Invalid action for cover : "+b);else if(c.isSet(a.backFaceId)){this._flipping=true;this._prepareCoverBackFace(b);c.setTimeout(this,"_flipCover",1,b)}}}}else this._backToBounds()},
_prepareCoverBackFace:function(a){a=this.covers[a];var b=c.byId(a.backFaceId);c.fx.apply(b,{display:"block",position:"absolute",width:this.size+"px",height:this.size+"px","backface-visibility":"hidden"});c.fx.apply(a.coverInnerNode,{"transform-origin-z":this._view.zMiddleCover+"px","backface-visibility":"hidden"});c.fx.set3dTransform(b,{type:"rotate",x:0,y:1,z:0,angle:180});c.fx.applyTransformTransition(a.coverOutlineNode,"0ms","0ms",this._TRANSITION_FUNC);c.fx.setTransformPart(a.coverOutlineNode,
2,{type:"translate",x:0,y:0,z:this._view.zMiddleCover});c.fx.applyComposedTransform(a.coverOutlineNode);a.coverOutlineNode.appendChild(b)},_flipCover:function(a){var b=this.covers[a];c.fx.onTransitionEnd(b.coverOutlineNode,c.bind(this._postFlipCover,this,a));c.fx.applyTransformTransition(b.coverOutlineNode,this._DURATION_FLIP+"ms","0ms",this._TRANSITION_FUNC);c.fx.setTransformPart(b.coverOutlineNode,1,{type:"rotate",x:0,y:1,z:0,angle:180});c.fx.setTransformPart(b.coverOutlineNode,2,{type:"translate",
x:0,y:this._view.distanceFromTop,z:this._view.zMiddleCover*1.5});c.fx.setTransformPart(b.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:0});c.fx.applyComposedTransform(b.coverOutlineNode);this._displayMode=true},_postFlipCover:function(){this._flipping=false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND;c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zMiddleCover/2})},_unflipCover:function(a){var b=this.covers[a];c.fx.setTransformPart(b.coverOutlineNode,
1,{type:"rotate",x:0,y:1,z:0,angle:0});c.fx.setTransformPart(b.coverOutlineNode,2,{type:"translate",x:0,y:0,z:0});c.fx.setTransformPart(b.coverOutlineNode,3,{type:"rotate",x:1,y:0,z:0,angle:this._view.currentObserverRotation});c.fx.applyComposedTransform(b.coverOutlineNode);c.fx.apply(b.coverInnerNode,{"transform-origin-z":"0px"});c.fx.onTransitionEnd(b.coverOutlineNode,c.bind(this._postUnflipCover,this,a))},_postUnflipCover:function(a){a=this.covers[a];c.fx.applyTransformTransition(a.coverOutlineNode,
"0ms","0ms",this._TRANSITION_FUNC);c.byId(a.backFaceId).style.display="none";this._flipping=this._displayMode=false;this._gestureNode.style.zIndex=this._Z_INDEX_BACKGROUND+4;c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},_onOrientationChange:function(a){this.updateSize(this.size,a.width)},_getPosition:function(a){var b=null,d,g=this._positions,j=g.length;for(d=0;d<j;d++){b=d;if(a<g[d]+this._view.shiftX/2)break}return b},_slideTo:function(a,b){var d=this._view,
g=c.math.round(a,2);if(g!=d.x||b===true){d.x=g;c.fx.set3dTransform(this._trayNode,{type:"translate",x:-d.x+d.distanceToCenter,y:-d.distanceFromTop,z:0});this._updateView()}},_updateView:function(){var a=this._getPosition(this._view.x);if(a!=this._currentPosition){this._currentPosition=a;this._addToQueue(this._currentPosition)}},_startRenderer:function(){if(this._renderer==null)this._renderer=c.setTimeout(this,"_rendererProcess",1)},_stopRenderer:function(){if(this._renderer!=null){clearTimeout(this._renderer);
this._renderer=null}},_rendererProcess:function(){var a=this._transformsQueue,b=a.length,d=a[0];if(d.rendering==false){d.rendering=true;a=d.position;c.fx.onTransitionEnd(this.covers[a].coverInnerNode,c.bind(this._handleCoverRendered,this,a));this._updateTransformations(a);d=c.math.round(this._DURATION_MIDDLE/(b*2),0);b=c.math.round(this._DURATION_AROUND/(b*2),0);this._updateTransitions(a,d,b);this._applyTransformations()}else if(d.rendered==true){a.shift();b=a.length;if(b==0){this._stopRenderer();
return}}else b>1&&this._handleCoverRendered(d.position);this._renderer=c.setTimeout(this,"_rendererProcess",this._RENDERER_INTERVAL)},_handleCoverRendered:function(a){this._lastRenderedIndex=a;a=this._transformsQueue;if(a.length!=0)a[0].rendered=true},_addToQueue:function(a){this._transformsQueue.push({timestamp:(new Date).getTime(),position:a,rendered:false,rendering:false});this._startRenderer()},_updateTransformations:function(a){var b=this._middleViewIndex+(Math.abs(this._lastRenderedIndex-a)-
1),d=a-b,g=a+(b+1),j=this.covers,e=j.length;if(a<b)d=0;if(g>e)g=e;for(b=0;b<e;b++)j[b].diffTransform=false;for(b=d;b<g;b++){d=j[b];d.oldTransformation=d.transformation;d.transformation=this._getTargetedTransformation(b,a);d.diffTransform=this._transformationsDifferent(d.oldTransformation,d.transformation)}},_updateTransitions:function(a,b,d){var g,j=this.covers,e=j.length;for(g=0;g<e;g++){var f=j[g];if(f.diffTransform){var h=this._TRANSITION_FUNC;g==a?c.fx.applyTransformTransition(f.coverInnerNode,
b+"ms","0ms",h):c.fx.applyTransformTransition(f.coverInnerNode,d+"ms","0ms",h)}}},_applyTransformations:function(){var a=this._currentPosition,b=this.covers,d=b.length,g=Math.floor(d/2),j;for(j=0;j<d;j++){var e=b[j],f=e.coverNode,h=e.coverInnerNode,k=e.depth1;if(j<g&&j>=a||j>=g&&j<=a)k=e.depth2;if(e.depth!=k){e.depth=k;c.fx.setTransformPart(f,2,{type:"translate",x:this._positions[j],y:0,z:k});c.fx.applyComposedTransform(f)}if(e.diffTransform){c.fx.setTransformPart(h,1,e.transformation.rotation);c.fx.setTransformPart(h,
2,e.transformation.translation);c.fx.applyComposedTransform(h);if(this.displayTitle){f=this.displayTitleDuration;if(j==this._currentPosition)if(f>0){if(c.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}this._timerTitle=c.setTimeout(this,"_showTitle",this._DELAY_FOR_TITLE_DISPLAY,j)}else this._showTitle(j);else{f>0&&c.fx.applyTransition(e.titleNode,"opacity","0ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(j,0)}}}}},_transformationsDifferent:function(a,b){return a.rotation.angle!=
b.rotation.angle},_initTransformations:function(){var a=this.covers,b=a.length,d=Math.floor(b/2),g,j=0,e=b-1+d;for(g=0;g<b;g++){var f=a[g],h=f.coverNode;if(g<=d){j++;e--}else{j--;e++}f.depth1=j;f.depth2=e;c.fx.initComposedTransform(h);c.fx.setTransformPart(h,1,{type:"scale",x:this._view.coverScale,y:this._view.coverScale,z:1});c.fx.initComposedTransform(f.coverOutlineNode);c.fx.initComposedTransform(f.coverInnerNode);f.transformation=this._getTargetedTransformation(g,this._currentPosition)}this._applyTransformations();
c.fx.set3dTransform(this._gestureNode,{type:"translate",x:0,y:0,z:this._view.zGestureNode})},_createTransformations:function(){var a=this._view,b=a.coverRotation,d=a.zAroundCover,g=a.shiftFromMiddle;this._transformations={left:{rotation:{type:"rotate",x:0,y:1,z:0,angle:b},translation:{type:"translate",x:-g,y:0,z:d}},middle:{rotation:{type:"rotate",x:0,y:1,z:0,angle:0},translation:{type:"translate",x:0,y:0,z:a.zMiddleCover}},right:{rotation:{type:"rotate",x:0,y:1,z:0,angle:-b},translation:{type:"translate",
x:g,y:0,z:d}}}},_getTargetedTransformation:function(a,b){var d=this._transformations;return a<b?d.left:a>b?d.right:d.middle},_showTitle:function(a){if(c.isSet(this._timerTitle)){clearTimeout(this._timerTitle);this._timerTitle=null}if(a==this._currentPosition){var b=this.displayTitleDuration;b>0&&c.fx.applyTransition(this.covers[a].titleNode,"opacity",b+"ms","0ms",this._TRANSITION_FUNC);this._setTitleOpacity(a,1)}},_setTitleOpacity:function(a,b){this.covers[a].titleNode.style.opacity=b},_hideBackFaces:function(){var a,
b=this.covers,d=b.length;for(a=0;a<d;a++){var g=b[a];if(c.isSet(g.backFaceId))c.byId(g.backFaceId).style.display="none"}},_setImages:function(){var a,b=this.covers,d=b.length;for(a=0;a<d;a++){var g=b[a];this.reflected&&this._applyReflection(a);g.imageNode.src=g.image}},_organizeDepth:function(){var a=this._Z_INDEX_BACKGROUND;this._domNode.style.zIndex=a;this._trayNode.style.zIndex=a+1;this._gestureNode.style.zIndex=a+4;if(this.reflected){var b,d=this.covers,g=d.length;for(b=0;b<g;b++){var j=d[b];
if(this.displayTitle)j.titleNode.style.zIndex=a+4;j.coverReflectionFront.style.zIndex=a+3;j.coverReflectionBack.style.zIndex=a+2}}if(this.fadeEdges){this._faderLeft.style.zIndex=a+4;this._faderRight.style.zIndex=a+4}},_applyReflection:function(a){var b=this.covers[a],d=b.imageNode,g=b.coverReflectionFront;b.imageLoadingHandler=c.bind(function(){this._reflect(a,d,g,d.width,d.height)},this);d.addEventListener("load",b.imageLoadingHandler)},_reflect:function(a,b,d,g,j){d.width=g;d.height=j;d=d.getContext("2d");
d.save();d.translate(0,j/1.5);d.scale(1,-1);d.drawImage(b,0,0,g,j/1.5);d.restore();d.globalCompositeOperation="destination-out";var e=d.createLinearGradient(0,0,0,j);e.addColorStop(0,"rgba(255, 255, 255, "+this._REFLECTION_ATTENUATION+")");e.addColorStop(0.6,"rgba(255, 255, 255, 1.0)");d.fillStyle=e;d.fillRect(0,0,g,j);b.removeEventListener("load",this.covers[a].imageLoadingHandler)},_updateEdgeFaders:function(){var a=this.backgroundColor,b=this._faderLeft,d=this._faderRight,g=b.getContext("2d"),
j=g.createLinearGradient(0,0,b.width,0);j.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");j.addColorStop(1,"rgba("+a.r+", "+a.g+", "+a.b+", 0.0)");g.fillStyle=j;g.fillRect(0,0,b.width,b.height);g=d.getContext("2d");j=g.createLinearGradient(0,0,d.width,0);j.addColorStop(0,"rgba("+a.r+", "+a.g+", "+a.b+", 0.0)");j.addColorStop(1,"rgba("+a.r+", "+a.g+", "+a.b+", 1.0)");g.fillStyle=j;g.fillRect(0,0,d.width,d.height)},_backToBounds:function(){var a=this._getBoundsInfos(this._view.x);if(a.outsideOfBounds){this._slideTo(a.positionOfBound,
this._DURATION_BACKTO_BOUND);return true}return false},_getBoundsInfos:function(a){var b=this._view,d={};d.outsideOfBounds=false;if(a<0||a>b.sizeX){d.outsideOfBounds=true;if(a<0){d.distanceToBound=Math.abs(a);d.direction=1;d.positionOfBound=0}else{d.distanceToBound=Math.abs(a-b.sizeX);d.direction=-1;d.positionOfBound=b.sizeX}}return d},_onMiddleCover:function(a,b){var d=this._view,g=this.size,j=c.math.round,e=j(g*d.coverScale*1.5,0),f=j(g/2-e/2-d.distanceFromTop,0),h=j(g/2-e/2+d.distanceToCenter,
0),k=f+e;e=h+e;if(this._displayMode){e=j(g*d.coverScale*2.1,0);f=j(g/2-e/2-d.distanceFromTop/2.1,0);h=j(g/2-e/2+d.distanceToCenter,0);k=f+e;e=h+e}if(a>=h&&a<=e&&b>=f&&b<=k)return true;return false}};return c.ui.xyz.CoverFlow});
define(["../../../../_amd/core","../../../../math/_geometric/js/geometric","../../../../fx/_xyz/js/3dfx","../../../../ux/movementtracker/js/movementtracker"],function(c){c.ui.xyz.Cube=function(a){this.uId=c.getUId();this._properties=a;this._axis=this._faces=null;this._view={size:0,shiftX:0,shiftY:0,shiftZ:0,observerX:0,observerY:0,rotationX:0,rotationY:0,externalRotationX:0,externalRotationY:0};this._selectionEvent=this._radius=this._movementtracker=this._domNode=this._rotationEndCallback=this._rotationCallback=
this._dispatch=this._focusDuration=this._focus=null;this._dragging=false;this._nearestFace=this._rotations=null;if(this._validateProperties()!==false){this._initProperties();this._initDom();this._initListeners()}};c.ui.xyz.Cube.prototype={getDomNode:function(){return this._domNode},rotate:function(a,b,d){this._view.externalRotationX=c.math.round((this._view.externalRotationX+a)%360,3);this._view.externalRotationY=c.math.round((this._view.externalRotationY+b)%360,3);this._rotateWithDuration(a,b,d)},
faceFocus:function(a){this._faceFocus(a)},setFace:function(a){var b=a.id-1;this._faces[b].faceNode.removeChild(this._faces[b].innerNode);for(var d in a)this._faces[b][d]=a[d];this._faces[b].innerNode=c.byId(this._faces[b].faceId);this._faces[b].faceNode.appendChild(this._faces[b].innerNode)},_validateProperties:function(){return true},_raisePropertyError:function(a){c.log("[Cube] Error: "+a+" missing or invalid")},_isValidFace:function(a){var b=true;return b=(b=(b=(b=b&&c.isSet(a))&&c.isSet(a.id))&&
c.isSet(a.faceId))&&a.id>0&&a.id<7},_initProperties:function(){this._faces=[].concat(this._properties.faces);this._view.size=this._properties.size;this._radius=this._view.size/2;this._axis=null;if(c.isSet(this._properties.axis)&&(this._properties.axis=="x"||this._properties.axis=="y"||this._properties.axis=="xy"))this._axis=this._properties.axis;if(c.isSet(this._view.shiftX))this._view.shiftX=this._properties.shiftX;if(c.isSet(this._view.shiftY))this._view.shiftY=this._properties.shiftY;if(c.isSet(this._properties.shiftZ))this._view.shiftZ=
this._properties.shiftZ;this._view.observerX=this._radius;if(c.isSet(this._properties.observerX))this._view.observerX=this._properties.observerX;this._view.observerY=this._radius;if(c.isSet(this._properties.observerY))this._view.observerY=this._properties.observerY;this._focus=false;if(this._properties.focus===true)this._focus=true;this._focusDuration=0;if(c.isSet(this._properties.focusDuration)&&this._properties.focusDuration>0)this._focusDuration=this._properties.focusDuration;this._dispatch=false;
if(this._properties.dispatch===true)this._dispatch=true;this._rotationCallback=null;if(c.isSet(this._properties.rotationCallback))this._rotationCallback=this._properties.rotationCallback;this._rotationEndCallback=null;if(c.isSet(this._properties.rotationEndCallback))this._rotationEndCallback=this._properties.rotationEndCallback},_initDom:function(){this._domNode=document.createElement("div");c.fx.apply(this._domNode,{position:"absolute","user-select":"none",perspective:800,"perspective-origin":this._view.observerX+
"px "+this._view.observerY+"px",width:this._view.size+"px",height:this._view.size+"px",left:this._view.shiftX+"px",top:this._view.shiftY+"px"});this._cubeNode=document.createElement("div");c.fx.apply(this._cubeNode,{"transform-style":"preserve-3d",width:this._view.size+"px",height:this._view.size+"px"});this._domNode.appendChild(this._cubeNode);for(var a=0;a<this._faces.length;a++){var b=this._faces[this._faces[a].id-1];b.faceNode=document.createElement("div");c.fx.apply(b.faceNode,{position:"absolute",
width:this._view.size+"px",height:this._view.size+"px"});b.innerNode=c.byId(b.faceId);this._cubeNode.appendChild(b.faceNode);b.faceNode.appendChild(b.innerNode)}this._initTransformations()},_initListeners:function(){if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=null){this._movementtracker=new c.ux.MovementTracker({target:this._domNode});c.subscribe("/movementtracker/events/mvtbegin",{context:this,method:"_handleMovementBegin"});c.subscribe("/movementtracker/events/mvtchanged",
{context:this,method:"_handleMovementChanged"});c.subscribe("/movementtracker/events/mvtstored",{context:this,method:"_handleMovementStored"})}},_handleMovementBegin:function(a){if(a.publisher.uId==this._movementtracker.uId){this._dragging=false;this._selectionEvent=a.uxEvent;c.fx.applyTransformTransition(this._cubeNode,"0ms","0ms","linear")}},_handleMovementChanged:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._axis!=null||this._rotationCallback!=null||this._rotationEndCallback!=
null){a=a.movement;var b=a.pointStatement[a.pointStatement.length-2],d=a.pointStatement[a.pointStatement.length-1];a=d.x-b.x;b=d.y-b.y;d=c.math.getAngle(this._view.size,a);if(a<0)d=-d;a=c.math.getAngle(this._view.size,b);if(b<0)a=-a;this._dragging=true;b=c.math.round(c.math.radToDeg(d),3);a=c.math.round(c.math.radToDeg(a),3);this._rotate(b,a);this._view.externalRotationX=c.math.round((this._view.externalRotationX+b)%360,3);this._view.externalRotationY=c.math.round((this._view.externalRotationY+a)%
360,3);this._notifyRotation({x:b,y:a})}},_handleMovementStored:function(a){if(a.publisher.uId==this._movementtracker.uId)if(this._dragging==false){if(this._dispatch&&c.isSet(this._selectionEvent)){this._selectionEvent.dispatch(this._selectionEvent.target,"click");this._selectionEvent=null}}else{this._storeRotation();this._notifyRotationEnd({x:this._view.externalRotationX,y:this._view.externalRotationY});this._view.externalRotationX=0;this._view.externalRotationY=0;this._focus==true&&this._faceFocus(this._focusDuration)}},
_notifyRotation:function(a){this._rotationCallback!=null&&c.call(this._rotationCallback,a)},_notifyRotationEnd:function(a){this._rotationEndCallback!=null&&c.call(this._rotationEndCallback,a)},_rotateWithDuration:function(a,b,d){c.fx.applyTransformTransition(this._cubeNode,d+"ms","0ms","linear");this._rotate(a,b,true);this._storeRotation()},_faceFocus:function(a){this._updateNearestFace();c.fx.removeComposedTransform(this._cubeNode);c.fx.initComposedTransform(this._cubeNode);this._view.rotationX=
0;this._view.rotationY=0;this._storeRotation();this._initNormalVectors();var b=this._rotations[this._nearestFace.index];this.rotate(b.y*-b.angle,b.x*b.angle,a)},_updateNearestFace:function(){this._nearestFace={index:0,angle:0};for(var a=0;a<6;a++)if(this._faces[a].angle>this._nearestFace.angle){this._nearestFace.index=a;this._nearestFace.angle=this._faces[a].angle}},_initTransformations:function(){this._rotations=[];this._rotations[0]={type:"rotate",x:1,y:0,z:0,angle:0};this._rotations[1]={type:"rotate",
x:0,y:1,z:0,angle:90};this._rotations[2]={type:"rotate",x:0,y:1,z:0,angle:180};this._rotations[3]={type:"rotate",x:0,y:1,z:0,angle:-90};this._rotations[4]={type:"rotate",x:1,y:0,z:0,angle:90};this._rotations[5]={type:"rotate",x:1,y:0,z:0,angle:-90};this._initNormalVectors();for(var a=0;a<this._faces.length;a++){c.fx.initComposedTransform(this._faces[a].faceNode);c.fx.setTransformPart(this._faces[a].faceNode,1,{type:"translate",x:0,y:0,z:this._radius});c.fx.setTransformPart(this._faces[a].faceNode,
2,this._rotations[a]);c.fx.applyComposedTransform(this._faces[a].faceNode)}c.fx.initComposedTransform(this._cubeNode);c.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});c.fx.applyComposedTransform(this._cubeNode)},_rotate:function(a,b,d){if(this._axis=="y"||this._axis=="xy"||d){this._view.rotationX=c.math.round((this._view.rotationX+a)%360,3);c.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX})}if(this._axis=="x"||this._axis==
"xy"||d){this._view.rotationY=c.math.round((this._view.rotationY-b)%360,3);c.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY})}c.fx.applyComposedTransform(this._cubeNode)},_storeRotation:function(){c.fx.setTransformPart(this._cubeNode,1,{type:"rotate",x:0,y:1,z:0,angle:this._view.rotationX});c.fx.setTransformPart(this._cubeNode,2,{type:"rotate",x:1,y:0,z:0,angle:this._view.rotationY});c.fx.setTransformPart(this._cubeNode,3,null);c.fx.storeComposedTransform(this._cubeNode);
c.fx.setTransformPart(this._cubeNode,3,{type:"translate",x:0,y:0,z:this._view.shiftZ});c.fx.applyComposedTransform(this._cubeNode);this._updateNormalVectors();this._view.rotationX=0;this._view.rotationY=0},_initNormalVectors:function(){for(var a=[0,0,1],b=0;b<6;b++){var d=c.math.createTransformMatrix();d.rotateAxisAngle(this._rotations[b].x,this._rotations[b].y,this._rotations[b].z,-this._rotations[b].angle);this._faces[b].normalVector=c.math.multiplyMatrixVector(d.getValues(),a)}},_updateNormalVectors:function(){for(var a=
[0,0,-1],b=0;b<6;b++){var d=c.math.createTransformMatrix();d.rotateAxisAngle(0,1,0,-this._view.rotationX);d.rotateAxisAngle(1,0,0,-this._view.rotationY);this._faces[b].normalVector=c.math.multiplyMatrixVector(d.getValues(),this._faces[b].normalVector);d=c.math.getAngleBetweenVectors(a,this._faces[b].normalVector);this._faces[b].angle=c.math.radToDeg(d)}}};return c.ui.xyz.Cube});
